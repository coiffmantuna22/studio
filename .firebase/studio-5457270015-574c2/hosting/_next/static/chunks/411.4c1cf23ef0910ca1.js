"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[411],{56792:(e,s,t)=>{t.r(s),t.d(s,{default:()=>ej});var a=t(95155),l=t(12115),r=t(30285),n=t(18046),d=t(75074),i=t(85977),c=t(59434);let o=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(i.bL,{ref:s,className:(0,c.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...l})});o.displayName=i.bL.displayName,l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(i._V,{ref:s,className:(0,c.cn)("aspect-square h-full w-full",t),...l})}).displayName=i._V.displayName;let u=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(i.H4,{ref:s,className:(0,c.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...l})});u.displayName=i.H4.displayName;var m=t(66695),x=t(26126),h=t(763),f=t(63920),p=t(75943),j=t(77223),g=t(37648),b=t(44838),N=t(38350);let v=e=>{let{status:s}=e;switch(s){case"available":return(0,a.jsx)(x.E,{variant:"secondary",className:"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300",children:"פנוי/ה"});case"teaching":return(0,a.jsx)(x.E,{variant:"secondary",className:"bg-orange-100 text-orange-800 dark:bg-orange-900/50 dark:text-orange-300",children:"מלמד/ת"});case"absent":return(0,a.jsx)(x.E,{variant:"destructive",children:"בחופש"});case"not_in_school":return(0,a.jsx)(x.E,{variant:"outline",children:'לא בביה"ס'});default:return(0,a.jsx)(x.E,{variant:"outline",children:"לא ידוע"})}};function w(e){let{teacher:s,onMarkAbsent:t,onEdit:n,onDelete:d,onViewSchedule:i,availabilityStatus:c}=e,x=function(){let[e,s]=l.useState(void 0);return l.useEffect(()=>{let e=window.matchMedia("(max-width: ".concat(767,"px)")),t=()=>{s(window.innerWidth<768)};return e.addEventListener("change",t),s(window.innerWidth<768),()=>e.removeEventListener("change",t)},[]),!!e}();return(0,a.jsxs)(m.Zp,{className:"flex flex-col transition-all hover:shadow-lg",children:[(0,a.jsxs)(m.aR,{className:"flex flex-row items-start gap-4",children:[(0,a.jsx)(o,{className:"h-12 w-12 border-2 border-primary/20",children:(0,a.jsx)(u,{className:"bg-primary/10 text-primary font-bold",children:s.avatar.fallback})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(m.ZB,{children:s.name}),(0,a.jsxs)("div",{className:"mt-1 text-xs text-muted-foreground",children:["מקצועות: ",s.subjects.join(", ")]})]}),(0,a.jsxs)(b.rI,{children:[(0,a.jsx)(b.ty,{asChild:!0,children:(0,a.jsxs)(r.$,{variant:"ghost",size:"icon",className:"h-8 w-8 shrink-0",children:[(0,a.jsx)(N.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"More options"})]})}),(0,a.jsxs)(b.SQ,{align:"end",children:[(0,a.jsxs)(b._2,{onClick:i,children:[(0,a.jsx)(h.A,{className:"ml-2 h-4 w-4"}),"צפה במערכת"]}),(0,a.jsxs)(b._2,{onClick:t,className:"text-amber-600 focus:text-amber-700 dark:text-amber-500 dark:focus:text-amber-600",children:[(0,a.jsx)(f.A,{className:"ml-2 h-4 w-4"}),"סמן היעדרות"]}),(0,a.jsx)(b.mB,{}),(0,a.jsxs)(b._2,{onClick:n,children:[(0,a.jsx)(p.A,{className:"ml-2 h-4 w-4"}),"עריכת פרופיל"]}),(0,a.jsx)(b.mB,{}),(0,a.jsxs)(b._2,{onClick:d,className:"text-destructive focus:text-destructive",children:[(0,a.jsx)(j.A,{className:"ml-2 h-4 w-4"}),"מחק"]})]})]})]}),(0,a.jsx)(m.Wu,{className:"flex-grow space-y-4",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)(g.A,{className:"mt-0.5 h-5 w-5 shrink-0 text-muted-foreground"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold text-sm",children:"סטטוס נוכחי"}),(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)(v,{status:c})})]})]})}),!x&&(0,a.jsxs)(m.wL,{className:"grid grid-cols-2 gap-2",children:[(0,a.jsxs)(r.$,{variant:"outline",className:"w-full",onClick:i,children:[(0,a.jsx)(h.A,{className:"ml-2 h-4 w-4"}),"צפה במערכת"]}),(0,a.jsxs)(r.$,{variant:"secondary",className:"w-full",onClick:t,children:[(0,a.jsx)(f.A,{className:"ml-2 h-4 w-4 text-amber-600 dark:text-amber-500"}),(0,a.jsx)("span",{className:"text-amber-600 dark:text-amber-500",children:"סמן היעדרות"})]})]})]})}var y=t(55594),k=t(62177),C=t(90221),E=t(54165),S=t(17759),A=t(62523),R=t(88539);let z=["ראשון","שני","שלישי","רביעי","חמישי","שישי"],I=e=>{let[s,t]=e.split(":").map(Number);return s+t/60},L=(e,s)=>{if(0===e.length)return[];let t=[...e].sort((e,s)=>e-s),a=[],l=null;return t.forEach(e=>{"break"!==s[e].type&&(null===l?l={start:e,end:e}:e===l.end+1?l.end=e:(a.push({start:s[l.start].start,end:s[l.end].end}),l={start:e,end:e}))}),null!==l&&a.push({start:s[l.start].start,end:s[l.end].end}),a};function B(e){let{value:s,onChange:t,timeSlots:n}=e,[d,i]=(0,l.useState)({});(0,l.useEffect)(()=>{let e={};z.forEach(s=>{e[s]=[]}),Array.isArray(s)&&s.forEach(s=>{s.slots&&e[s.day]&&s.slots.forEach(t=>{let a=I(t.start),l=I(t.end);n.forEach((t,r)=>{if("lesson"===t.type){let d=I(t.start);if(d>=a&&d<l){var n;null==(n=e[s.day])||n.push(r)}}})})}),i(e)},[s,n]);let o=(e,s)=>{if("break"===n[s].type)return;let t={...d};t[e]||(t[e]=[]);let a=t[e],l=a.indexOf(s);l>-1?a.splice(l,1):a.push(s),m(t)},u=e=>{m({...d,[e]:[]})},m=e=>{i(e),t(Object.entries(e).map(e=>{let[s,t]=e;return{day:s,slots:L(t,n)}}))},x=n.length;return(0,a.jsxs)("div",{className:"flex flex-col gap-2",dir:"rtl",children:[(0,a.jsxs)("div",{className:"grid grid-cols-[1fr_auto] gap-x-2",children:[(0,a.jsx)("div",{className:"grid text-center text-xs text-muted-foreground",style:{gridTemplateColumns:"repeat(".concat(x,", minmax(0, 1fr))")},children:n.map(e=>(0,a.jsx)("div",{children:e.start},e.id))}),(0,a.jsx)("div",{className:"w-24"})]}),z.map(e=>(0,a.jsxs)("div",{className:"grid grid-cols-[1fr_auto] items-center gap-x-2",children:[(0,a.jsx)("div",{className:"grid gap-px bg-border rounded-md overflow-hidden",style:{gridTemplateColumns:"repeat(".concat(x,", minmax(0, 1fr))")},dir:"ltr",children:n.map((s,t)=>{var l;let r=null==(l=d[e])?void 0:l.includes(t),n="break"===s.type;return(0,a.jsx)("div",{onClick:()=>o(e,t),className:(0,c.cn)("h-7 w-full transition-colors",n?"bg-muted/50 cursor-not-allowed":"cursor-pointer",!n&&(r?"bg-primary":"bg-card hover:bg-secondary"))},"".concat(e,"-").concat(s.id))})}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2 w-24",children:[(0,a.jsx)("span",{className:"font-semibold text-sm",children:e}),(0,a.jsx)(r.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>u(e),children:(0,a.jsx)(j.A,{className:"h-3.5 w-3.5 text-muted-foreground"})})]})]},e))]})}var O=t(25318);function M(e){let{value:s,onChange:t,placeholder:r}=e,[n,d]=(0,l.useState)(""),i=e=>{t(s.filter(s=>s!==e))};return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mb-2",children:s.map(e=>(0,a.jsxs)(x.E,{variant:"secondary",children:[e,(0,a.jsx)("button",{type:"button",className:"mr-1 p-0.5 rounded-full hover:bg-muted-foreground/20",onClick:()=>i(e),children:(0,a.jsx)(O.A,{className:"h-3 w-3"})})]},e))}),(0,a.jsx)(A.p,{value:n,onChange:e=>d(e.target.value),onKeyDown:e=>{"Enter"===e.key&&n.trim()&&(e.preventDefault(),t([...s,n.trim()]),d(""))},placeholder:r})]})}var _=t(66424);let J=y.z.object({day:y.z.string(),slots:y.z.array(y.z.object({start:y.z.string(),end:y.z.string()}))}),$=y.z.object({name:y.z.string().min(2,{message:"השם חייב להכיל לפחות 2 תווים."}),subjects:y.z.array(y.z.string()).min(1,{message:"אנא הזן לפחות מקצוע אחד."}),availability:y.z.array(J).min(1,{message:"אנא ציין שעות נוכחות."}),preferences:y.z.string().optional()}),D=[{day:"ראשון",slots:[]},{day:"שני",slots:[]},{day:"שלישי",slots:[]},{day:"רביעי",slots:[]},{day:"חמישי",slots:[]},{day:"שישי",slots:[]}];function P(e){let{isOpen:s,onOpenChange:t,onAddTeacher:n,onEditTeacher:d,teacherToEdit:i,timeSlots:c}=e,o=!!i,u=(0,k.mN)({resolver:(0,C.u)($),defaultValues:{name:"",subjects:[],availability:D,preferences:""}});(0,l.useEffect)(()=>{s&&(o&&i?u.reset({name:i.name,subjects:i.subjects,availability:i.availability.length>0?i.availability:D,preferences:i.preferences||""}):u.reset({name:"",subjects:[],availability:D,preferences:""}))},[s,o,i,u]);let m=e=>{let s={name:e.name,subjects:e.subjects,availability:e.availability,preferences:e.preferences};o&&i?d({...s,id:i.id}):n(s),t(!1)};return(0,a.jsx)(E.lG,{open:s,onOpenChange:t,children:(0,a.jsxs)(E.Cf,{className:"sm:max-w-3xl",children:[(0,a.jsxs)(E.c7,{children:[(0,a.jsx)(E.L3,{children:o?"עריכת פרופיל מורה":"יצירת פרופיל מורה"}),(0,a.jsx)(E.rr,{children:o?"עדכן את פרטי המורה. לחץ על שמירה בסיום.":"הוסף מורה חדש למערכת. לחץ על שמירה בסיום."})]}),(0,a.jsx)(_.F,{className:"max-h-[70vh] pr-6 -mr-6",children:(0,a.jsx)(S.lV,{...u,children:(0,a.jsxs)("form",{onSubmit:u.handleSubmit(m),className:"space-y-4 py-4 pr-1",children:[(0,a.jsx)(S.zB,{control:u.control,name:"name",render:e=>{let{field:s}=e;return(0,a.jsxs)(S.eI,{children:[(0,a.jsx)(S.lR,{children:"שם מלא"}),(0,a.jsx)(S.MJ,{children:(0,a.jsx)(A.p,{placeholder:"למשל, ישראלה ישראלי",...s})}),(0,a.jsx)(S.C5,{})]})}}),(0,a.jsx)(S.zB,{control:u.control,name:"subjects",render:e=>{let{field:s}=e;return(0,a.jsxs)(S.eI,{children:[(0,a.jsx)(S.lR,{children:"מקצועות לימוד"}),(0,a.jsx)(S.MJ,{children:(0,a.jsx)(M,{...s,placeholder:"הקש 'Enter' להוספת מקצוע..."})}),(0,a.jsx)(S.C5,{})]})}}),(0,a.jsx)(S.zB,{control:u.control,name:"availability",render:e=>{let{field:s}=e;return(0,a.jsxs)(S.eI,{children:[(0,a.jsx)(S.lR,{children:"שעות נוכחות שבועיות"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"סמן את כל השעות בהן המורה נוכח/ת בבית הספר, כולל שיעורים קבועים והפסקות."}),(0,a.jsx)(S.MJ,{children:(0,a.jsx)(B,{...s,timeSlots:c})}),(0,a.jsx)(S.C5,{})]})}}),(0,a.jsx)(S.zB,{control:u.control,name:"preferences",render:e=>{let{field:s}=e;return(0,a.jsxs)(S.eI,{children:[(0,a.jsx)(S.lR,{children:"העדפות (אופציונלי)"}),(0,a.jsx)(S.MJ,{children:(0,a.jsx)(R.T,{placeholder:"למשל, מעדיף/ה כיתות קטנות",...s})}),(0,a.jsx)(S.C5,{})]})}})]})})}),(0,a.jsx)(E.Es,{className:"pt-4 border-t",children:(0,a.jsx)(r.$,{type:"button",onClick:u.handleSubmit(m),children:o?"שמור שינויים":"שמור פרופיל"})})]})})}var T=t(87481),G=t(90010),H=t(91950),F=t(59409),U=t(14636),V=t(12023),Z=t(18186),W=t(86578),q=t(22346),Y=t(77324),K=t(79233),Q=t(80644),X=t(70831),ee=t(76959),es=t(83013),et=t(4884);let ea=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(et.bL,{className:(0,c.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...l,ref:s,children:(0,a.jsx)(et.zi,{className:(0,c.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0","rtl:data-[state=checked]:-translate-x-5 rtl:data-[state=unchecked]:translate-x-0")})})});ea.displayName=et.bL.displayName;var el=t(85057);let er=e=>{let s=(0,K.P)(e);if(6===s)return(0,Q.o)((0,X.f)(e,1));let t=e.getDate()-s;return(0,Q.o)(new Date(new Date(e).setDate(t)))},en=e=>{if(!e||!e.includes(":"))return 0;let[s,t]=e.split(":").map(Number);return s+t/60};function ed(e){let{day:s,time:t,lesson:n,onSave:d,teacher:i,allClasses:o,isAbsent:u,onToggleAbsence:m}=e,[h,f]=(0,l.useState)(!1),[p,j]=(0,l.useState)((null==n?void 0:n.subject)||""),[g,b]=(0,l.useState)((null==n?void 0:n.classId)||null);(0,l.useEffect)(()=>{h&&(j((null==n?void 0:n.subject)||""),b((null==n?void 0:n.classId)||null))},[n,h]);let N=(0,l.useMemo)(()=>i.subjects.map(e=>({label:e,value:e})),[i.subjects]),v=(null==n?void 0:n.classId)?o.find(e=>e.id===n.classId):null,w=p&&g||!p&&!g&&null!==n;return(0,a.jsxs)(U.AM,{open:h,onOpenChange:f,children:[(0,a.jsx)(U.Wv,{asChild:!0,children:(0,a.jsxs)("div",{className:(0,c.cn)("w-full h-full p-2 flex flex-col justify-center items-center text-center cursor-pointer min-h-[6rem] transition-colors rounded-md",u&&"bg-destructive/10",n?"bg-primary/10 hover:bg-primary/20":"bg-card hover:bg-muted",u&&n&&"bg-destructive/20 hover:bg-destructive/30"),children:[n&&v?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"font-bold text-sm",children:n.subject}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:null==v?void 0:v.name})]}):(0,a.jsx)("span",{className:"text-muted-foreground text-xs",children:"ריקה"}),u&&(0,a.jsx)(x.E,{variant:"destructive",className:"mt-2",children:"נעדר/ת"})]})}),(0,a.jsx)(U.hl,{className:"w-80",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h4",{className:"font-semibold",children:"עריכת שיבוץ"}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[i.name," - ",s,", ",t]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 space-x-reverse justify-center p-2 bg-muted/50 rounded-md",children:[(0,a.jsx)(el.J,{htmlFor:"absence-toggle-".concat(s,"-").concat(t),className:"font-normal",children:"סמן כנעדר/ת"}),(0,a.jsx)(ea,{id:"absence-toggle-".concat(s,"-").concat(t),checked:u,onCheckedChange:m})]}),(0,a.jsx)(q.w,{}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"text-sm font-medium flex items-center gap-2",children:[(0,a.jsx)(V.A,{className:"w-4 h-4 text-muted-foreground"}),"מקצוע"]}),(0,a.jsx)(Y.G,{items:N,value:p,onChange:e=>j(e),placeholder:"בחר מקצוע...",searchPlaceholder:"חיפוש מקצוע...",noItemsMessage:"לא נמצאו מקצועות."})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("label",{className:"text-sm font-medium flex items-center gap-2",children:[(0,a.jsx)(Z.A,{className:"w-4 h-4 text-muted-foreground"}),"כיתה"]}),(0,a.jsxs)(F.l6,{onValueChange:e=>b(e),value:g||"",disabled:!p,children:[(0,a.jsx)(F.bq,{children:(0,a.jsx)(F.yv,{placeholder:"בחר כיתה"})}),(0,a.jsx)(F.gC,{children:o.map(e=>(0,a.jsx)(F.eb,{value:e.id,children:e.name},e.id))})]})]}),(0,a.jsx)(q.w,{}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)(r.$,{variant:"ghost",size:"sm",onClick:()=>{d(s,t,null),f(!1)},className:"text-destructive hover:text-destructive",children:[(0,a.jsx)(O.A,{className:"w-4 h-4 ml-2"}),"נקה שיבוץ"]}),(0,a.jsx)(r.$,{size:"sm",onClick:()=>{p&&g?d(s,t,{subject:p,teacherId:i.id,classId:g}):d(s,t,null),f(!1)},disabled:!w,children:"שמור"})]})]})})]})}function ei(e){let{isOpen:s,onOpenChange:t,teacher:n,allClasses:d,timeSlots:i,onUpdateSchedule:o,onUpdateAbsences:u}=e,[m,h]=(0,l.useState)({}),[f,p]=(0,l.useState)([]);(0,l.useEffect)(()=>{n&&(h(JSON.parse(JSON.stringify(n.schedule||{}))),p(JSON.parse(JSON.stringify(n.absences||[]))))},[n]);let j=(0,l.useMemo)(()=>er(new Date),[]);if(!n)return null;let g=(e,s,t)=>{h(a=>{let l={...a};return l[e]||(l[e]={}),null===t?l[e]&&l[e][s]&&(l[e][s]=null):l[e][s]=t,l})},b=(e,s,t)=>{let a=H.B.indexOf(e),l=(0,X.f)(j,a),r="absence-".concat(l.toISOString(),"-").concat(s.start);if(t){if(!f.some(e=>e.id===r)){let e={id:r,date:l.toISOString(),isAllDay:!1,startTime:s.start,endTime:s.end};p(s=>[...s,e])}}else p(e=>e.filter(e=>e.id!==r))},N=(e,s)=>{if(0===f.length)return!1;let t=H.B.indexOf(e),a=(0,X.f)(j,t),l=f.filter(e=>{try{return(0,ee.r)((0,Q.o)(new Date(e.date)),(0,Q.o)(a))}catch(e){return!1}});if(0===l.length)return!1;let r=en(s);return l.some(e=>{if(e.isAllDay)return!0;let s=en(e.startTime),t=en(e.endTime);return r>=s&&r<t})};return(0,a.jsx)(E.lG,{open:s,onOpenChange:t,children:(0,a.jsxs)(E.Cf,{className:"max-w-7xl w-full flex flex-col max-h-[90vh]",children:[(0,a.jsxs)(E.c7,{children:[(0,a.jsxs)(E.L3,{children:["מערכת שעות: ",n.name]}),(0,a.jsx)(E.rr,{children:"כאן ניתן לצפות ולערוך את מערכת השעות האישית של המורה, ולסמן היעדרויות."})]}),(0,a.jsx)("div",{className:"flex-grow relative overflow-auto",children:(0,a.jsxs)(_.F,{className:"absolute inset-0",children:[(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm text-center table-fixed min-w-[900px]",children:[(0,a.jsx)("thead",{className:"bg-muted/40",children:(0,a.jsxs)("tr",{className:"bg-muted/40",children:[(0,a.jsx)("th",{className:"sticky left-0 top-0 bg-muted/40 p-2 w-40 z-20",children:"שעה"}),H.B.map((e,s)=>{let t=(0,X.f)(j,s);return(0,a.jsxs)("th",{className:"sticky top-0 bg-muted/40 p-2 min-w-[140px]",children:[(0,a.jsx)("div",{children:e}),(0,a.jsx)("div",{className:"font-normal text-xs text-muted-foreground",children:(0,es.GP)(t,"dd/MM")})]},e)})]})}),(0,a.jsx)("tbody",{children:i.map(e=>(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsxs)("td",{className:"sticky left-0 font-semibold bg-card p-2 w-40 z-10 text-center",children:[(0,a.jsxs)("div",{children:[e.start," - ",e.end]}),"break"===e.type&&(0,a.jsx)(x.E,{variant:"outline",className:"mt-1",children:"הפסקה"})]}),H.B.map(s=>{var t;let l=(null==m||null==(t=m[s])?void 0:t[e.start])||null,r="break"===e.type,i=N(s,e.start);return(0,a.jsx)("td",{className:(0,c.cn)("p-0 align-top border-r",r&&"bg-muted/30"),children:r?(0,a.jsxs)("div",{className:(0,c.cn)("p-1.5 h-full min-h-[6rem] flex flex-col justify-center",i&&"bg-destructive/10"),children:[(0,a.jsx)(W.A,{className:"w-5 h-5 mx-auto text-muted-foreground"}),i&&(0,a.jsx)(x.E,{variant:"destructive",className:"mt-2",children:"נעדר/ת"})]}):(0,a.jsx)(ed,{day:s,time:e.start,lesson:l,onSave:g,teacher:n,allClasses:d,isAbsent:i,onToggleAbsence:t=>b(s,e,t)})},"".concat(s,"-").concat(e.start))})]},e.id))})]})}),(0,a.jsx)(_.$,{orientation:"horizontal"})]})}),(0,a.jsxs)(E.Es,{className:"shrink-0 pt-4 border-t mt-4",children:[(0,a.jsx)(r.$,{onClick:()=>{o(n.id,m),u(n.id,f),t(!1)},children:"שמור שינויים"}),(0,a.jsx)(E.HM,{asChild:!0,children:(0,a.jsx)(r.$,{type:"button",variant:"secondary",children:"סגור"})})]})]})})}var ec=t(19599),eo=t(35317),eu=t(23769),em=t(97714),ex=t(40610),eh=t(3310),ef=t(40688),ep=t(50172);function ej(e){let{onMarkAbsent:s}=e,{toast:t}=(0,T.dj)(),{user:i}=(0,ec.useUser)(),c=(0,ec.useFirestore)(),[o,u]=(0,l.useState)(!1),[x,h]=(0,l.useState)(null),[f,p]=(0,l.useState)(null),[j,g]=(0,l.useState)(null),[b,N]=(0,l.useState)(""),v=(0,ec.useMemoFirebase)(()=>i?(0,eo.P)((0,eo.rJ)(c,"teachers"),(0,eo._M)("userId","==",i.uid)):null,[i,c]),{data:y=[],isLoading:k}=(0,eu.G)(v),C=(0,ec.useMemoFirebase)(()=>i?(0,eo.P)((0,eo.rJ)(c,"classes"),(0,eo._M)("userId","==",i.uid)):null,[i,c]),{data:E=[]}=(0,eu.G)(C),S=(0,ec.useMemoFirebase)(()=>i?(0,eo.P)((0,eo.rJ)(c,"settings"),(0,eo._M)("userId","==",i.uid)):null,[i,c]),{data:R}=(0,eu.G)(S),z=(0,l.useMemo)(()=>{if(R){let e=R.find(e=>e.id==="timetable_".concat(null==i?void 0:i.uid));if(e)return e.slots||[]}return[]},[R,i]),I=(0,l.useMemo)(()=>{let e=new Map,s=new Date;return(y||[]).forEach(t=>{e.set(t.id,(0,ef.ax)(t,s,z))}),e},[y,z]),L=async e=>{if(!c||!i)return;let s=(0,eo.H9)((0,eo.rJ)(c,"teachers")),a=e.name.split(" ").map(e=>e[0]).join("").toUpperCase(),l={...e,id:s.id,userId:i.uid,avatar:{fallback:a},schedule:{},absences:[]},r=(0,eo.wP)(c);r.set(s,l),await (0,em.j)(r,{operation:"create",path:s.path,data:l}),t({title:"פרופיל מורה נוצר",description:"הפרופיל של ".concat(e.name," נוסף למערכת.")})},B=async e=>{if(!c||!i)return;let s=(0,eo.H9)(c,"teachers",e.id),a=(0,eo.wP)(c);a.update(s,{...e}),await (0,em.j)(a,{operation:"update",path:s.path,data:e}),h(null),t({title:"פרופיל עודכן",description:"הפרופיל של ".concat(e.name," עודכן.")})},O=async()=>{if(!c||!i||!f)return;let e=f.id,s=(0,eo.wP)(c);try{let a=(0,eo.H9)(c,"teachers",e);if(!(await (0,eo.x7)(a)).exists())return;s.update(a,{schedule:{}}),(await (0,eo.GG)((0,eo.P)((0,eo.rJ)(c,"classes"),(0,eo._M)("userId","==",i.uid)))).forEach(t=>{let a={id:t.id,...t.data()},l=!1,r={...a.schedule};if(Object.keys(r).forEach(s=>{r[s]&&Object.keys(r[s]).forEach(t=>{var a;let n=null==(a=r[s])?void 0:a[t];n&&n.teacherId===e&&(r[s][t]=null,l=!0)})}),l){let e=(0,eo.H9)(c,"classes",a.id);s.update(e,{schedule:r})}}),s.delete(a),await (0,em.j)(s,{operation:"delete",path:"teachers/".concat(e," and related classes")}),t({variant:"destructive",title:"המורה נמחק",description:"הפרופיל של ".concat(f.name," וכל השיבוצים שלו הוסרו מהמערכת.")})}catch(s){if(!(s instanceof ex.$)){let s=new ex.$({operation:"delete",path:"teachers/".concat(e," and related classes")});throw eh.d.emit("permission-error",s),s}throw s}finally{p(null)}},M=async(e,s)=>{if(!c||!i)return;let t=(0,eo.wP)(c);try{let a=(0,eo.H9)(c,"teachers",e),l=await (0,eo.x7)(a);if(!l.exists())return;let r=l.data().schedule||{};t.update(a,{schedule:s});let n=new Set;for(let e of[r,s])Object.values(e||{}).forEach(e=>Object.values(e||{}).forEach(e=>(null==e?void 0:e.classId)&&n.add(e.classId)));for(let a of n){let l=(0,eo.H9)(c,"classes",a),n=await (0,eo.x7)(l);if(!n.exists())continue;let d=n.data(),i=JSON.parse(JSON.stringify(d.schedule||{}));["ראשון","שני","שלישי","רביעי","חמישי","שישי"].forEach(t=>{(z||[]).forEach(l=>{var n,d,c,o;let u=l.start,m=null==(n=r[t])?void 0:n[u],x=null==(d=s[t])?void 0:d[u];(null==m?void 0:m.classId)!==a||x&&x.classId===a||(null==(o=i[t])||null==(c=o[u])?void 0:c.teacherId)===e&&(i[t][u]=null),(null==x?void 0:x.classId)===a&&(i[t]=i[t]||{},i[t][u]={...x,teacherId:e})})}),t.update(l,{schedule:i})}await (0,em.j)(t,{operation:"update",path:"teachers/".concat(e),data:{schedule:s}})}catch(t){if(!(t instanceof ex.$)){let t=new ex.$({operation:"update",path:"teachers/".concat(e),requestResourceData:{schedule:s}});throw eh.d.emit("permission-error",t),t}throw t}},_=async(e,s)=>{if(!c)return;let t=(0,eo.H9)(c,"teachers",e),a=(0,eo.wP)(c);a.update(t,{absences:s}),await (0,em.j)(a,{operation:"update",path:t.path,data:{absences:"..."}})},J=e=>{h(e),u(!0)},$=(y||[]).filter(e=>e.name.toLowerCase().includes(b.toLowerCase()));return k?(0,a.jsx)("div",{className:"p-4 flex justify-center",children:(0,a.jsx)(ep.A,{className:"h-8 w-8 animate-spin text-primary"})}):(0,a.jsxs)(m.Zp,{className:"mt-6 border-none shadow-none",children:[(0,a.jsx)(m.aR,{children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)(m.ZB,{className:"text-xl font-bold",children:"פרופילי מורים"}),(0,a.jsx)(m.BT,{children:"ניהול מורים מחליפים וסימון היעדרויות."})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-center gap-4 w-full sm:w-auto",children:[(0,a.jsxs)(r.$,{onClick:()=>{h(null),u(!0)},className:"shrink-0",children:[(0,a.jsx)(n.A,{className:"me-2 h-4 w-4"}),"יצירת פרופיל"]}),(0,a.jsxs)("div",{className:"relative flex-grow w-full sm:w-auto",children:[(0,a.jsx)(d.A,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(A.p,{type:"search",placeholder:"חיפוש מורה...",className:"w-full pr-9",value:b,onChange:e=>N(e.target.value)})]})]})]})}),(0,a.jsxs)(m.Wu,{children:[(0,a.jsx)(G.Lt,{open:!!f,onOpenChange:e=>!e&&p(null),children:(0,a.jsxs)(G.EO,{children:[(0,a.jsxs)(G.wd,{children:[(0,a.jsx)(G.r7,{children:"האם אתה בטוח?"}),(0,a.jsxs)(G.$v,{children:["פעולה זו תמחק את הפרופיל של $",null==f?void 0:f.name," לצמיתות ותסיר אותו/ה מכל מערכות השעות. לא ניתן לבטל את הפעולה."]})]}),(0,a.jsxs)(G.ck,{children:[(0,a.jsx)(G.Zr,{children:"ביטול"}),(0,a.jsx)(G.Rx,{className:(0,r.r)({variant:"destructive"}),onClick:O,children:"מחק"})]})]})}),(y||[]).length>0?$.length>0?(0,a.jsx)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:$.map(e=>(0,a.jsx)(w,{teacher:e,onMarkAbsent:()=>s(e),onEdit:()=>J(e),onDelete:()=>p(e),onViewSchedule:()=>g(e),availabilityStatus:I.get(e.id)||"unknown"},e.id))}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center rounded-lg border-2 border-dashed border-border p-12 text-center",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"לא נמצאו מורים תואמים"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"נסה מונח חיפוש אחר."})]}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center rounded-lg border-2 border-dashed border-border p-12 text-center",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"לא נמצאו מורים"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"התחל על ידי יצירת פרופיל מורה חדש."})]})]}),(0,a.jsx)(P,{isOpen:o,onOpenChange:()=>{u(!1),h(null)},onAddTeacher:L,onEditTeacher:B,teacherToEdit:x,timeSlots:z}),(0,a.jsx)(ei,{isOpen:!!j,onOpenChange:e=>!e&&g(null),teacher:j,allClasses:E,timeSlots:z,onUpdateSchedule:M,onUpdateAbsences:_})]})}},59409:(e,s,t)=>{t.d(s,{bq:()=>m,eb:()=>p,gC:()=>f,l6:()=>o,yv:()=>u});var a=t(95155),l=t(12115),r=t(43433),n=t(79556),d=t(77381),i=t(10518),c=t(59434);let o=r.bL;r.YJ;let u=r.WT,m=l.forwardRef((e,s)=>{let{className:t,children:l,...d}=e;return(0,a.jsxs)(r.l9,{ref:s,className:(0,c.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...d,children:[l,(0,a.jsx)(r.In,{asChild:!0,children:(0,a.jsx)(n.A,{className:"h-4 w-4 opacity-50"})})]})});m.displayName=r.l9.displayName;let x=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(r.PP,{ref:s,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",t),...l,children:(0,a.jsx)(d.A,{className:"h-4 w-4"})})});x.displayName=r.PP.displayName;let h=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(r.wn,{ref:s,className:(0,c.cn)("flex cursor-default items-center justify-center py-1",t),...l,children:(0,a.jsx)(n.A,{className:"h-4 w-4"})})});h.displayName=r.wn.displayName;let f=l.forwardRef((e,s)=>{let{className:t,children:l,position:n="popper",...d}=e;return(0,a.jsx)(r.ZL,{children:(0,a.jsxs)(r.UC,{ref:s,className:(0,c.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...d,children:[(0,a.jsx)(x,{}),(0,a.jsx)(r.LM,{className:(0,c.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:l}),(0,a.jsx)(h,{})]})})});f.displayName=r.UC.displayName,l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(r.JU,{ref:s,className:(0,c.cn)("py-1.5 pr-8 pl-2 text-sm font-semibold",t),...l})}).displayName=r.JU.displayName;let p=l.forwardRef((e,s)=>{let{className:t,children:l,...n}=e;return(0,a.jsxs)(r.q7,{ref:s,className:(0,c.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pr-8 pl-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(r.VF,{children:(0,a.jsx)(i.A,{className:"h-4 w-4"})})}),(0,a.jsx)(r.p4,{children:l})]})});p.displayName=r.q7.displayName,l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(r.wv,{ref:s,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",t),...l})}).displayName=r.wv.displayName},77324:(e,s,t)=>{t.d(s,{G:()=>g});var a=t(95155),l=t(12115),r=t(21887),n=t(10518),d=t(59434),i=t(30285),c=t(77740),o=t(75074);t(54165);let u=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(c.uB,{ref:s,className:(0,d.cn)("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",t),...l})});u.displayName=c.uB.displayName;let m=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsxs)("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[(0,a.jsx)(o.A,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),(0,a.jsx)(c.uB.Input,{ref:s,className:(0,d.cn)("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",t),...l})]})});m.displayName=c.uB.Input.displayName;let x=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(c.uB.List,{ref:s,className:(0,d.cn)("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...l})});x.displayName=c.uB.List.displayName;let h=l.forwardRef((e,s)=>(0,a.jsx)(c.uB.Empty,{ref:s,className:"py-6 text-center text-sm",...e}));h.displayName=c.uB.Empty.displayName;let f=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(c.uB.Group,{ref:s,className:(0,d.cn)("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",t),...l})});f.displayName=c.uB.Group.displayName,l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(c.uB.Separator,{ref:s,className:(0,d.cn)("-mx-1 h-px bg-border",t),...l})}).displayName=c.uB.Separator.displayName;let p=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(c.uB.Item,{ref:s,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none aria-selected:bg-accent aria-selected:text-accent-foreground data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50",t),...l})});p.displayName=c.uB.Item.displayName;var j=t(14636);function g(e){var s,t;let{items:c,value:o,onChange:g,placeholder:b,searchPlaceholder:N,noItemsMessage:v}=e,[w,y]=l.useState(!1),[k,C]=l.useState(c),[E,S]=l.useState("");l.useEffect(()=>{C(c)},[c]);let A=e=>{g(e===o?"":e),y(!1)};return(0,a.jsxs)(j.AM,{open:w,onOpenChange:e=>{y(e),e||(C(c),S(""))},children:[(0,a.jsx)(j.Wv,{asChild:!0,children:(0,a.jsxs)(i.$,{variant:"outline",role:"combobox","aria-expanded":w,className:"w-full justify-between",children:[o?null!=(t=null==(s=c.find(e=>e.value===o))?void 0:s.label)?t:o:b,(0,a.jsx)(r.A,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"})]})}),(0,a.jsx)(j.hl,{className:"w-[--radix-popover-trigger-width] p-0",children:(0,a.jsxs)(u,{children:[(0,a.jsx)(m,{placeholder:N,value:E,onValueChange:e=>{if(S(e),e&&!c.some(s=>s.value.toLowerCase()===e.toLowerCase())){let s=c.filter(s=>s.label.toLowerCase().includes(e.toLowerCase()));C([{label:'הוסף "'.concat(e,'"'),value:e},...s])}else{let s=c.filter(s=>s.label.toLowerCase().includes(e.toLowerCase()));C(s.length>0?s:c)}},onBlur:()=>{E&&!c.some(e=>e.value.toLowerCase()===E.toLowerCase())&&g(E),S("")}}),(0,a.jsxs)(x,{children:[(0,a.jsx)(h,{children:v}),(0,a.jsx)(f,{children:k.map(e=>(0,a.jsxs)(p,{value:e.value,onSelect:A,children:[(0,a.jsx)(n.A,{className:(0,d.cn)("ml-2 h-4 w-4",o===e.value?"opacity-100":"opacity-0")}),e.label]},e.value))})]})]})})]})}},88539:(e,s,t)=>{t.d(s,{T:()=>n});var a=t(95155),l=t(12115),r=t(59434);let n=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("textarea",{className:(0,r.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...l})});n.displayName="Textarea"},90010:(e,s,t)=>{t.d(s,{$v:()=>p,EO:()=>m,Lt:()=>i,Rx:()=>j,Zr:()=>g,ck:()=>h,r7:()=>f,tv:()=>c,wd:()=>x});var a=t(95155),l=t(12115),r=t(62278),n=t(59434),d=t(30285);let i=r.bL,c=r.l9,o=r.ZL,u=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(r.hJ,{className:(0,n.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...l,ref:s})});u.displayName=r.hJ.displayName;let m=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsxs)(o,{children:[(0,a.jsx)(u,{}),(0,a.jsx)(r.UC,{ref:s,className:(0,n.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...l})]})});m.displayName=r.UC.displayName;let x=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,n.cn)("flex flex-col space-y-2 text-center sm:text-right",s),...t})};x.displayName="AlertDialogHeader";let h=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,n.cn)("flex flex-col-reverse sm:flex-row sm:justify-start sm:gap-2",s),...t})};h.displayName="AlertDialogFooter";let f=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(r.hE,{ref:s,className:(0,n.cn)("text-lg font-semibold",t),...l})});f.displayName=r.hE.displayName;let p=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(r.VY,{ref:s,className:(0,n.cn)("text-sm text-muted-foreground",t),...l})});p.displayName=r.VY.displayName;let j=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(r.rc,{ref:s,className:(0,n.cn)((0,d.r)(),t),...l})});j.displayName=r.rc.displayName;let g=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)(r.ZD,{ref:s,className:(0,n.cn)((0,d.r)({variant:"outline"}),"mt-2 sm:mt-0",t),...l})});g.displayName=r.ZD.displayName}}]);