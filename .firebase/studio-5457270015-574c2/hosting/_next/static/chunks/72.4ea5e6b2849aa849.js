"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[72],{30072:(e,s,t)=>{t.r(s),t.d(s,{default:()=>eu});var a=t(95155),r=t(12115),n=t(66695),l=t(26126),i=t(66424),c=t(91950),d=t(59434),o=t(86578),u=t(63920),m=t(57804);let h=(0,t(40157).A)("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);var x=t(79233),f=t(80644),p=t(70831),j=t(76959),v=t(83013),b=t(19599),g=t(35317),y=t(23769),N=t(50172),w=t(30285),k=t(97714),C=t(54165),I=t(85185),E=t(6101),A=t(46081),M=t(63540),D=t(89196),T=t(5845),_=t(94315),R=t(11275),G=t(45503),P=t(28905),S="Radio",[B,O]=(0,A.A)(S),[F,L]=B(S),J=r.forwardRef((e,s)=>{let{__scopeRadio:t,name:n,checked:l=!1,required:i,disabled:c,value:d="on",onCheck:o,form:u,...m}=e,[h,x]=r.useState(null),f=(0,E.s)(s,e=>x(e)),p=r.useRef(!1),j=!h||u||!!h.closest("form");return(0,a.jsxs)(F,{scope:t,checked:l,disabled:c,children:[(0,a.jsx)(M.sG.button,{type:"button",role:"radio","aria-checked":l,"data-state":q(l),"data-disabled":c?"":void 0,disabled:c,value:d,...m,ref:f,onClick:(0,I.m)(e.onClick,e=>{l||null==o||o(),j&&(p.current=e.isPropagationStopped(),p.current||e.stopPropagation())})}),j&&(0,a.jsx)($,{control:h,bubbles:!p.current,name:n,value:d,checked:l,required:i,disabled:c,form:u,style:{transform:"translateX(-100%)"}})]})});J.displayName=S;var z="RadioIndicator",H=r.forwardRef((e,s)=>{let{__scopeRadio:t,forceMount:r,...n}=e,l=L(z,t);return(0,a.jsx)(P.C,{present:r||l.checked,children:(0,a.jsx)(M.sG.span,{"data-state":q(l.checked),"data-disabled":l.disabled?"":void 0,...n,ref:s})})});H.displayName=z;var $=e=>{let{control:s,checked:t,bubbles:n=!0,...l}=e,i=r.useRef(null),c=(0,G.Z)(t),d=(0,R.X)(s);return r.useEffect(()=>{let e=i.current,s=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(c!==t&&s){let a=new Event("click",{bubbles:n});s.call(e,t),e.dispatchEvent(a)}},[c,t,n]),(0,a.jsx)("input",{type:"radio","aria-hidden":!0,defaultChecked:t,...l,tabIndex:-1,ref:i,style:{...e.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function q(e){return e?"checked":"unchecked"}var V=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Z="RadioGroup",[U,X]=(0,A.A)(Z,[D.RG,O]),K=(0,D.RG)(),W=O(),[Q,Y]=U(Z),ee=r.forwardRef((e,s)=>{let{__scopeRadioGroup:t,name:r,defaultValue:n,value:l,required:i=!1,disabled:c=!1,orientation:d,dir:o,loop:u=!0,onValueChange:m,...h}=e,x=K(t),f=(0,_.jH)(o),[p,j]=(0,T.i)({prop:l,defaultProp:n,onChange:m});return(0,a.jsx)(Q,{scope:t,name:r,required:i,disabled:c,value:p,onValueChange:j,children:(0,a.jsx)(D.bL,{asChild:!0,...x,orientation:d,dir:f,loop:u,children:(0,a.jsx)(M.sG.div,{role:"radiogroup","aria-required":i,"aria-orientation":d,"data-disabled":c?"":void 0,dir:f,...h,ref:s})})})});ee.displayName=Z;var es="RadioGroupItem",et=r.forwardRef((e,s)=>{let{__scopeRadioGroup:t,disabled:n,...l}=e,i=Y(es,t),c=i.disabled||n,d=K(t),o=W(t),u=r.useRef(null),m=(0,E.s)(s,u),h=i.value===l.value,x=r.useRef(!1);return r.useEffect(()=>{let e=e=>{V.includes(e.key)&&(x.current=!0)},s=()=>x.current=!1;return document.addEventListener("keydown",e),document.addEventListener("keyup",s),()=>{document.removeEventListener("keydown",e),document.removeEventListener("keyup",s)}},[]),(0,a.jsx)(D.q7,{asChild:!0,...d,focusable:!c,active:h,children:(0,a.jsx)(J,{disabled:c,required:i.required,checked:h,...o,...l,name:i.name,ref:m,onCheck:()=>i.onValueChange(l.value),onKeyDown:(0,I.m)(e=>{"Enter"===e.key&&e.preventDefault()}),onFocus:(0,I.m)(l.onFocus,()=>{var e;x.current&&(null==(e=u.current)||e.click())})})})});et.displayName=es;var ea=r.forwardRef((e,s)=>{let{__scopeRadioGroup:t,...r}=e,n=W(t);return(0,a.jsx)(H,{...n,...r,ref:s})});ea.displayName="RadioGroupIndicator";var er=t(70154);let en=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(ee,{className:(0,d.cn)("grid gap-2",t),...r,ref:s})});en.displayName=ee.displayName;let el=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(et,{ref:s,className:(0,d.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),...r,children:(0,a.jsx)(ea,{className:"flex items-center justify-center",children:(0,a.jsx)(er.A,{className:"h-2.5 w-2.5 fill-current text-current"})})})});el.displayName=et.displayName;var ei=t(85057);let ec=e=>{let{isOpen:s,onOpenChange:t,substitute:n,lessonsToCover:l,onConfirm:i}=e,[c,d]=(0,r.useState)(null),[o,u]=(0,r.useState)(!1);if((0,r.useEffect)(()=>{s&&(d(null),u(!1))},[s]),!n)return null;let m=async()=>{if(!c)return;let e=l.find(e=>"".concat(e.schoolClass.id,"-").concat(e.lesson.subject,"-").concat(e.time)===c);e&&(u(!0),await i(n,e),u(!1),t(!1))};return(0,a.jsx)(C.lG,{open:s,onOpenChange:t,children:(0,a.jsxs)(C.Cf,{children:[(0,a.jsxs)(C.c7,{children:[(0,a.jsx)(C.L3,{children:"שיבוץ מורה מחליף"}),(0,a.jsx)(C.rr,{children:l.length>0?"שבץ את ".concat(n.name," להחליף באחד מהשיעורים הבאים."):"לא נמצאו שיעורים הדורשים החלפה כעת."})]}),l.length>0&&(0,a.jsx)("div",{className:"py-4",children:(0,a.jsx)(en,{onValueChange:d,dir:"rtl",children:l.map((e,s)=>{let t="".concat(e.schoolClass.id,"-").concat(e.lesson.subject,"-").concat(e.time);return(0,a.jsxs)("div",{className:"flex items-center space-x-2 space-x-reverse",children:[(0,a.jsx)(el,{value:t,id:t}),(0,a.jsxs)(ei.J,{htmlFor:t,className:"flex flex-col cursor-pointer",children:[(0,a.jsxs)("span",{children:[e.schoolClass.name," - ",e.lesson.subject," (",e.time,")"]}),(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:["מורה חסר: ",e.absentTeacher.name]})]})]},"".concat(t,"-").concat(s))})})}),(0,a.jsxs)(C.Es,{children:[(0,a.jsx)(C.HM,{asChild:!0,children:(0,a.jsx)(w.$,{variant:"ghost",children:"ביטול"})}),l.length>0?(0,a.jsx)(w.$,{onClick:m,disabled:!c||o,children:o?(0,a.jsx)(N.A,{className:"h-4 w-4 animate-spin"}):"אישור שיבוץ"}):(0,a.jsx)(w.$,{onClick:()=>t(!1),children:"הבנתי"})]})]})})},ed=e=>{if(!e||!e.includes(":"))return 0;let[s,t]=e.split(":").map(Number);return s+t/60},eo=e=>{let s=(0,x.P)(e);if(6===s)return(0,f.o)((0,p.f)(e,1));let t=e.getDate()-s;return(0,f.o)(new Date(new Date(e).setDate(t)))};function eu(e){let{substitutions:s}=e,{user:t}=(0,b.useUser)(),C=(0,b.useFirestore)(),[I,E]=(0,r.useState)({isOpen:!1,substitute:null,lessonsToCover:[]}),[A,M]=(0,r.useState)("in_school"),[D,T]=(0,r.useState)(c.B[new Date().getDay()]||c.B[0]),_=(0,b.useMemoFirebase)(()=>t?(0,g.P)((0,g.rJ)(C,"teachers"),(0,g._M)("userId","==",t.uid)):null,[t,C]),{data:R,isLoading:G}=(0,y.G)(_),P=(0,b.useMemoFirebase)(()=>t?(0,g.P)((0,g.rJ)(C,"classes"),(0,g._M)("userId","==",t.uid)):null,[t,C]),{data:S,isLoading:B}=(0,y.G)(P),O=(0,b.useMemoFirebase)(()=>t?(0,g.P)((0,g.rJ)(C,"settings"),(0,g._M)("userId","==",t.uid)):null,[t,C]),{data:F,isLoading:L}=(0,y.G)(O),J=(0,r.useMemo)(()=>{if(F){let e=F.find(e=>e.id==="timetable_".concat(null==t?void 0:t.uid));if(e)return e.slots||[]}return[]},[F,t]),z=(0,r.useMemo)(()=>eo(new Date),[]),H=(0,r.useMemo)(()=>{let e=new Map;return R&&s&&R.forEach(t=>{(t.absences||[]).forEach(a=>{var r;let n=(0,f.o)(new Date(a.date)),l=c.B[(0,x.P)(n)],i=((0,x.P)(n)-(0,x.P)(z)+7)%7;if(i<0||i>=c.B.length)return;let d=(null==(r=t.schedule)?void 0:r[l])||{};Object.keys(d).forEach(r=>{let i=d[r],c=Array.isArray(i)?i:i?[i]:[];if(c&&c.length>0){let i=ed(r);(a.isAllDay||i>=ed(a.startTime)&&i<ed(a.endTime))&&c.forEach(a=>{if(!s.some(e=>(0,j.r)((0,f.o)(new Date(e.date)),n)&&e.time===r&&e.classId===a.classId&&e.absentTeacherId===t.id)){let s="".concat(l,"-").concat(r);e.has(s)||e.set(s,[]),e.get(s).push({teacher:t,lesson:a})}})}})})}),e},[R,s,J,z]),$=(0,r.useMemo)(()=>{let e={};return c.B.forEach(s=>{e[s]={},J.forEach(t=>{"break"!==t.type&&(e[s][t.start]=[])})}),(R||[]).forEach(t=>{c.B.forEach((a,r)=>{let n=(0,p.f)(z,r),l=(t.absences||[]).filter(e=>(0,j.r)((0,f.o)(new Date(e.date)),n));J.forEach(r=>{if("lesson"===r.type){var i,c,d,o,u,m;let h=ed(r.start),x=null==(c=t.schedule)||null==(i=c[a])?void 0:i[r.start],p=Array.isArray(x)?x:x?[x]:[];if(p&&p.length>0)return;let v=!1;if(l.length>0&&(v=l.some(e=>{if(e.isAllDay)return!0;let s=ed(e.startTime),t=ed(e.endTime);return h>=s&&h<t})),v||(s||[]).some(e=>e.substituteTeacherId===t.id&&(0,j.r)((0,f.o)(new Date(e.date)),n)&&e.time===r.start))return;let b=t.availability.find(e=>e.day===a),g=null==b?void 0:b.slots.some(e=>{let s=ed(e.start),t=ed(e.end);return h>=s&&h<t});"in_school"===A?g&&(null==(o=e[a])||null==(d=o[r.start])||d.push({name:t.name,id:t.id,isInSchool:!0})):"all_not_teaching"===A&&(null==(m=e[a])||null==(u=m[r.start])||u.push({name:t.name,id:t.id,isInSchool:!!g}))}})})}),e},[R,J,s,A,z]),q=(e,s,t)=>{let a=c.B.indexOf(s),r=(0,p.f)(z,a),n=[],l="".concat(s,"-").concat(t);(H.get(l)||[]).forEach(e=>{let{teacher:s,lesson:a}=e;if(a&&a.classId){let e=(S||[]).find(e=>e.id===a.classId);e&&n.push({date:r,time:t,absentTeacher:s,lesson:a,schoolClass:e})}});let i=null==R?void 0:R.find(s=>s.id===e.id);i&&E({isOpen:!0,substitute:i,lessonsToCover:n})},V=async(e,s)=>{if(!C||!t)return;let{date:a,time:r,absentTeacher:n,lesson:l,schoolClass:i}=s,c=(0,g.wP)(C),d=(0,g.H9)((0,g.rJ)(C,"substitutions")),o={date:(0,v.GP)(a,"yyyy-MM-dd"),time:r,classId:i.id,className:i.name,absentTeacherId:n.id,absentTeacherName:n.name,substituteTeacherId:e.id,substituteTeacherName:e.name,subject:l.subject,userId:t.uid,createdAt:new Date().toISOString()};c.set(d,{...o,id:d.id}),await (0,k.j)(c,{operation:"create",path:"substitutions/".concat(d.id),data:o})};return G||L||B?(0,a.jsx)("div",{className:"p-4 flex justify-center",children:(0,a.jsx)(N.A,{className:"h-8 w-8 animate-spin text-primary"})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.Zp,{className:"mt-6 border-none shadow-none",children:[(0,a.jsxs)(n.aR,{children:[(0,a.jsx)(n.ZB,{className:"text-xl",children:"זמינות מורים להחלפה"}),(0,a.jsx)(n.BT,{children:"הטבלה מציגה מורים שאינם משובצים לשיעור. לחץ על שם מורה כדי לשבץ אותו כמחליף."}),(0,a.jsx)("div",{className:"mt-4 pt-4 border-t",children:(0,a.jsxs)(en,{dir:"rtl",defaultValue:"in_school",className:"flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-6",onValueChange:M,value:A,children:[(0,a.jsx)(ei.J,{className:"font-semibold text-sm shrink-0",children:"הצג:"}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 space-x-reverse",children:[(0,a.jsx)(el,{value:"in_school",id:"filter-in_school"}),(0,a.jsx)(ei.J,{htmlFor:"filter-in_school",className:"font-normal cursor-pointer",children:'פנויים בביה"ס'})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 space-x-reverse",children:[(0,a.jsx)(el,{value:"all_not_teaching",id:"filter-all_not_teaching"}),(0,a.jsx)(ei.J,{htmlFor:"filter-all_not_teaching",className:"font-normal cursor-pointer",children:"כלל הלא-מלמדים"})]})]})]})})]}),(0,a.jsxs)(n.Wu,{children:[(0,a.jsxs)(i.F,{className:"w-full whitespace-nowrap rounded-md border hidden md:block",children:[(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm text-center table-fixed min-w-[900px]",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"bg-muted/40",children:[(0,a.jsx)("th",{className:"sticky left-0 top-0 bg-muted/40 p-2 w-40 z-20",children:"שעה"}),c.B.map((e,s)=>{let t=(0,p.f)(z,s);return(0,a.jsxs)("th",{className:"sticky top-0 bg-muted/40 p-2 min-w-[150px]",children:[(0,a.jsx)("div",{children:e}),(0,a.jsx)("div",{className:"font-normal text-xs text-muted-foreground",children:(0,v.GP)(t,"dd/MM")})]},e)})]})}),(0,a.jsx)("tbody",{children:J.map(e=>(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsxs)("td",{className:"sticky left-0 font-semibold bg-card p-2 w-40 z-10 text-center",children:[(0,a.jsxs)("div",{children:[e.start," - ",e.end]}),"break"===e.type&&(0,a.jsx)(l.E,{variant:"outline",className:"mt-1",children:"הפסקה"})]}),c.B.map(t=>{var r;let n=(null==(r=$[t])?void 0:r[e.start])||[],i=c.B.indexOf(t),x=(0,p.f)(z,i),v=(s||[]).filter(s=>(0,j.r)((0,f.o)(new Date(s.date)),x)&&s.time===e.start),b=H.get("".concat(t,"-").concat(e.start)),g=null==b?void 0:b.filter(e=>!v.some(s=>s.absentTeacherId===e.teacher.id&&s.classId===e.lesson.classId));return(0,a.jsx)("td",{className:(0,d.cn)("p-2 align-top h-24 border-r","break"===e.type&&"bg-muted/30"),children:"break"===e.type?(0,a.jsx)(o.A,{className:"w-5 h-5 mx-auto text-muted-foreground"}):(0,a.jsxs)("div",{className:"flex flex-col items-stretch gap-1.5 justify-start h-full",children:[g&&g.map((e,s)=>{let{teacher:t,lesson:r}=e;return(0,a.jsxs)("div",{className:"text-center p-2 rounded-md bg-destructive/10 text-destructive border border-destructive/20",children:[(0,a.jsxs)("div",{className:"font-bold text-xs flex items-center justify-center gap-1.5",children:[(0,a.jsx)(u.A,{className:"h-3.5 w-3.5"}),"דרוש מחליף"]}),(0,a.jsxs)("div",{className:"text-xs opacity-80",children:["(",t.name,")"]})]},"".concat(t.id,"-").concat(s))}),v.map(e=>(0,a.jsxs)(l.E,{variant:"secondary",className:"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300 font-normal",children:[(0,a.jsx)(m.A,{className:"h-3 w-3 ml-1"}),e.substituteTeacherName]},e.id)),(0,a.jsx)("div",{className:"flex flex-wrap items-center justify-center gap-1.5 mt-auto",children:n.map(s=>(0,a.jsxs)(w.$,{variant:s.isInSchool?"secondary":"outline",size:"sm",className:"h-auto px-2 py-1 font-normal text-xs",onClick:()=>q(s,t,e.start),children:[!s.isInSchool&&(0,a.jsx)(h,{className:"h-3 w-3 ml-1 text-muted-foreground"}),s.name]},s.id))}),0===n.length&&(!g||0===g.length)&&0===v.length&&(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)("span",{className:"text-muted-foreground text-xs opacity-70",children:"--"})})]})},"".concat(t,"-").concat(e.start))})]},e.id))})]})}),(0,a.jsx)(i.$,{orientation:"horizontal"})]}),(0,a.jsxs)("div",{className:"md:hidden space-y-4",children:[(0,a.jsx)("div",{className:"flex overflow-x-auto pb-2 gap-2 no-scrollbar",children:c.B.map((e,s)=>{let t=(0,p.f)(z,s);return new Date().getDay(),(0,a.jsxs)(w.$,{variant:D===e?"default":"outline",className:"flex-shrink-0 flex flex-col items-center h-auto py-2 px-4",onClick:()=>T(e),children:[(0,a.jsx)("span",{className:"font-bold",children:e}),(0,a.jsx)("span",{className:"text-xs font-normal opacity-70",children:(0,v.GP)(t,"dd/MM")})]},e)})}),(0,a.jsx)("div",{className:"space-y-4",children:J.map(e=>{var t;let r=(null==(t=$[D])?void 0:t[e.start])||[],n=c.B.indexOf(D),i=(0,p.f)(z,n),d=(s||[]).filter(s=>(0,j.r)((0,f.o)(new Date(s.date)),i)&&s.time===e.start),u=H.get("".concat(D,"-").concat(e.start)),x=null==u?void 0:u.filter(e=>!d.some(s=>s.absentTeacherId===e.teacher.id&&s.classId===e.lesson.classId));return(0,a.jsxs)("div",{className:"border rounded-lg p-4 bg-card",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,a.jsxs)("span",{className:"font-semibold text-lg",children:[e.start," - ",e.end]}),"break"===e.type&&(0,a.jsx)(l.E,{variant:"outline",children:"הפסקה"})]}),"break"!==e.type&&(0,a.jsxs)("div",{className:"space-y-3",children:[x&&x.length>0&&(0,a.jsx)("div",{className:"space-y-2",children:x.map((e,s)=>{let{teacher:t,lesson:r}=e;return(0,a.jsxs)("div",{className:"flex items-center justify-between p-2 rounded-md bg-destructive/10 text-destructive border border-destructive/20",children:[(0,a.jsxs)("span",{className:"text-sm font-medium",children:["דרוש מחליף: ",t.name]}),(0,a.jsx)("span",{className:"text-xs opacity-80",children:r.subject})]},"".concat(t.id,"-").concat(s))})}),d.length>0&&(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:d.map(e=>(0,a.jsxs)(l.E,{variant:"secondary",className:"bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-300",children:[(0,a.jsx)(m.A,{className:"h-3 w-3 ml-1"}),e.substituteTeacherName]},e.id))}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground mb-2",children:"מורים פנויים:"}),r.length>0?(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:r.map(s=>(0,a.jsxs)(w.$,{variant:s.isInSchool?"secondary":"outline",size:"sm",className:"h-auto px-2 py-1 text-xs",onClick:()=>q(s,D,e.start),children:[!s.isInSchool&&(0,a.jsx)(h,{className:"h-3 w-3 ml-1 text-muted-foreground"}),s.name]},s.id))}):(0,a.jsx)("span",{className:"text-sm text-muted-foreground italic",children:"אין מורים פנויים"})]})]}),"break"===e.type&&(0,a.jsx)("div",{className:"flex justify-center py-2",children:(0,a.jsx)(o.A,{className:"h-6 w-6 text-muted-foreground opacity-50"})})]},e.id)})})]})]})]}),(0,a.jsx)(ec,{isOpen:I.isOpen,onOpenChange:e=>E(s=>({...s,isOpen:e,substitute:e?s.substitute:null,lessonsToCover:e?s.lessonsToCover:[]})),substitute:I.substitute,lessonsToCover:I.lessonsToCover,onConfirm:V})]})}},86578:(e,s,t)=>{t.d(s,{A:()=>a});let a=(0,t(40157).A)("Coffee",[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]])}}]);