(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{5062:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>eI});var a=s(95155),r=s(12115),n=s(55028),l=s(87267),i=s(50172),d=s(33349),o=s(36936),c=s(68027),m=s(51362),u=s(30285),x=s(44838);function f(){let{setTheme:e}=(0,m.D)();return(0,a.jsxs)(x.rI,{children:[(0,a.jsx)(x.ty,{asChild:!0,children:(0,a.jsxs)(u.$,{variant:"ghost",size:"icon",children:[(0,a.jsx)(o.A,{className:"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),(0,a.jsx)(c.A,{className:"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),(0,a.jsx)("span",{className:"sr-only",children:"Toggle theme"})]})}),(0,a.jsxs)(x.SQ,{align:"end",children:[(0,a.jsx)(x._2,{onClick:()=>e("light"),children:"בהיר"}),(0,a.jsx)(x._2,{onClick:()=>e("dark"),children:"כהה"}),(0,a.jsx)(x._2,{onClick:()=>e("system"),children:"מערכת"})]})]})}var h=s(19599),p=s(59434);function g(){let e=(0,h.useAuth)(),{user:t,isUserLoading:s}=(0,h.useUser)(),[n,o]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{let e=()=>{o(window.scrollY>10)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]),(0,a.jsx)("header",{className:(0,p.cn)("sticky top-0 z-50 transition-all duration-300",n?"bg-card/80 backdrop-blur-sm border-b":"bg-transparent border-b border-transparent"),children:(0,a.jsx)("div",{className:"container mx-auto px-4 py-3 sm:px-6 md:px-8",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(l.A,{className:"h-7 w-7 text-primary"}),(0,a.jsx)("h1",{className:"text-xl font-bold tracking-tight text-foreground",children:"מורה מחליף"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[s?(0,a.jsx)(i.A,{className:"h-5 w-5 animate-spin"}):t?(0,a.jsx)(u.$,{variant:"ghost",size:"icon",onClick:()=>null==e?void 0:e.signOut(),children:(0,a.jsx)(d.A,{className:"h-5 w-5"})}):null,(0,a.jsx)(f,{})]})]})})})}var b=s(35695),j=s(35317),y=s(19114),N=s(38274),v=s(23769),w=s(31949),k=s(18763),A=s(8376),P=s(63920),C=s(11698),I=s(66695),_=s(80644),T=s(76959),R=s(83013),D=s(46375),E=s(55594),M=s(62177),S=s(90221),z=s(83343),G=s(54165),O=s(17759),F=s(62523),L=s(87481),V=s(51920),J=s(37648),B=s(77223),$=s(58127),H=s(85511),U=s(47906),Z=s(47262),W=s(66424),Y=s(33143);let q=/^(0[0-9]|1[0-9]|2[0-3]):[0-5][0-9]$/,Q=E.z.object({date:E.z.date(),isAllDay:E.z.boolean(),startTime:E.z.string().regex(q,{message:"פורמט זמן לא חוקי (HH:mm)."}),endTime:E.z.string().regex(q,{message:"פורמט זמן לא חוקי (HH:mm)."})}),X=E.z.object({absencePeriods:E.z.array(Q).min(1,"יש לבחור לפחות תאריך אחד."),reason:E.z.string().optional()}).refine(e=>{for(let t of e.absencePeriods)if(!t.isAllDay&&new Date("1970-01-01T".concat(t.startTime,":00"))>=new Date("1970-01-01T".concat(t.endTime,":00")))return!1;return!0},{message:"שעת הסיום חייבת להיות אחרי שעת ההתחלה.",path:["absencePeriods"]});function K(e){var t,s;let{isOpen:n,onOpenChange:l,teacher:d,existingAbsences:o,onConfirm:c}=e,{toast:m}=(0,L.dj)(),x=(0,U.a)(),[f,h]=(0,r.useState)(!1),[g,b]=(0,r.useState)(!1),j=!!o&&o.length>0,y=(0,M.mN)({resolver:(0,S.u)(X),defaultValues:{reason:"",absencePeriods:[]}}),N=(0,r.useMemo)(()=>y.watch("absencePeriods").map(e=>e.date),[y.watch("absencePeriods")]),v=e=>{let t=y.getValues("absencePeriods").filter(t=>!(0,T.r)(t.date,e));y.setValue("absencePeriods",t,{shouldValidate:!0})};if((0,r.useEffect)(()=>{if(n)if(j&&o){let e=o.map(e=>({date:"string"==typeof e.date?(0,_.o)((0,z.H)(e.date)):(0,_.o)(e.date),isAllDay:e.isAllDay,startTime:e.startTime,endTime:e.endTime}));y.reset({reason:"",absencePeriods:e})}else y.reset({reason:"",absencePeriods:[]});else y.reset({reason:"",absencePeriods:[]}),h(!1),b(!1)},[n,j,o,y]),!d)return null;let w=async e=>{h(!0);try{let t=e.absencePeriods.map(e=>({...e,id:Math.random().toString(36).substring(2,9)}));await c(d,t),b(!0),setTimeout(()=>{l(!1),b(!1)},2e3)}catch(e){console.error("שגיאה ברישום היעדרות:",e),m({variant:"destructive",title:"שגיאה",description:"לא ניתן היה לרשום את ההיעדרות. אנא נסה שוב."})}finally{h(!1)}},k=y.watch("absencePeriods"),A=x?"div":W.F;return g?(0,a.jsx)(G.lG,{open:n,onOpenChange:l,children:(0,a.jsx)(G.Cf,{className:"sm:max-w-md",children:(0,a.jsx)(Y._,{message:j?"ההיעדרות עודכנה בהצלחה!":"ההיעדרות נרשמה בהצלחה!"})})}):(0,a.jsx)(G.lG,{open:n,onOpenChange:l,children:(0,a.jsxs)(G.Cf,{className:"sm:max-w-4xl h-[80vh] flex flex-col p-0 gap-0 overflow-hidden",children:[(0,a.jsxs)(G.c7,{className:"p-6 pb-2",children:[(0,a.jsx)(G.L3,{className:"text-2xl",children:j?"עריכת היעדרות: ".concat(d.name):"רישום היעדרות: ".concat(d.name)}),(0,a.jsx)(G.rr,{children:"בחר תאריכים בלוח השנה והגדר את שעות ההיעדרות לכל יום."})]}),(0,a.jsx)(O.lV,{...y,children:(0,a.jsxs)("form",{onSubmit:y.handleSubmit(w),className:"flex-1 flex flex-col overflow-hidden",children:[(0,a.jsxs)("div",{className:(0,p.cn)("flex-1 flex flex-col md:flex-row",x?"overflow-y-auto":"overflow-hidden"),children:[(0,a.jsxs)("div",{className:"p-6 pt-2 border-b md:border-b-0 md:border-l flex flex-col items-center justify-start bg-muted/10 shrink-0",children:[(0,a.jsxs)("h3",{className:"font-medium mb-4 self-start flex items-center gap-2",children:[(0,a.jsx)(V.A,{className:"w-4 h-4 text-primary"}),"בחירת תאריכים"]}),(0,a.jsx)(W.F,{className:"h-[360px]",children:(0,a.jsx)(H.V,{mode:"multiple",selected:N,onSelect:e=>{if(!e)return void y.setValue("absencePeriods",[]);let t=y.getValues("absencePeriods"),s=e.map(e=>{let s=t.find(t=>(0,T.r)(t.date,e));return s||{date:(0,_.o)(e),isAllDay:!0,startTime:"08:00",endTime:"16:00"}});s.sort((e,t)=>e.date.getTime()-t.date.getTime()),y.setValue("absencePeriods",s,{shouldValidate:!0})},className:"rounded-md border shadow bg-card",locale:D.he})}),(0,a.jsx)("div",{className:"mt-4 text-sm text-muted-foreground text-center",children:0===N.length?"לא נבחרו תאריכים":"נבחרו ".concat(N.length," ימים")})]}),(0,a.jsxs)("div",{className:(0,p.cn)("flex-1 flex flex-col p-6 pt-2 bg-background",x?"":"overflow-hidden"),children:[(0,a.jsxs)("h3",{className:"font-medium mb-4 flex items-center gap-2",children:[(0,a.jsx)(J.A,{className:"w-4 h-4 text-primary"}),"פרטי היעדרות"]}),(0,a.jsx)(A,{className:(0,p.cn)("flex-1",x?"":"-mr-4 pr-4"),children:0===k.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 text-muted-foreground border-2 border-dashed rounded-xl",children:[(0,a.jsx)(V.A,{className:"h-10 w-10 mb-2 opacity-20"}),(0,a.jsx)("p",{children:"אנא בחר תאריכים מלוח השנה"})]}):(0,a.jsx)("div",{className:"space-y-3 pb-4",children:k.map((e,t)=>(0,a.jsx)(I.Zp,{className:"overflow-hidden border shadow-sm transition-all hover:shadow-md",children:(0,a.jsx)(I.Wu,{className:"p-0",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center",children:[(0,a.jsxs)("div",{className:"bg-muted/30 p-3 sm:w-40 flex flex-row sm:flex-col items-center justify-between sm:justify-center border-b sm:border-b-0 sm:border-l gap-2",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"font-bold text-lg text-primary",children:(0,R.GP)(e.date,"dd/MM")}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:(0,R.GP)(e.date,"EEEE",{locale:D.he})})]}),(0,a.jsx)(u.$,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive sm:hidden",onClick:()=>v(e.date),children:(0,a.jsx)(B.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"flex-1 p-3 flex flex-col gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(O.zB,{control:y.control,name:"absencePeriods.".concat(t,".isAllDay"),render:e=>{let{field:t}=e;return(0,a.jsxs)(O.eI,{className:"flex flex-row items-center space-x-2 space-x-reverse space-y-0",children:[(0,a.jsx)(O.MJ,{children:(0,a.jsx)(Z.S,{checked:t.value,onCheckedChange:t.onChange})}),(0,a.jsx)(O.lR,{className:"font-medium cursor-pointer text-sm",children:"יום שלם"})]})}}),(0,a.jsx)(u.$,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive hidden sm:flex",onClick:()=>v(e.date),children:(0,a.jsx)(B.A,{className:"h-4 w-4"})})]}),!e.isAllDay&&(0,a.jsxs)("div",{className:"flex items-center gap-2 animate-in fade-in slide-in-from-top-1 duration-200",children:[(0,a.jsx)(O.zB,{control:y.control,name:"absencePeriods.".concat(t,".startTime"),render:e=>{let{field:t}=e;return(0,a.jsxs)(O.eI,{className:"flex-1 space-y-1",children:[(0,a.jsx)(O.lR,{className:"text-xs text-muted-foreground",children:"התחלה"}),(0,a.jsx)(O.MJ,{children:(0,a.jsx)(F.p,{type:"time",className:"h-8 text-sm",...t})}),(0,a.jsx)(O.C5,{className:"text-[10px]"})]})}}),(0,a.jsx)("span",{className:"text-muted-foreground mt-4",children:"-"}),(0,a.jsx)(O.zB,{control:y.control,name:"absencePeriods.".concat(t,".endTime"),render:e=>{let{field:t}=e;return(0,a.jsxs)(O.eI,{className:"flex-1 space-y-1",children:[(0,a.jsx)(O.lR,{className:"text-xs text-muted-foreground",children:"סיום"}),(0,a.jsx)(O.MJ,{children:(0,a.jsx)(F.p,{type:"time",className:"h-8 text-sm",...t})}),(0,a.jsx)(O.C5,{className:"text-[10px]"})]})}})]})]})]})})},e.date.toISOString()))})}),(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t space-y-4",children:[(0,a.jsx)(O.zB,{control:y.control,name:"reason",render:e=>{let{field:t}=e;return(0,a.jsxs)(O.eI,{children:[(0,a.jsx)(O.lR,{children:"סיבה (אופציונלי)"}),(0,a.jsx)(O.MJ,{children:(0,a.jsx)(F.p,{placeholder:"למשל, מחלה, מילואים...",...t})}),(0,a.jsx)(O.C5,{})]})}}),y.formState.errors.absencePeriods&&(0,a.jsxs)("div",{className:"p-3 rounded-md bg-destructive/10 text-destructive text-sm flex items-center gap-2",children:[(0,a.jsx)($.A,{className:"h-4 w-4 rotate-45"}),y.formState.errors.absencePeriods.message||(null==(s=y.formState.errors.absencePeriods)||null==(t=s.root)?void 0:t.message)]})]})]})]}),(0,a.jsxs)(G.Es,{className:"p-6 pt-4 border-t bg-muted/5",children:[(0,a.jsx)(G.HM,{asChild:!0,children:(0,a.jsx)(u.$,{type:"button",variant:"outline",children:"ביטול"})}),(0,a.jsx)(u.$,{type:"submit",disabled:f||0===k.length,children:f?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.A,{className:"ml-2 h-4 w-4 animate-spin"}),j?"מעדכן...":"רושם היעדרות..."]}):j?"שמור שינויים":"אשר ורשום היעדרות"})]})]})})]})})}var ee=s(79233),et=s(22346),es=s(98328),ea=s(50286),er=s(57804),en=s(19968),el=s(17569),ei=s(74651),ed=s.n(ei),eo=s(37250),ec=s(79556);let em=eo.bL,eu=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(eo.q7,{ref:t,className:(0,p.cn)("border-b",s),...r})});eu.displayName="AccordionItem";let ex=r.forwardRef((e,t)=>{let{className:s,children:r,...n}=e;return(0,a.jsx)(eo.Y9,{className:"flex",children:(0,a.jsxs)(eo.l9,{ref:t,className:(0,p.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",s),...n,children:[r,(0,a.jsx)(ec.A,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})})});ex.displayName=eo.l9.displayName;let ef=r.forwardRef((e,t)=>{let{className:s,children:r,...n}=e;return(0,a.jsx)(eo.UC,{ref:t,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...n,children:(0,a.jsx)("div",{className:(0,p.cn)("pb-4 pt-0",s),children:r})})});ef.displayName=eo.UC.displayName;var eh=s(26126),ep=s(91950);function eg(e){let{isOpen:t,onOpenChange:s,recommendationResult:r,onConfirm:n}=e;if(!r)return null;let{results:l,absentTeacher:i,absenceDays:d}=r,o=ed()(l,e=>ep.B[(0,ee.P)(e.date)]),c=ep.B.filter(e=>o[e]);return(0,a.jsx)(G.lG,{open:t,onOpenChange:s,children:(0,a.jsxs)(G.Cf,{className:"max-w-lg md:max-w-2xl",children:[(0,a.jsxs)(G.c7,{children:[(0,a.jsxs)(G.L3,{children:["שיעורים מושפעים עבור ",i.name]}),(0,a.jsx)(G.rr,{children:'להלן השיעורים המושפעים מההיעדרות. לחץ על "אישור" כדי לעבור לטבלת הזמינות ולשבץ מחליפים.'})]}),(0,a.jsx)(W.F,{className:"py-2 max-h-[60vh] overflow-y-auto pr-4 -mr-4",children:(0,a.jsx)(em,{type:"multiple",className:"w-full",defaultValue:c.map(e=>"day-".concat(e)),children:c.map(e=>(0,a.jsxs)(eu,{value:"day-".concat(e),children:[(0,a.jsx)(ex,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(es.A,{className:"h-5 w-5 text-primary"}),(0,a.jsxs)("span",{className:"font-semibold",children:["יום ",e]}),(0,a.jsxs)(eh.E,{variant:"secondary",children:[o[e].length," שיעורים"]})]})}),(0,a.jsx)(ef,{children:(0,a.jsx)("div",{className:"space-y-4 p-2",children:o[e].map((e,t)=>{var s;let r=null==(s=e.substituteOptions)?void 0:s.find(t=>t.id===e.recommendationId);return(0,a.jsxs)("div",{className:"p-3 border rounded-lg bg-card",children:[(0,a.jsxs)("div",{className:"font-semibold flex flex-col sm:flex-row items-start sm:items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(ea.A,{className:"ml-2 h-4 w-4 text-muted-foreground"}),(0,a.jsxs)("span",{children:["כיתה ",e.className]})]}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground font-normal mt-1 sm:mt-0",children:[e.lesson.subject," בשעה ",e.time]})]}),(0,a.jsx)(et.w,{className:"my-2"}),(0,a.jsxs)("div",{className:"grid grid-cols-[1fr_auto_1fr] items-center gap-2 sm:gap-4 text-center",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center p-2 rounded-md bg-secondary/50",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"מחליף מומלץ"}),r?(0,a.jsxs)("p",{className:"font-bold text-primary flex items-center justify-center gap-2 mt-1",children:[(0,a.jsx)(er.A,{className:"h-4 w-4"}),r.name]}):(0,a.jsx)("p",{className:"font-bold text-muted-foreground mt-1",children:"אין מחליף"})]}),(0,a.jsx)(en.A,{className:"h-4 w-4 text-muted-foreground mx-auto my-2 sm:my-0"}),(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"מורה מקורי"}),(0,a.jsx)("p",{className:"font-bold text-destructive/80 flex items-center justify-center gap-2 mt-1",children:i.name})]})]}),r&&e.reasoning&&(0,a.jsxs)("div",{className:"mt-3 p-2 rounded-md bg-green-50 dark:bg-green-900/20 text-green-800 dark:text-green-300 text-xs flex items-start gap-2 text-right",children:[(0,a.jsx)(el.A,{className:"h-4 w-4 shrink-0 mt-0.5 ml-1"}),(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{children:"נימוק:"})," ",e.reasoning]})]})]},t)})})})]},e))})}),(0,a.jsxs)(G.Es,{children:[(0,a.jsx)(G.HM,{asChild:!0,children:(0,a.jsx)(u.$,{type:"button",variant:"secondary",children:"ביטול"})}),(0,a.jsx)(u.$,{type:"button",onClick:n,children:"אישור"})]})]})})}var eb=s(97714),ej=s(40688);let ey=(0,n.default)(()=>Promise.all([s.e(445),s.e(607),s.e(343),s.e(36)]).then(s.bind(s,13036)),{loadableGenerated:{webpack:()=>[13036]},loading:()=>(0,a.jsx)("div",{className:"p-4 flex justify-center",children:(0,a.jsx)(i.A,{className:"h-8 w-8 animate-spin text-primary"})})}),eN=(0,n.default)(()=>s.e(72).then(s.bind(s,30072)),{loadableGenerated:{webpack:()=>[30072]},loading:()=>(0,a.jsx)("div",{className:"p-4 flex justify-center",children:(0,a.jsx)(i.A,{className:"h-8 w-8 animate-spin text-primary"})})}),ev=(0,n.default)(()=>Promise.all([s.e(445),s.e(607),s.e(725),s.e(28),s.e(781)]).then(s.bind(s,59781)),{loadableGenerated:{webpack:()=>[59781]},loading:()=>(0,a.jsx)("div",{className:"p-4 flex justify-center",children:(0,a.jsx)(i.A,{className:"h-8 w-8 animate-spin text-primary"})})}),ew=(0,n.default)(()=>Promise.all([s.e(445),s.e(957)]).then(s.bind(s,62957)),{loadableGenerated:{webpack:()=>[62957]},loading:()=>(0,a.jsx)("div",{className:"p-4 flex justify-center",children:(0,a.jsx)(i.A,{className:"h-8 w-8 animate-spin text-primary"})})}),ek=(0,n.default)(()=>Promise.all([s.e(445),s.e(607),s.e(28),s.e(767)]).then(s.bind(s,73028)),{loadableGenerated:{webpack:()=>[73028]},loading:()=>null}),eA=(0,n.default)(()=>Promise.all([s.e(445),s.e(806)]).then(s.bind(s,64806)),{loadableGenerated:{webpack:()=>[64806]},loading:()=>(0,a.jsx)("div",{className:"p-4 flex justify-center",children:(0,a.jsx)(i.A,{className:"h-8 w-8 animate-spin text-primary"})})}),eP=(0,n.default)(()=>s.e(737).then(s.bind(s,86737)),{loadableGenerated:{webpack:()=>[86737]},loading:()=>(0,a.jsx)("div",{className:"p-4 flex justify-center",children:(0,a.jsx)(i.A,{className:"h-8 w-8 animate-spin text-primary"})})});(0,n.default)(()=>Promise.all([s.e(445),s.e(632)]).then(s.bind(s,32632)),{loadableGenerated:{webpack:()=>[32632]},loading:()=>(0,a.jsx)("div",{className:"p-4 flex justify-center",children:(0,a.jsx)(i.A,{className:"h-8 w-8 animate-spin text-primary"})})});let eC=(0,n.default)(()=>s.e(798).then(s.bind(s,50798)),{loadableGenerated:{webpack:()=>[50798]},loading:()=>(0,a.jsx)("div",{className:"p-4 flex justify-center",children:(0,a.jsx)(i.A,{className:"h-8 w-8 animate-spin text-primary"})})});function eI(){var e;let{user:t,isUserLoading:s}=(0,h.useUser)(),n=(0,b.useRouter)(),l=(0,h.useFirestore)(),{toast:d}=(0,L.dj)(),[o,c]=(0,r.useState)("teachers"),[m,x]=(0,r.useState)(null),[f,E]=(0,r.useState)(null),[M,S]=(0,r.useState)(null),z=(0,h.useMemoFirebase)(()=>t?(0,j.P)((0,j.rJ)(l,"teachers"),(0,j._M)("userId","==",t.uid)):null,[t,l]),{data:G,isLoading:O}=(0,v.G)(z),F=G||[],V=(0,h.useMemoFirebase)(()=>t?(0,j.P)((0,j.rJ)(l,"classes"),(0,j._M)("userId","==",t.uid)):null,[t,l]),{data:J,isLoading:B}=(0,v.G)(V),$=J||[],H=(0,h.useMemoFirebase)(()=>t?(0,j.P)((0,j.rJ)(l,"substitutions"),(0,j._M)("userId","==",t.uid)):null,[t,l]),{data:U,isLoading:Z}=(0,v.G)(H),W=U||[],Y=(0,h.useMemoFirebase)(()=>t?(0,j.P)((0,j.rJ)(l,"settings"),(0,j._M)("userId","==",t.uid)):null,[t,l]),{data:q,isLoading:Q}=(0,v.G)(Y),X=(0,r.useMemo)(()=>{if(q){let e=q.find(e=>e.id==="timetable_".concat(null==t?void 0:t.uid));if(e)return e.slots||[]}return[]},[q,t]);(0,r.useEffect)(()=>{s||t||n.push("/login")},[t,s,n]);let ee=e=>{if(!e||"string"!=typeof e||!e.includes(":"))return 0;let[t,s]=e.split(":").map(Number);return t+s/60},et=(0,r.useMemo)(()=>{let e=(0,_.o)(new Date);return F&&0!==F.length&&X&&0!==X.length?F.map(t=>{var s;let a=(t.absences||[]).filter(t=>{try{let s="string"==typeof t.date?new Date(t.date):t.date;return(0,T.r)((0,_.o)(s),e)}catch(e){return console.error("Error parsing absence date:",t.date),!1}});if(0===a.length)return null;let r=ep.B[e.getDay()],n=Object.entries((null==(s=t.schedule)?void 0:s[r])||{}).flatMap(s=>{let[r,n]=s,l=Array.isArray(n)?n:n?[n]:[];return l&&0!==l.length?l.map(s=>{if(s&&s.classId){let n=X.find(e=>e.start===r);if(!n)return null;if(a.some(e=>{if(e.isAllDay)return!0;let t=ee(n.start),s=ee(n.end),a=ee(e.startTime);return t<ee(e.endTime)&&s>a})){let a=$.find(e=>e.id===s.classId);if(a){let n=(W||[]).some(t=>(0,T.r)((0,_.o)(new Date(t.date)),e)&&t.time===r&&t.classId===s.classId);return{...s,time:r,className:a.name,isCovered:n,absentTeacherName:t.name}}}}return null}).filter(Boolean):[]});return{teacher:t,absences:a,affectedLessons:n}}).filter(e=>null!==e&&e.absences.length>0):[]},[F,$,W,X]),es=(0,r.useMemo)(()=>{let e=(0,_.o)(new Date),t=new Map;return et.forEach(s=>{var a;let{teacher:r,absences:n}=s,l=ep.B[e.getDay()];Object.entries((null==(a=r.schedule)?void 0:a[l])||{}).forEach(e=>{let[s,a]=e,l=Array.isArray(a)?a:a?[a]:[];l&&0!==l.length&&l.forEach(e=>{if(!e||!e.classId)return;let a=X.find(e=>e.start===s);if(a&&n.some(e=>{if(e.isAllDay)return!0;let t=ee(a.start),s=ee(a.end),r=ee(e.startTime);return t<ee(e.endTime)&&s>r})){let a=($||[]).find(t=>t.id===e.classId);a&&(t.has(a.id)||t.set(a.id,{classId:a.id,className:a.name,lessons:[]}),t.get(a.id).lessons.push({...e,time:s,absentTeacherName:r.name}))}})})}),Array.from(t.values()).map(t=>{let s=t.lessons.filter(t=>!(W||[]).some(s=>(0,T.r)((0,_.o)(new Date(s.date)),e)&&s.time===t.time&&s.classId===t.classId));return{...t,isFullyCovered:0===s.length,lessons:s}})},[et,$,W,X]),ea=async e=>{if(!l||!t)return;let s=(0,j.H9)(l,"settings","timetable_".concat(t.uid)),a={slots:e,userId:t.uid},r=(0,j.wP)(l);r.set(s,a,{merge:!0});try{await (0,eb.j)(r,{operation:"update",path:s.path,data:a})}catch(e){console.error("Failed to update timetable settings.",e)}},er=async()=>{if(!l||!t)return;let e=(0,j.wP)(l);try{let s=(0,j.P)((0,j.rJ)(l,"teachers"),(0,j._M)("userId","==",t.uid)),a=(0,j.P)((0,j.rJ)(l,"classes"),(0,j._M)("userId","==",t.uid)),r=(0,j.P)((0,j.rJ)(l,"substitutions"),(0,j._M)("userId","==",t.uid)),n=(0,j.P)((0,j.rJ)(l,"majors"),(0,j._M)("userId","==",t.uid)),[i,o,c,m]=await Promise.all([(0,j.GG)(s),(0,j.GG)(a),(0,j.GG)(r),(0,j.GG)(n)]);i.forEach(t=>{e.update(t.ref,{schedule:{},absences:[]})}),o.forEach(t=>{e.update(t.ref,{schedule:{}})}),c.forEach(t=>{e.delete(t.ref)}),m.forEach(t=>{e.delete(t.ref)}),await (0,eb.j)(e,{operation:"delete",path:"user_data/".concat(t.uid,"/new_year_reset")}),d({title:"השנה החדשה החלה!",description:"כל מערכות השעות, ההיעדרויות וההחלפות אופסו."})}catch(e){console.error("Failed to start new year:",e),d({variant:"destructive",title:"שגיאה",description:"לא ניתן היה לאפס את נתוני השנה. אנא נסה שוב."})}},en=(e,t,s,a,r)=>{let n=[],l=[],i=a.filter(t=>t.id!==e.id);return t.forEach(t=>{let a=(0,_.o)(new Date(t.date)),d=(0,R.GP)(a,"EEEE",{locale:D.he});s.forEach(o=>{var c;let m=null==(c=o.schedule)?void 0:c[d];m&&Object.entries(m).forEach(d=>{let[c,m]=d;(Array.isArray(m)?m:m?[m]:[]).forEach(d=>{if((null==d?void 0:d.teacherId)===e.id){let e=r.find(e=>e.start===c);if(e&&(t.isAllDay||ee(e.start)<ee(t.endTime)&&ee(e.end)>ee(t.startTime))){let e=(0,ej.o0)({subject:d.subject,date:a,time:c},i,s,r).then(e=>{n.push({classId:o.id,className:o.name,date:a,time:c,lesson:d,recommendation:e.recommendation,recommendationId:e.recommendationId,reasoning:e.reasoning,substituteOptions:e.substituteOptions})});l.push(e)}}})})})}),Promise.all(l).then(()=>n)},el=async(e,s)=>{if(!l||!t)return;let a=(0,j.wP)(l),r=(0,j.H9)(l,"teachers",e.id),n=new Set(s.map(e=>(0,_.o)(new Date(e.date)).getTime())),i=(e.absences||[]).filter(e=>{let t;try{if(t="string"==typeof e.date?new Date(e.date):e.date,isNaN(t.getTime()))return!0}catch(e){return!0}return!n.has((0,_.o)(t).getTime())}),d=s.map(e=>({...e,date:(0,_.o)(new Date(e.date)).toISOString()}));a.update(r,{absences:[...i,...d]}),await (0,eb.j)(a,{operation:"update",path:r.path,data:{absences:"..."}});let o=$||[],c=await en(e,d,o,F||[],X);c.length>0?S({results:c,absentTeacher:e,absenceDays:d}):S(null)},ei=async e=>{if(!e||!F||!X)return;let t=F.filter(t=>t.id!==e.absentTeacherId),s=(0,_.o)(new Date(e.date));try{let a=await (0,ej.o0)({subject:e.subject,date:s,time:e.time},t,$,X);S({results:[{classId:e.classId,className:e.className,date:s,time:e.time,lesson:{...e,teacherId:e.absentTeacherId},recommendation:a.recommendation,recommendationId:a.recommendationId,reasoning:a.reasoning,substituteOptions:a.substituteOptions}],absentTeacher:F.find(t=>t.id===e.absentTeacherId),absenceDays:[{date:s.toISOString(),startTime:"08:00",endTime:"16:00",isAllDay:!0,reason:"Generated from panel"}]})}catch(e){console.error("Error finding substitute:",e),d({variant:"destructive",title:"שגיאה",description:"אירעה שגיאה בחיפוש מחליף."})}};if(s||O||Q||B||Z)return(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-background",children:(0,a.jsx)(i.A,{className:"h-10 w-10 animate-spin text-primary"})});let ed=!s&&!Q&&t&&0===X.length;return ed?(0,a.jsxs)("div",{className:"flex flex-col min-h-screen bg-background",children:[(0,a.jsx)(g,{}),(0,a.jsx)("main",{className:"flex-1 p-4 sm:p-6 md:p-8",children:(0,a.jsx)(ew,{timeSlots:[],onUpdate:ea,isInitialSetup:ed,onStartNewYear:er})})]}):(0,a.jsxs)("div",{className:"flex flex-col min-h-screen bg-background",children:[(0,a.jsx)(g,{}),(0,a.jsxs)("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-6",children:[et&&et.length>0&&(0,a.jsxs)(I.Zp,{className:"border-l-4 border-l-destructive shadow-md",children:[(0,a.jsxs)(I.aR,{className:"pb-3",children:[(0,a.jsxs)(I.ZB,{className:"text-xl flex items-center gap-2",children:[(0,a.jsx)(w.A,{className:"text-destructive h-5 w-5"}),"מורים חסרים היום"]}),(0,a.jsx)(I.BT,{children:"סקירה מהירה של ההיעדרויות והשיעורים המושפעים להיום."})]}),(0,a.jsx)(I.Wu,{children:(0,a.jsx)("div",{className:"grid gap-4 sm:grid-cols-1 lg:grid-cols-2",children:et.map(e=>{if(!e)return null;let{teacher:t,absences:s,affectedLessons:r}=e,n=s.map(e=>e.isAllDay?"יום שלם":"".concat(e.startTime,"-").concat(e.endTime)).join("; ");return(0,a.jsxs)("div",{className:"flex flex-col justify-between p-4 bg-secondary/30 rounded-xl border",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("span",{className:"font-semibold text-lg block",children:t.name}),(0,a.jsx)("div",{className:"text-xs text-center text-destructive-foreground bg-destructive/80 rounded-md px-2 py-1 font-medium inline-block mt-1",children:n})]}),(0,a.jsxs)(u.$,{variant:"ghost",size:"sm",className:"h-8 -mr-2",onClick:()=>x({teacher:t,existingAbsences:s}),children:[(0,a.jsx)(k.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"mr-1",children:"ערוך"})]})]}),r.length>0&&(0,a.jsxs)("div",{className:"mt-3 space-y-2 text-sm",children:[(0,a.jsx)("h4",{className:"font-medium text-muted-foreground",children:"שיעורים מושפעים:"}),(0,a.jsx)("ul",{className:"space-y-1",children:r.map((e,t)=>(0,a.jsxs)("li",{className:"flex items-center justify-between",children:[(0,a.jsxs)("span",{children:[e.className," - ",e.subject," (",e.time,")"]}),e.isCovered?(0,a.jsxs)("span",{className:"flex items-center text-green-600 dark:text-green-400",children:[(0,a.jsx)(A.A,{className:"ml-1 h-4 w-4"}),"מכוסה"]}):(0,a.jsxs)("span",{className:"flex items-center text-destructive",children:[(0,a.jsx)(P.A,{className:"ml-1 h-4 w-4"}),"דרוש מחליף"]})]},t))})]})]},t.id)})})})]}),es.length>0&&(0,a.jsxs)(I.Zp,{className:"border-l-4 border-l-amber-500 shadow-md",children:[(0,a.jsxs)(I.aR,{className:"pb-3",children:[(0,a.jsxs)(I.ZB,{className:"text-xl flex items-center gap-2",children:[(0,a.jsx)(C.A,{className:"text-amber-500 h-5 w-5"}),"כיתות דורשות שיבוץ"]}),(0,a.jsx)(I.BT,{children:"כיתות עם שיעורים לא מכוסים להיום. לחץ על כיתה לצפייה במערכת."})]}),(0,a.jsx)(I.Wu,{children:(0,a.jsx)("div",{className:"grid gap-4 sm:grid-cols-1 lg:grid-cols-2",children:es.map(e=>{let{classId:t,className:s,lessons:r,isFullyCovered:n}=e,l=($||[]).find(e=>e.id===t);return(0,a.jsxs)("div",{className:(0,p.cn)("flex flex-col justify-between p-4 rounded-xl border-2 transition-colors hover:bg-secondary/50 cursor-pointer",n?"border-green-500/50 bg-green-500/5":"border-destructive/50 bg-destructive/5"),onClick:()=>l&&E(l),children:[(0,a.jsx)("span",{className:"font-semibold text-lg block",children:s}),n?(0,a.jsxs)("div",{className:"mt-3 flex items-center gap-2 text-green-600 dark:text-green-400",children:[(0,a.jsx)(A.A,{className:"h-5 w-5"}),(0,a.jsx)("span",{className:"font-medium",children:"כל השיעורים מכוסים"})]}):(0,a.jsxs)("div",{className:"mt-3 space-y-2 text-sm",children:[(0,a.jsx)("h4",{className:"font-medium text-muted-foreground",children:"שיעורים לא מכוסים:"}),(0,a.jsx)("ul",{className:"space-y-1",children:r.map((e,t)=>(0,a.jsxs)("li",{className:"flex items-center justify-between",children:[(0,a.jsxs)("span",{children:[e.subject," (",e.time,")"]}),(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:["עם ",e.absentTeacherName]})]},t))})]})]},t)})})})]})]}),(0,a.jsx)(eC,{teachers:F,classes:$,substitutions:W,timeSlots:X,onAssignSubstitute:ei}),(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsxs)("div",{className:"grid w-full grid-cols-2 sm:grid-cols-6 max-w-4xl mx-auto h-auto p-1 bg-muted/50 backdrop-blur-sm rounded-full mb-8 overflow-x-auto",children:[(0,a.jsx)(u.$,{variant:"ghost",onClick:()=>c("teachers"),className:"rounded-full py-2.5 transition-all ".concat("teachers"===o?"bg-background shadow-sm text-foreground":"text-muted-foreground hover:bg-background/50"),children:"פרופילי מורים"}),(0,a.jsx)(u.$,{variant:"ghost",onClick:()=>c("classes"),className:"rounded-full py-2.5 transition-all ".concat("classes"===o?"bg-background shadow-sm text-foreground":"text-muted-foreground hover:bg-background/50"),children:"כיתות לימוד"}),(0,a.jsx)(u.$,{variant:"ghost",onClick:()=>c("timetable"),className:"rounded-full py-2.5 transition-all ".concat("timetable"===o?"bg-background shadow-sm text-foreground":"text-muted-foreground hover:bg-background/50"),children:"זמינות מחליפים"}),(0,a.jsx)(u.$,{variant:"ghost",onClick:()=>c("calendar"),className:"rounded-full py-2.5 transition-all ".concat("calendar"===o?"bg-background shadow-sm text-foreground":"text-muted-foreground hover:bg-background/50"),children:"לוח שנה"}),(0,a.jsx)(u.$,{variant:"ghost",onClick:()=>c("statistics"),className:"rounded-full py-2.5 transition-all ".concat("statistics"===o?"bg-background shadow-sm text-foreground":"text-muted-foreground hover:bg-background/50"),children:"סטטיסטיקות"}),(0,a.jsx)(u.$,{variant:"ghost",onClick:()=>c("settings"),className:"rounded-full py-2.5 transition-all ".concat("settings"===o?"bg-background shadow-sm text-foreground":"text-muted-foreground hover:bg-background/50"),children:"הגדרות"})]}),(0,a.jsxs)(y.N,{mode:"wait",children:["teachers"===o&&(0,a.jsx)(N.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"mt-0",children:(0,a.jsx)(ey,{onMarkAbsent:e=>x({teacher:e})})},"teachers"),"classes"===o&&(0,a.jsx)(N.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"mt-0",children:(0,a.jsx)(ev,{})},"classes"),"timetable"===o&&(0,a.jsx)(N.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"mt-0",children:(0,a.jsx)(eN,{substitutions:W})},"timetable"),"calendar"===o&&(0,a.jsx)(N.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"mt-0",children:(0,a.jsx)(eA,{})},"calendar"),"settings"===o&&(0,a.jsx)(N.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"mt-0",children:(0,a.jsx)(ew,{timeSlots:X,onUpdate:ea,onStartNewYear:er})},"settings"),"statistics"===o&&(0,a.jsx)(N.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"mt-0",children:(0,a.jsx)(eP,{substitutions:W})},"statistics")]})]})})]}),(0,a.jsx)(K,{isOpen:!!m,onOpenChange:e=>!e&&x(null),teacher:null!=(e=null==m?void 0:m.teacher)?e:null,existingAbsences:null==m?void 0:m.existingAbsences,onConfirm:el}),(0,a.jsx)(eg,{isOpen:!!M,onOpenChange:e=>!e&&S(null),recommendationResult:M,onConfirm:()=>{S(null),c("timetable")}}),(0,a.jsx)(ek,{isOpen:!!f,onOpenChange:e=>!e&&E(null),schoolClass:f,allTeachers:F||[],isEditing:!1,allClasses:$||[],timeSlots:X})]})}},17759:(e,t,s)=>{"use strict";s.d(t,{C5:()=>g,MJ:()=>p,eI:()=>f,lR:()=>h,lV:()=>o,zB:()=>m});var a=s(95155),r=s(12115),n=s(66634),l=s(62177),i=s(59434),d=s(85057);let o=l.Op,c=r.createContext({}),m=e=>{let{...t}=e;return(0,a.jsx)(c.Provider,{value:{name:t.name},children:(0,a.jsx)(l.xI,{...t})})},u=()=>{let e=r.useContext(c),t=r.useContext(x),{getFieldState:s,formState:a}=(0,l.xW)(),n=s(e.name,a);if(!e)throw Error("useFormField should be used within <FormField>");let{id:i}=t;return{id:i,name:e.name,formItemId:"".concat(i,"-form-item"),formDescriptionId:"".concat(i,"-form-item-description"),formMessageId:"".concat(i,"-form-item-message"),...n}},x=r.createContext({}),f=r.forwardRef((e,t)=>{let{className:s,...n}=e,l=r.useId();return(0,a.jsx)(x.Provider,{value:{id:l},children:(0,a.jsx)("div",{ref:t,className:(0,i.cn)("space-y-2",s),...n})})});f.displayName="FormItem";let h=r.forwardRef((e,t)=>{let{className:s,...r}=e,{error:n,formItemId:l}=u();return(0,a.jsx)(d.J,{ref:t,className:(0,i.cn)(n&&"text-destructive",s),htmlFor:l,...r})});h.displayName="FormLabel";let p=r.forwardRef((e,t)=>{let{...s}=e,{error:r,formItemId:l,formDescriptionId:i,formMessageId:d}=u();return(0,a.jsx)(n.DX,{ref:t,id:l,"aria-describedby":r?"".concat(i," ").concat(d):"".concat(i),"aria-invalid":!!r,...s})});p.displayName="FormControl",r.forwardRef((e,t)=>{let{className:s,...r}=e,{formDescriptionId:n}=u();return(0,a.jsx)("p",{ref:t,id:n,className:(0,i.cn)("text-sm text-muted-foreground",s),...r})}).displayName="FormDescription";let g=r.forwardRef((e,t)=>{var s;let{className:r,children:n,...l}=e,{error:d,formMessageId:o}=u(),c=d?String(null!=(s=null==d?void 0:d.message)?s:""):n;return c?(0,a.jsx)("p",{ref:t,id:o,className:(0,i.cn)("text-sm font-medium text-destructive",r),...l,children:c}):null});g.displayName="FormMessage"},22346:(e,t,s)=>{"use strict";s.d(t,{w:()=>i});var a=s(95155),r=s(12115),n=s(87489),l=s(59434);let i=r.forwardRef((e,t)=>{let{className:s,orientation:r="horizontal",decorative:i=!0,...d}=e;return(0,a.jsx)(n.b,{ref:t,decorative:i,orientation:r,className:(0,l.cn)("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",s),...d})});i.displayName=n.b.displayName},26126:(e,t,s)=>{"use strict";s.d(t,{E:()=>i});var a=s(95155);s(12115);var r=s(74466),n=s(59434);let l=(0,r.F)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:s,...r}=e;return(0,a.jsx)("div",{className:(0,n.cn)(l({variant:s}),t),...r})}},30285:(e,t,s)=>{"use strict";s.d(t,{$:()=>o,r:()=>d});var a=s(95155),r=s(12115),n=s(66634),l=s(74466),i=s(59434);let d=(0,l.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=r.forwardRef((e,t)=>{let{className:s,variant:r,size:l,asChild:o=!1,...c}=e,m=o?n.DX:"button";return(0,a.jsx)(m,{className:(0,i.cn)(d({variant:r,size:l,className:s})),ref:t,...c})});o.displayName="Button"},33143:(e,t,s)=>{"use strict";s.d(t,{_:()=>l});var a=s(95155),r=s(38274),n=s(10518);function l(e){let{message:t="הפעולה בוצעה בהצלחה!",size:s=80}=e;return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center p-6 text-center",children:[(0,a.jsxs)("div",{className:"relative flex items-center justify-center mb-4",children:[(0,a.jsx)(r.P.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:260,damping:20,duration:.5},className:"bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center",style:{width:1.5*s,height:1.5*s},children:(0,a.jsx)(r.P.div,{initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:1},transition:{duration:.5,delay:.2,ease:"easeInOut"},children:(0,a.jsx)(n.A,{className:"text-green-600 dark:text-green-400",size:s,strokeWidth:3})})}),[...Array(6)].map((e,t)=>(0,a.jsx)(r.P.div,{className:"absolute w-2 h-2 rounded-full bg-green-500",initial:{opacity:0,x:0,y:0},animate:{opacity:[0,1,0],x:Math.cos(60*t*(Math.PI/180))*s,y:Math.sin(60*t*(Math.PI/180))*s},transition:{duration:.6,delay:.3,ease:"easeOut"}},t))]}),(0,a.jsx)(r.P.h3,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4,duration:.4},className:"text-xl font-bold text-green-700 dark:text-green-400",children:t})]})}},40688:(e,t,s)=>{"use strict";s.d(t,{_9:()=>o,ax:()=>d,o0:()=>m});var a=s(79233),r=s(80644),n=s(76959);let l=["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"],i=e=>{if(!e||"string"!=typeof e||!e.includes(":"))return 0;let[t,s]=e.split(":").map(Number);return t+s/60};function d(e,t,s){var d,o;let c=l[(0,a.P)(t)],m="".concat(t.getHours().toString().padStart(2,"0"),":").concat(t.getMinutes().toString().padStart(2,"0")),u=s.find(e=>m>=e.start&&m<e.end);if(!u)return"unknown";let x=(0,r.o)(t),f=(e.absences||[]).filter(e=>(0,n.r)((0,r.o)(new Date(e.date)),x));if(f.length>0){let e=i(u.start);if(f.some(t=>{if(t.isAllDay)return!0;let s=i(t.startTime),a=i(t.endTime);return e>=s&&e<a}))return"absent"}let h=e.availability.find(e=>e.day===c);if(!h)return"not_in_school";let p=i(u.start);if(!h.slots.some(e=>{let t=i(e.start),s=i(e.end);return p>=t&&p<s}))return"not_in_school";let g=null==(o=e.schedule)||null==(d=o[c])?void 0:d[u.start],b=Array.isArray(g)?g:g?[g]:[];return b&&b.length>0?"teaching":"available"}function o(e,t,s,r,n){let i=l[(0,a.P)(t)];return r.some(t=>{var a;if(t.id===n)return!1;let r=null==(a=t.schedule[i])?void 0:a[s],l=Array.isArray(r)?r:r?[r]:[];return l&&l.some(t=>t.teacherId===e)})}let c=(e,t)=>{var s,a;let r=0;return e.subjects.includes(t.subject)&&(r+=10),(null==(s=e.preferences)?void 0:s.includes("כיתות בוגרות"))&&(r+=2),(null==(a=e.preferences)?void 0:a.includes("חינוך מיוחד"))&&"חינוך מיוחד"===t.subject&&(r+=5),r};async function m(e,t,s,d){let m=t.filter(t=>(function(e,t,s,d){var o,c;let m=d.find(e=>e.start===s);if(!m)return!1;let u=l[(0,a.P)(t)],x=e.availability.find(e=>e.day===u);if(!x)return!1;let f=i(m.start);if(!x.slots.some(e=>{let t=i(e.start),s=i(e.end);return f>=t&&f<s}))return!1;let h=null==(c=e.schedule)||null==(o=c[u])?void 0:o[s],p=Array.isArray(h)?h:h?[h]:[];if(p&&p.length>0)return!1;let g=(e.absences||[]).filter(e=>(0,n.r)((0,r.o)(new Date(e.date)),(0,r.o)(t)));return!(g.length>0&&g.some(e=>{if(e.isAllDay)return!0;let t=i(e.startTime),s=i(e.endTime);return f>=t&&f<s}))&&!0})(t,e.date,e.time,d)&&!o(t.id,e.date,e.time,s));if(0===m.length)return{recommendation:null,recommendationId:null,reasoning:"לא נמצאו מורים פנויים.",substituteOptions:[]};let u=m.filter(t=>t.subjects.includes(e.subject)),x=[],f=null,h=null;return u.length>0?(f=u.map(t=>({teacher:t,score:c(t,e)})).sort((e,t)=>t.score-e.score)[0].teacher,h="".concat(f.name," מומלץ/ת כי הוא/היא פנוי/ה ומוכשר/ת ב").concat(e.subject,"."),f.preferences&&(h+=" העדפות: ".concat(f.preferences,".")),x=u):(f=m[0],h="שימו לב: לא נמצא מורה פנוי המוכשר ב".concat(e.subject,". ").concat(f.name," מוצע/ת כמפקח/ת בלבד."),x=m),{recommendation:(null==f?void 0:f.name)||null,recommendationId:(null==f?void 0:f.id)||null,reasoning:h,substituteOptions:x}}},44838:(e,t,s)=>{"use strict";s.d(t,{SQ:()=>u,_2:()=>x,mB:()=>f,rI:()=>c,ty:()=>m});var a=s(95155),r=s(12115),n=s(76215),l=s(73158),i=s(10518),d=s(70154),o=s(59434);let c=n.bL,m=n.l9;n.YJ,n.ZL,n.Pb,n.z6,r.forwardRef((e,t)=>{let{className:s,inset:r,children:i,...d}=e;return(0,a.jsxs)(n.ZP,{ref:t,className:(0,o.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",r&&"pl-8",s),...d,children:[i,(0,a.jsx)(l.A,{className:"mr-auto h-4 w-4"})]})}).displayName=n.ZP.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.G5,{ref:t,className:(0,o.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...r})}).displayName=n.G5.displayName;let u=r.forwardRef((e,t)=>{let{className:s,sideOffset:r=4,...l}=e;return(0,a.jsx)(n.ZL,{children:(0,a.jsx)(n.UC,{ref:t,sideOffset:r,className:(0,o.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...l})})});u.displayName=n.UC.displayName;let x=r.forwardRef((e,t)=>{let{className:s,inset:r,...l}=e;return(0,a.jsx)(n.q7,{ref:t,className:(0,o.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r&&"pr-8",s),...l})});x.displayName=n.q7.displayName,r.forwardRef((e,t)=>{let{className:s,children:r,checked:l,...d}=e;return(0,a.jsxs)(n.H_,{ref:t,className:(0,o.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pr-8 pl-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:l,...d,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(n.VF,{children:(0,a.jsx)(i.A,{className:"h-4 w-4"})})}),r]})}).displayName=n.H_.displayName,r.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,a.jsxs)(n.hN,{ref:t,className:(0,o.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pr-8 pl-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...l,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(n.VF,{children:(0,a.jsx)(d.A,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=n.hN.displayName,r.forwardRef((e,t)=>{let{className:s,inset:r,...l}=e;return(0,a.jsx)(n.JU,{ref:t,className:(0,o.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pr-8",s),...l})}).displayName=n.JU.displayName;let f=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.wv,{ref:t,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",s),...r})});f.displayName=n.wv.displayName},47262:(e,t,s)=>{"use strict";s.d(t,{S:()=>d});var a=s(95155),r=s(12115),n=s(76981),l=s(10518),i=s(59434);let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.bL,{ref:t,className:(0,i.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...r,children:(0,a.jsx)(n.C1,{className:(0,i.cn)("flex items-center justify-center text-current"),children:(0,a.jsx)(l.A,{className:"h-4 w-4"})})})});d.displayName=n.bL.displayName},47906:(e,t,s)=>{"use strict";s.d(t,{a:()=>r});var a=s(12115);function r(){let[e,t]=a.useState(void 0);return a.useEffect(()=>{let e=window.matchMedia("(max-width: ".concat(767,"px)")),s=()=>{t(window.innerWidth<768)};return e.addEventListener("change",s),t(window.innerWidth<768),()=>e.removeEventListener("change",s)},[]),!!e}},54165:(e,t,s)=>{"use strict";s.d(t,{Cf:()=>u,Es:()=>f,HM:()=>c,L3:()=>h,c7:()=>x,lG:()=>d,rr:()=>p});var a=s(95155),r=s(12115),n=s(45821),l=s(25318),i=s(59434);let d=n.bL;n.l9;let o=n.ZL,c=n.bm,m=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.hJ,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r})});m.displayName=n.hJ.displayName;let u=r.forwardRef((e,t)=>{let{className:s,children:r,...d}=e;return(0,a.jsxs)(o,{children:[(0,a.jsx)(m,{}),(0,a.jsxs)(n.UC,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...d,children:[r,(0,a.jsxs)(n.bm,{className:"absolute left-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(l.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=n.UC.displayName;let x=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-right",t),...s})};x.displayName="DialogHeader";let f=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:gap-2",t),...s})};f.displayName="DialogFooter";let h=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.hE,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",s),...r})});h.displayName=n.hE.displayName;let p=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.VY,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",s),...r})});p.displayName=n.VY.displayName},62523:(e,t,s)=>{"use strict";s.d(t,{p:()=>l});var a=s(95155),r=s(12115),n=s(59434);let l=r.forwardRef((e,t)=>{let{className:s,type:r,...l}=e;return(0,a.jsx)("input",{type:r,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...l})});l.displayName="Input"},66424:(e,t,s)=>{"use strict";s.d(t,{$:()=>d,F:()=>i});var a=s(95155),r=s(12115),n=s(47655),l=s(59434);let i=r.forwardRef((e,t)=>{let{className:s,children:r,...i}=e;return(0,a.jsxs)(n.bL,{ref:t,className:(0,l.cn)("relative overflow-hidden",s),...i,children:[(0,a.jsx)(n.LM,{className:"h-full w-full rounded-[inherit]",children:r}),(0,a.jsx)(d,{}),(0,a.jsx)(n.OK,{})]})});i.displayName=n.bL.displayName;let d=r.forwardRef((e,t)=>{let{className:s,orientation:r="vertical",...i}=e;return(0,a.jsx)(n.VM,{ref:t,orientation:r,className:(0,l.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...i,children:(0,a.jsx)(n.lr,{className:"relative flex-1 rounded-full bg-border"})})});d.displayName=n.VM.displayName},66695:(e,t,s)=>{"use strict";s.d(t,{BT:()=>o,Wu:()=>c,ZB:()=>d,Zp:()=>l,aR:()=>i,wL:()=>m});var a=s(95155),r=s(12115),n=s(59434);let l=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...r})});l.displayName="Card";let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",s),...r})});i.displayName="CardHeader";let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("h3",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",s),...r})});d.displayName="CardTitle";let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",s),...r})});o.displayName="CardDescription";let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",s),...r})});c.displayName="CardContent";let m=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",s),...r})});m.displayName="CardFooter"},73669:(e,t,s)=>{Promise.resolve().then(s.bind(s,5062))},85057:(e,t,s)=>{"use strict";s.d(t,{J:()=>o});var a=s(95155),r=s(12115),n=s(40968),l=s(74466),i=s(59434);let d=(0,l.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.b,{ref:t,className:(0,i.cn)(d(),s),...r})});o.displayName=n.b.displayName},85511:(e,t,s)=>{"use strict";s.d(t,{V:()=>o});var a=s(95155);s(12115);var r=s(73158),n=s(965),l=s(73465),i=s(59434),d=s(30285);function o(e){let{className:t,classNames:s,showOutsideDays:o=!0,...c}=e;return(0,a.jsx)(l.hv,{dir:"rtl",showOutsideDays:o,className:(0,i.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,i.cn)((0,d.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,i.cn)((0,d.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...s},components:{IconLeft:e=>{let{...t}=e;return(0,a.jsx)(r.A,{className:"h-4 w-4"})},IconRight:e=>{let{...t}=e;return(0,a.jsx)(n.A,{className:"h-4 w-4"})}},...c})}o.displayName="Calendar"},91950:(e,t,s)=>{"use strict";s.d(t,{B:()=>a});let a=["ראשון","שני","שלישי","רביעי","חמישי","שישי"]},97714:(e,t,s)=>{"use strict";s.d(t,{j:()=>n});var a=s(3310),r=s(40610);function n(e,t){return e.commit().catch(e=>{let s=new r.$({operation:t.operation,path:t.path,requestResourceData:t.data});throw a.d.emit("permission-error",s),s})}}},e=>{var t=t=>e(e.s=t);e.O(0,[992,416,469,925,395,3,892,441,684,358],()=>t(73669)),_N_E=e.O()}]);