(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{5062:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>eS});var a=s(95155),r=s(12115),n=s(55028),i=s(87267),l=s(50172),d=s(33349),o=s(36936),c=s(68027),m=s(51362),u=s(30285),x=s(44838);function f(){let{setTheme:e}=(0,m.D)();return(0,a.jsxs)(x.rI,{children:[(0,a.jsx)(x.ty,{asChild:!0,children:(0,a.jsxs)(u.$,{variant:"ghost",size:"icon",children:[(0,a.jsx)(o.A,{className:"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),(0,a.jsx)(c.A,{className:"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),(0,a.jsx)("span",{className:"sr-only",children:"Toggle theme"})]})}),(0,a.jsxs)(x.SQ,{align:"end",children:[(0,a.jsx)(x._2,{onClick:()=>e("light")}),(0,a.jsx)(x._2,{onClick:()=>e("dark")})]})]})}var p=s(19599),h=s(59434);function b(){let e=(0,p.useAuth)(),{user:t,isUserLoading:s}=(0,p.useUser)(),[n,o]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{let e=()=>{o(window.scrollY>10)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]),(0,a.jsx)("header",{className:(0,h.cn)("sticky top-0 z-50 transition-all duration-300",n?"bg-card/80 backdrop-blur-sm border-b":"bg-transparent border-b border-transparent"),children:(0,a.jsx)("div",{className:"container mx-auto px-4 py-3 sm:px-6 md:px-8",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 shrink-0",children:[(0,a.jsx)(i.A,{className:"h-6 w-6 sm:h-7 sm:w-7 text-primary"}),(0,a.jsx)("h1",{className:"text-lg sm:text-xl font-bold tracking-tight text-foreground truncate",children:"מורה מחליף"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 sm:gap-2 shrink-0",children:[s?(0,a.jsx)(l.A,{className:"h-5 w-5 animate-spin"}):t?(0,a.jsx)(u.$,{variant:"ghost",size:"icon",onClick:()=>null==e?void 0:e.signOut(),className:"h-8 w-8 sm:h-10 sm:w-10",children:(0,a.jsx)(d.A,{className:"h-4 w-4 sm:h-5 sm:w-5"})}):null,(0,a.jsx)(f,{})]})]})})})}var g=s(35695),y=s(35317),j=s(19114),N=s(38274),v=s(23769),w=s(31949),k=s(18763),I=s(38337),A=s(66695),P=s(80644),C=s(76959),T=s(83013),S=s(46375),_=s(55594),R=s(62177),D=s(90221),E=s(83343),M=s(54165),z=s(17759),O=s(62523),F=s(87481),G=s(51920),L=s(37648),V=s(77223),J=s(58127),$=s(85511),H=s(47906),B=s(47262),U=s(66424),Z=s(33143);let q=/^(0[0-9]|1[0-9]|2[0-3]):[0-5][0-9]$/,W=_.z.object({date:_.z.date(),isAllDay:_.z.boolean(),startTime:_.z.string().regex(q,{message:"פורמט זמן לא חוקי (HH:mm)."}),endTime:_.z.string().regex(q,{message:"פורמט זמן לא חוקי (HH:mm)."})}),Y=_.z.object({absencePeriods:_.z.array(W).min(1,"יש לבחור לפחות תאריך אחד."),reason:_.z.string().optional()}).refine(e=>{for(let t of e.absencePeriods)if(!t.isAllDay&&new Date("1970-01-01T".concat(t.startTime,":00"))>=new Date("1970-01-01T".concat(t.endTime,":00")))return!1;return!0},{message:"שעת הסיום חייבת להיות אחרי שעת ההתחלה.",path:["absencePeriods"]});function Q(e){var t,s;let{isOpen:n,onOpenChange:i,teacher:d,existingAbsences:o,onConfirm:c}=e,{toast:m}=(0,F.dj)(),x=(0,H.a)(),[f,p]=(0,r.useState)(!1),[b,g]=(0,r.useState)(!1),y=!!o&&o.length>0,j=(0,R.mN)({resolver:(0,D.u)(Y),defaultValues:{reason:"",absencePeriods:[]}}),N=(0,r.useMemo)(()=>j.watch("absencePeriods").map(e=>e.date),[j.watch("absencePeriods")]),v=e=>{let t=j.getValues("absencePeriods").filter(t=>!(0,C.r)(t.date,e));j.setValue("absencePeriods",t,{shouldValidate:!0})};if((0,r.useEffect)(()=>{if(n)if(y&&o){let e=o.map(e=>({date:"string"==typeof e.date?(0,P.o)((0,E.H)(e.date)):(0,P.o)(e.date),isAllDay:e.isAllDay,startTime:e.startTime,endTime:e.endTime}));j.reset({reason:"",absencePeriods:e})}else j.reset({reason:"",absencePeriods:[]});else j.reset({reason:"",absencePeriods:[]}),p(!1),g(!1)},[n,y,o,j]),!d)return null;let w=async e=>{p(!0);try{let t=e.absencePeriods.map(e=>({...e,id:Math.random().toString(36).substring(2,9)}));await c(d,t),g(!0),setTimeout(()=>{i(!1),g(!1)},2e3)}catch(e){console.error("שגיאה ברישום היעדרות:",e),m({variant:"destructive",title:"שגיאה",description:"לא ניתן היה לרשום את ההיעדרות. אנא נסה שוב."})}finally{p(!1)}},k=j.watch("absencePeriods"),I=x?"div":U.F;return b?(0,a.jsx)(M.lG,{open:n,onOpenChange:i,children:(0,a.jsx)(M.Cf,{className:"sm:max-w-md",children:(0,a.jsx)(Z._,{message:y?"ההיעדרות עודכנה בהצלחה!":"ההיעדרות נרשמה בהצלחה!"})})}):(0,a.jsx)(M.lG,{open:n,onOpenChange:i,children:(0,a.jsxs)(M.Cf,{className:"sm:max-w-4xl h-[80vh] flex flex-col p-0 gap-0 overflow-hidden",children:[(0,a.jsxs)(M.c7,{className:"p-6 pb-2",children:[(0,a.jsx)(M.L3,{className:"text-2xl",children:y?"עריכת היעדרות: ".concat(d.name):"רישום היעדרות: ".concat(d.name)}),(0,a.jsx)(M.rr,{children:"בחר תאריכים בלוח השנה והגדר את שעות ההיעדרות לכל יום."})]}),(0,a.jsx)(z.lV,{...j,children:(0,a.jsxs)("form",{onSubmit:j.handleSubmit(w),className:"flex-1 flex flex-col overflow-hidden",children:[(0,a.jsxs)("div",{className:(0,h.cn)("flex-1 flex flex-col md:flex-row",x?"overflow-y-auto":"overflow-hidden"),children:[(0,a.jsxs)("div",{className:"p-6 pt-2 border-b md:border-b-0 md:border-l flex flex-col items-center justify-start bg-muted/10 shrink-0",children:[(0,a.jsxs)("h3",{className:"font-medium mb-4 self-start flex items-center gap-2",children:[(0,a.jsx)(G.A,{className:"w-4 h-4 text-primary"}),"בחירת תאריכים"]}),(0,a.jsx)(U.F,{className:"h-[360px]",children:(0,a.jsx)($.V,{mode:"multiple",selected:N,onSelect:e=>{if(!e)return void j.setValue("absencePeriods",[]);let t=j.getValues("absencePeriods"),s=e.map(e=>{let s=t.find(t=>(0,C.r)(t.date,e));return s||{date:(0,P.o)(e),isAllDay:!0,startTime:"08:00",endTime:"16:00"}});s.sort((e,t)=>e.date.getTime()-t.date.getTime()),j.setValue("absencePeriods",s,{shouldValidate:!0})},className:"rounded-md border shadow bg-card",locale:S.he})}),(0,a.jsx)("div",{className:"mt-4 text-sm text-muted-foreground text-center",children:0===N.length?"לא נבחרו תאריכים":"נבחרו ".concat(N.length," ימים")})]}),(0,a.jsxs)("div",{className:(0,h.cn)("flex-1 flex flex-col p-6 pt-2 bg-background",x?"":"overflow-hidden"),children:[(0,a.jsxs)("h3",{className:"font-medium mb-4 flex items-center gap-2",children:[(0,a.jsx)(L.A,{className:"w-4 h-4 text-primary"}),"פרטי היעדרות"]}),(0,a.jsx)(I,{className:(0,h.cn)("flex-1",x?"":"-mr-4 pr-4"),children:0===k.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 text-muted-foreground border-2 border-dashed rounded-xl",children:[(0,a.jsx)(G.A,{className:"h-10 w-10 mb-2 opacity-20"}),(0,a.jsx)("p",{children:"אנא בחר תאריכים מלוח השנה"})]}):(0,a.jsx)("div",{className:"space-y-3 pb-4",children:k.map((e,t)=>(0,a.jsx)(A.Zp,{className:"overflow-hidden border shadow-sm transition-all hover:shadow-md",children:(0,a.jsx)(A.Wu,{className:"p-0",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center",children:[(0,a.jsxs)("div",{className:"bg-muted/30 p-3 sm:w-40 flex flex-row sm:flex-col items-center justify-between sm:justify-center border-b sm:border-b-0 sm:border-l gap-2",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"font-bold text-lg text-primary",children:(0,T.GP)(e.date,"dd/MM")}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:(0,T.GP)(e.date,"EEEE",{locale:S.he})})]}),(0,a.jsx)(u.$,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive sm:hidden",onClick:()=>v(e.date),children:(0,a.jsx)(V.A,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"flex-1 p-3 flex flex-col gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(z.zB,{control:j.control,name:"absencePeriods.".concat(t,".isAllDay"),render:e=>{let{field:t}=e;return(0,a.jsxs)(z.eI,{className:"flex flex-row items-center space-x-2 space-x-reverse space-y-0",children:[(0,a.jsx)(z.MJ,{children:(0,a.jsx)(B.S,{checked:t.value,onCheckedChange:t.onChange})}),(0,a.jsx)(z.lR,{className:"font-medium cursor-pointer text-sm",children:"יום שלם"})]})}}),(0,a.jsx)(u.$,{type:"button",variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive hidden sm:flex",onClick:()=>v(e.date),children:(0,a.jsx)(V.A,{className:"h-4 w-4"})})]}),!e.isAllDay&&(0,a.jsxs)("div",{className:"flex items-center gap-2 animate-in fade-in slide-in-from-top-1 duration-200",children:[(0,a.jsx)(z.zB,{control:j.control,name:"absencePeriods.".concat(t,".startTime"),render:e=>{let{field:t}=e;return(0,a.jsxs)(z.eI,{className:"flex-1 space-y-1",children:[(0,a.jsx)(z.lR,{className:"text-xs text-muted-foreground",children:"התחלה"}),(0,a.jsx)(z.MJ,{children:(0,a.jsx)(O.p,{type:"time",className:"h-8 text-sm",...t})}),(0,a.jsx)(z.C5,{className:"text-[10px]"})]})}}),(0,a.jsx)("span",{className:"text-muted-foreground mt-4",children:"-"}),(0,a.jsx)(z.zB,{control:j.control,name:"absencePeriods.".concat(t,".endTime"),render:e=>{let{field:t}=e;return(0,a.jsxs)(z.eI,{className:"flex-1 space-y-1",children:[(0,a.jsx)(z.lR,{className:"text-xs text-muted-foreground",children:"סיום"}),(0,a.jsx)(z.MJ,{children:(0,a.jsx)(O.p,{type:"time",className:"h-8 text-sm",...t})}),(0,a.jsx)(z.C5,{className:"text-[10px]"})]})}})]})]})]})})},e.date.toISOString()))})}),(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t space-y-4",children:[(0,a.jsx)(z.zB,{control:j.control,name:"reason",render:e=>{let{field:t}=e;return(0,a.jsxs)(z.eI,{children:[(0,a.jsx)(z.lR,{children:"סיבה (אופציונלי)"}),(0,a.jsx)(z.MJ,{children:(0,a.jsx)(O.p,{placeholder:"למשל, מחלה, מילואים...",...t})}),(0,a.jsx)(z.C5,{})]})}}),j.formState.errors.absencePeriods&&(0,a.jsxs)("div",{className:"p-3 rounded-md bg-destructive/10 text-destructive text-sm flex items-center gap-2",children:[(0,a.jsx)(J.A,{className:"h-4 w-4 rotate-45"}),j.formState.errors.absencePeriods.message||(null==(s=j.formState.errors.absencePeriods)||null==(t=s.root)?void 0:t.message)]})]})]})]}),(0,a.jsxs)(M.Es,{className:"p-6 pt-4 border-t bg-muted/5",children:[(0,a.jsx)(M.HM,{asChild:!0,children:(0,a.jsx)(u.$,{type:"button",variant:"outline",children:"ביטול"})}),(0,a.jsx)(u.$,{type:"submit",disabled:f||0===k.length,children:f?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.A,{className:"ml-2 h-4 w-4 animate-spin"}),y?"מעדכן...":"רושם היעדרות..."]}):y?"שמור שינויים":"אשר ורשום היעדרות"})]})]})})]})})}var X=s(79233),K=s(22346),ee=s(50286),et=s(17569),es=s(57804),ea=s(98328),er=s(74651),en=s.n(er),ei=s(37250),el=s(79556);let ed=ei.bL,eo=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(ei.q7,{ref:t,className:(0,h.cn)("border-b",s),...r})});eo.displayName="AccordionItem";let ec=r.forwardRef((e,t)=>{let{className:s,children:r,...n}=e;return(0,a.jsx)(ei.Y9,{className:"flex",children:(0,a.jsxs)(ei.l9,{ref:t,className:(0,h.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",s),...n,children:[r,(0,a.jsx)(el.A,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})})});ec.displayName=ei.l9.displayName;let em=r.forwardRef((e,t)=>{let{className:s,children:r,...n}=e;return(0,a.jsx)(ei.UC,{ref:t,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...n,children:(0,a.jsx)("div",{className:(0,h.cn)("pb-4 pt-0",s),children:r})})});em.displayName=ei.UC.displayName;var eu=s(26126),ex=s(91950),ef=s(30356),ep=s(85057);let eh=e=>{let{lesson:t,onAssign:s}=e,[n,i]=(0,r.useState)(t.recommendationId),[d,o]=(0,r.useState)(!1),c=t.substituteOptions&&t.substituteOptions.length>0,m=t.absentTeacherName||"לא ידוע",x=async()=>{if(!n)return;let e=t.substituteOptions.find(e=>e.id===n);e&&(o(!0),await s(e,t),o(!1))};return(0,a.jsxs)("div",{className:"p-3 border rounded-lg bg-card/50",children:[(0,a.jsxs)("div",{className:"font-semibold flex flex-col sm:flex-row items-start sm:items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(ee.A,{className:"ml-2 h-4 w-4 text-muted-foreground"}),(0,a.jsxs)("span",{children:["כיתה ",t.className]})]}),(0,a.jsxs)("span",{className:"text-sm text-muted-foreground font-normal mt-1 sm:mt-0",children:[t.lesson.subject," בשעה ",t.time]})]}),(0,a.jsx)(K.w,{className:"my-2"}),(0,a.jsx)("div",{className:"flex items-center justify-center gap-4 text-center my-3",children:(0,a.jsxs)("div",{className:"flex flex-col items-center p-2 rounded-md",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"מורה חסר/ה"}),(0,a.jsx)("p",{className:"font-bold text-destructive/80 flex items-center justify-center gap-2 mt-1",children:m})]})}),c?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground mb-2 text-center",children:"בחר/י מורה מחליף/ה מהרשימה:"}),(0,a.jsx)(ef.z,{dir:"rtl",value:n||"",onValueChange:i,className:"space-y-2 max-h-48 overflow-y-auto pr-2",children:t.substituteOptions.map(e=>(0,a.jsxs)(ep.J,{htmlFor:"".concat(t.classId,"-").concat(t.time,"-").concat(e.id),className:(0,h.cn)("flex items-center justify-between p-3 rounded-md border cursor-pointer transition-all",n===e.id?"bg-primary/10 border-primary":"hover:bg-muted/50"),children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 space-x-reverse",children:[(0,a.jsx)(ef.C,{value:e.id,id:"".concat(t.classId,"-").concat(t.time,"-").concat(e.id)}),(0,a.jsx)("span",{className:"font-medium",children:e.name})]}),e.id===t.recommendationId&&(0,a.jsx)(eu.E,{variant:"secondary",className:"text-xs bg-green-100 text-green-800",children:"מומלץ"})]},e.id))}),t.reasoning&&(0,a.jsxs)("div",{className:"mt-3 p-2 rounded-md bg-amber-50 dark:bg-amber-900/20 text-amber-800 dark:text-amber-300 text-xs flex items-start gap-2 text-right",children:[(0,a.jsx)(et.A,{className:"h-4 w-4 shrink-0 mt-0.5 ml-1"}),(0,a.jsxs)("span",{children:[(0,a.jsx)("strong",{children:"נימוק להמלצה:"})," ",t.reasoning]})]}),(0,a.jsx)("div",{className:"mt-4 flex justify-end",children:(0,a.jsxs)(u.$,{size:"sm",onClick:x,disabled:!n||d,children:[d?(0,a.jsx)(l.A,{className:"w-4 h-4 ml-2 animate-spin"}):(0,a.jsx)(es.A,{className:"w-4 h-4 ml-2"}),"שבץ"]})})]}):(0,a.jsx)("p",{className:"text-sm text-center text-muted-foreground py-4",children:"לא נמצאו מורים פנויים לשיעור זה."})]})};function eb(e){let{isOpen:t,onOpenChange:s,recommendationResult:r,onAssign:n}=e;if(!r)return null;let{results:i,absentTeacher:l}=r,d=en()(i,e=>ex.B[(0,X.P)(e.date)]),o=ex.B.filter(e=>d[e]);return(0,a.jsx)(M.lG,{open:t,onOpenChange:s,children:(0,a.jsxs)(M.Cf,{className:"max-w-lg md:max-w-2xl",children:[(0,a.jsxs)(M.c7,{children:[(0,a.jsxs)(M.L3,{children:["שיבוץ מחליפים עבור ",l.name]}),(0,a.jsx)(M.rr,{children:"להלן השיעורים המושפעים מההיעדרות. בחר/י מורה מחליף/ה לכל שיעור."})]}),(0,a.jsx)(U.F,{className:"py-2 max-h-[60vh] overflow-y-auto pr-4 -mr-4",children:(0,a.jsx)(ed,{type:"multiple",className:"w-full",defaultValue:o.map(e=>"day-".concat(e)),children:o.map(e=>(0,a.jsxs)(eo,{value:"day-".concat(e),children:[(0,a.jsx)(ec,{children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(ea.A,{className:"h-5 w-5 text-primary"}),(0,a.jsxs)("span",{className:"font-semibold",children:["יום ",e]}),(0,a.jsxs)(eu.E,{variant:"secondary",children:[d[e].length," שיעורים"]})]})}),(0,a.jsx)(em,{children:(0,a.jsx)("div",{className:"space-y-4 p-2",children:d[e].map((e,t)=>(0,a.jsx)(eh,{lesson:e,onAssign:n},t))})})]},e))})}),(0,a.jsx)(M.Es,{children:(0,a.jsx)(M.HM,{asChild:!0,children:(0,a.jsx)(u.$,{type:"button",variant:"secondary",children:"סגור"})})})]})})}var eg=s(97714),ey=s(40688),ej=s(8246);let eN=(0,n.default)(()=>Promise.all([s.e(445),s.e(607),s.e(778),s.e(36)]).then(s.bind(s,13036)),{loadableGenerated:{webpack:()=>[13036]},loading:()=>(0,a.jsx)("div",{className:"p-4 flex justify-center",children:(0,a.jsx)(l.A,{className:"h-8 w-8 animate-spin text-primary"})})}),ev=(0,n.default)(()=>s.e(32).then(s.bind(s,16032)),{loadableGenerated:{webpack:()=>[16032]},loading:()=>(0,a.jsx)("div",{className:"p-4 flex justify-center",children:(0,a.jsx)(l.A,{className:"h-8 w-8 animate-spin text-primary"})})}),ew=(0,n.default)(()=>Promise.all([s.e(445),s.e(607),s.e(725),s.e(28),s.e(781)]).then(s.bind(s,59781)),{loadableGenerated:{webpack:()=>[59781]},loading:()=>(0,a.jsx)("div",{className:"p-4 flex justify-center",children:(0,a.jsx)(l.A,{className:"h-8 w-8 animate-spin text-primary"})})}),ek=(0,n.default)(()=>Promise.all([s.e(445),s.e(957)]).then(s.bind(s,62957)),{loadableGenerated:{webpack:()=>[62957]},loading:()=>(0,a.jsx)("div",{className:"p-4 flex justify-center",children:(0,a.jsx)(l.A,{className:"h-8 w-8 animate-spin text-primary"})})}),eI=(0,n.default)(()=>Promise.all([s.e(445),s.e(607),s.e(28),s.e(767)]).then(s.bind(s,73028)),{loadableGenerated:{webpack:()=>[73028]},loading:()=>null}),eA=(0,n.default)(()=>Promise.all([s.e(445),s.e(806)]).then(s.bind(s,64806)),{loadableGenerated:{webpack:()=>[64806]},loading:()=>(0,a.jsx)("div",{className:"p-4 flex justify-center",children:(0,a.jsx)(l.A,{className:"h-8 w-8 animate-spin text-primary"})})}),eP=(0,n.default)(()=>s.e(737).then(s.bind(s,86737)),{loadableGenerated:{webpack:()=>[86737]},loading:()=>(0,a.jsx)("div",{className:"p-4 flex justify-center",children:(0,a.jsx)(l.A,{className:"h-8 w-8 animate-spin text-primary"})})}),eC=(0,n.default)(()=>s.e(324).then(s.bind(s,54943)),{loadableGenerated:{webpack:()=>[54943]},loading:()=>(0,a.jsx)("div",{className:"p-4 flex justify-center",children:(0,a.jsx)(l.A,{className:"h-8 w-8 animate-spin text-primary"})})}),eT=(0,n.default)(()=>Promise.all([s.e(445),s.e(632)]).then(s.bind(s,32632)),{loadableGenerated:{webpack:()=>[32632]},loading:()=>(0,a.jsx)("div",{className:"p-4 flex justify-center",children:(0,a.jsx)(l.A,{className:"h-8 w-8 animate-spin text-primary"})})});function eS(){var e;let{user:t,isUserLoading:s}=(0,p.useUser)(),n=(0,g.useRouter)(),i=(0,p.useFirestore)(),{toast:d}=(0,F.dj)(),[o,c]=(0,r.useState)("teachers"),[m,x]=(0,r.useState)(null),[f,h]=(0,r.useState)(null),[_,R]=(0,r.useState)(null),D=(0,p.useMemoFirebase)(()=>t?(0,y.P)((0,y.rJ)(i,"teachers"),(0,y._M)("userId","==",t.uid)):null,[t,i]),{data:E,isLoading:M}=(0,v.G)(D),z=E||[],O=(0,p.useMemoFirebase)(()=>t?(0,y.P)((0,y.rJ)(i,"classes"),(0,y._M)("userId","==",t.uid)):null,[t,i]),{data:G,isLoading:L}=(0,v.G)(O),V=G||[],J=(0,p.useMemoFirebase)(()=>t?(0,y.P)((0,y.rJ)(i,"substitutions"),(0,y._M)("userId","==",t.uid)):null,[t,i]),{data:$,isLoading:H}=(0,v.G)(J),B=$||[],U=(0,p.useMemoFirebase)(()=>t?(0,y.P)((0,y.rJ)(i,"settings"),(0,y._M)("userId","==",t.uid)):null,[t,i]),{data:Z,isLoading:q}=(0,v.G)(U),W=(0,r.useMemo)(()=>{if(Z){let e=Z.find(e=>e.id==="timetable_".concat(null==t?void 0:t.uid));if(e)return e.slots||[]}return[]},[Z,t]),Y=(0,ej.o)({teachers:z,classes:V,substitutions:B,timeSlots:W}),X=(0,r.useMemo)(()=>{let e=new Map;return(z||[]).forEach(t=>{let s=(0,P.o)(new Date),a=(t.absences||[]).filter(e=>{try{return(0,C.r)((0,P.o)(new Date(e.date)),s)}catch(e){return!1}});a.length>0&&!e.has(t.id)&&e.set(t.id,{teacher:t,absences:a})}),Array.from(e.values())},[z,Y]);(0,r.useMemo)(()=>{let e=new Map,t=Y.filter(e=>!e.isCovered&&(0,C.r)(e.date,new Date));t.forEach(t=>{e.has(t.classId)||e.set(t.classId,{classId:t.classId,className:t.className,lessons:[]}),e.get(t.classId).lessons.push(t)});let s=new Set;Y.forEach(e=>{e.isCovered&&(0,C.r)(e.date,new Date)&&!t.some(t=>t.classId===e.classId)&&s.add(e.classId)});let a=Array.from(e.values()).map(e=>({...e,isFullyCovered:!1}));return s.forEach(t=>{let s=V.find(e=>e.id===t);s&&!e.has(t)&&a.push({classId:t,className:s.name,lessons:[],isFullyCovered:!0})}),a},[Y,V]);let K=async e=>{if(!i||!t)return;let s=(0,y.H9)(i,"settings","timetable_".concat(t.uid)),a={slots:e,userId:t.uid},r=(0,y.wP)(i);r.set(s,a,{merge:!0});try{await (0,eg.j)(r,{operation:"update",path:s.path,data:a})}catch(e){console.error("Failed to update timetable settings.",e)}},ee=async()=>{if(!i||!t)return;let e=(0,y.wP)(i);try{let s=(0,y.P)((0,y.rJ)(i,"teachers"),(0,y._M)("userId","==",t.uid)),a=(0,y.P)((0,y.rJ)(i,"classes"),(0,y._M)("userId","==",t.uid)),r=(0,y.P)((0,y.rJ)(i,"substitutions"),(0,y._M)("userId","==",t.uid)),[n,l,o]=await Promise.all([(0,y.GG)(s),(0,y.GG)(a),(0,y.GG)(r)]);n.forEach(t=>{e.update(t.ref,{schedule:{},absences:[]})}),l.forEach(t=>{e.update(t.ref,{schedule:{}})}),o.forEach(t=>{e.delete(t.ref)}),await (0,eg.j)(e,{operation:"delete",path:"user_data/".concat(t.uid,"/new_year_reset")}),d({title:"השנה החדשה החלה!",description:"כל מערכות השעות, ההיעדרויות וההחלפות אופסו."})}catch(e){console.error("Failed to start new year:",e),d({variant:"destructive",title:"שגיאה",description:"לא ניתן היה לאפס את נתוני השנה. אנא נסה שוב."})}},et=(e,t,s,a,r)=>{let n=[],i=[],l=a.filter(t=>t.id!==e.id),d=e=>{if(!e||"string"!=typeof e||!e.includes(":"))return 0;let[t,s]=e.split(":").map(Number);return t+s/60};return t.forEach(t=>{var a;let o=(0,P.o)(new Date(t.date)),c=(0,T.GP)(o,"EEEE",{locale:S.he}),m=null==(a=e.schedule)?void 0:a[c];m&&Object.entries(m).forEach(a=>{let[c,m]=a;(Array.isArray(m)?m:m?[m]:[]).forEach(a=>{let m=r.find(e=>e.start===c);if(!m)return;let u=d(m.start),x=d(m.end),f=d(t.startTime),p=d(t.endTime),h=t.isAllDay||u<p&&x>f,b=s.find(e=>e.id===a.classId);if(h&&b){let t=(0,ey.o0)({subject:a.subject,date:o,time:c},l,s,r).then(t=>{n.push({classId:b.id,className:b.name,date:o,time:c,lesson:a,absentTeacherName:e.name,recommendation:t.recommendation,recommendationId:t.recommendationId,reasoning:t.reasoning,substituteOptions:t.substituteOptions})});i.push(t)}})})}),Promise.all(i).then(()=>n)},es=async(e,s)=>{if(!i||!t)return;let a=(0,y.wP)(i),r=(0,y.H9)(i,"teachers",e.id),n=new Set(s.map(e=>(0,P.o)(new Date(e.date)).getTime())),l=(e.absences||[]).filter(e=>{let t;try{if(t="string"==typeof e.date?new Date(e.date):e.date,isNaN(t.getTime()))return!0}catch(e){return!0}return!n.has((0,P.o)(t).getTime())}),d=s.map(e=>({...e,date:(0,P.o)(new Date(e.date)).toISOString()}));a.update(r,{absences:[...l,...d]}),await (0,eg.j)(a,{operation:"update",path:r.path,data:{absences:"..."}});let o=V||[],c=await et(e,d,o,z||[],W);c.length>0?R({results:c,absentTeacher:e,absenceDays:d}):R(null)},ea=async e=>{if(!e||!z||!W)return;let t=z.filter(t=>t.id!==e.absentTeacherId),s=(0,P.o)(new Date(e.date)),a=z.find(t=>t.id===e.absentTeacherId);if(!a)return void d({variant:"destructive",title:"שגיאה",description:"לא ניתן למצוא את המורה החסר."});try{let r=await (0,ey.o0)({subject:e.subject,date:s,time:e.time},t,V,W);R({results:[{classId:e.classId,className:e.className,date:s,time:e.time,lesson:{...e,teacherId:e.absentTeacherId},absentTeacherName:a.name,recommendation:r.recommendation,recommendationId:r.recommendationId,reasoning:r.reasoning,substituteOptions:r.substituteOptions}],absentTeacher:a,absenceDays:[{date:s.toISOString(),startTime:"08:00",endTime:"16:00",isAllDay:!0,reason:"Generated from panel"}]})}catch(e){console.error("Error finding substitute:",e),d({variant:"destructive",title:"שגיאה",description:"אירעה שגיאה בחיפוש מחליף."})}},er=async(e,s)=>{var a;if(!i||!t)return;let r={date:(0,T.GP)(new Date(s.date),"yyyy-MM-dd"),time:s.time,classId:s.classId,className:s.className,absentTeacherId:s.lesson.teacherId,absentTeacherName:(null==(a=z.find(e=>e.id===s.lesson.teacherId))?void 0:a.name)||"לא ידוע",substituteTeacherId:e.id,substituteTeacherName:e.name,subject:s.lesson.subject,userId:t.uid},n=(0,y.H9)((0,y.rJ)(i,"substitutions")),l=(0,y.wP)(i);l.set(n,{...r,id:n.id,createdAt:new Date().toISOString()});try{await (0,eg.j)(l,{operation:"create",path:n.path,data:r}),d({title:"השיבוץ הושלם",description:"".concat(e.name," שובץ להחליף בשיעור ").concat(s.lesson.subject," בכיתה ").concat(s.className,".")}),R(null)}catch(e){console.error("Error assigning substitute:",e),d({variant:"destructive",title:"שגיאת שיבוץ",description:"לא ניתן היה לשבץ את המורה המחליף."})}};(0,r.useEffect)(()=>{s||t||n.push("/login")},[t,s,n]);let en=s||M||q||L||H,ei=!en&&t&&0===W.length;return en?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-background",children:(0,a.jsx)(l.A,{className:"h-10 w-10 animate-spin text-primary"})}):ei?(0,a.jsxs)("div",{className:"flex flex-col min-h-screen bg-background",children:[(0,a.jsx)(b,{}),(0,a.jsx)("main",{className:"flex-1 p-4 sm:p-6 md:p-8",children:(0,a.jsx)(ek,{timeSlots:[],onUpdate:K,isInitialSetup:ei,onStartNewYear:ee})})]}):(0,a.jsxs)("div",{className:"flex flex-col min-h-screen bg-background",children:[(0,a.jsx)(b,{}),(0,a.jsxs)("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 items-start",children:[(0,a.jsxs)(A.Zp,{className:"border-l-4 border-l-destructive shadow-md h-full",children:[(0,a.jsxs)(A.aR,{className:"pb-3",children:[(0,a.jsxs)(A.ZB,{className:"text-xl flex items-center gap-2",children:[(0,a.jsx)(w.A,{className:"text-destructive h-5 w-5"}),"מורים חסרים היום"]}),(0,a.jsx)(A.BT,{children:"סקירה מהירה של ההיעדרויות להיום."})]}),(0,a.jsx)(A.Wu,{children:X&&X.length>0?(0,a.jsx)("div",{className:"grid gap-4 sm:grid-cols-1",children:X.map(e=>{if(!e)return null;let{teacher:t,absences:s}=e,r=s.map(e=>e.isAllDay?"יום שלם":"".concat(e.startTime,"-").concat(e.endTime)).join("; ");return(0,a.jsx)("div",{className:"flex flex-col justify-between p-4 bg-secondary/30 rounded-xl border",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("span",{className:"font-semibold text-lg block",children:t.name}),(0,a.jsx)("div",{className:"text-xs text-center text-destructive-foreground bg-destructive/80 rounded-md px-2 py-1 font-medium inline-block mt-1",children:r})]}),(0,a.jsxs)(u.$,{variant:"ghost",size:"sm",className:"h-8 -mr-2",onClick:()=>x({teacher:t,existingAbsences:s}),children:[(0,a.jsx)(k.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"mr-1",children:"ערוך"})]})]})},t.id)})}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center text-center p-8 text-muted-foreground bg-secondary/20 rounded-lg",children:[(0,a.jsx)(I.A,{className:"w-10 h-10 mb-2 opacity-50"}),(0,a.jsx)("p",{className:"font-medium",children:"כל המורים נוכחים!"}),(0,a.jsx)("p",{className:"text-xs",children:"אין היעדרויות רשומות להיום."})]})})]}),(0,a.jsx)(eC,{teachers:z,classes:V,substitutions:B,timeSlots:W,onAssignSubstitute:ea})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"sticky top-[57px] z-40 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 py-2 -mx-4 px-4 sm:mx-0 sm:px-0 mb-6 border-b sm:border-none",children:(0,a.jsxs)("div",{className:"flex items-center gap-2 overflow-x-auto pb-2 sm:pb-0 no-scrollbar sm:grid sm:w-full sm:grid-cols-6 sm:max-w-4xl sm:mx-auto sm:h-auto sm:p-1 sm:bg-muted/50 sm:backdrop-blur-sm sm:rounded-full",children:[(0,a.jsx)(u.$,{variant:"teachers"===o?"secondary":"ghost",onClick:()=>c("teachers"),className:"rounded-full whitespace-nowrap px-4 py-2 h-auto text-sm sm:text-base sm:py-2.5 transition-all ".concat("teachers"===o?"bg-secondary text-secondary-foreground shadow-sm":"text-muted-foreground hover:bg-muted"),children:"פרופילי מורים"}),(0,a.jsx)(u.$,{variant:"classes"===o?"secondary":"ghost",onClick:()=>c("classes"),className:"rounded-full whitespace-nowrap px-4 py-2 h-auto text-sm sm:text-base sm:py-2.5 transition-all ".concat("classes"===o?"bg-secondary text-secondary-foreground shadow-sm":"text-muted-foreground hover:bg-muted"),children:"כיתות לימוד"}),(0,a.jsx)(u.$,{variant:"timetable"===o?"secondary":"ghost",onClick:()=>c("timetable"),className:"rounded-full whitespace-nowrap px-4 py-2 h-auto text-sm sm:text-base sm:py-2.5 transition-all ".concat("timetable"===o?"bg-secondary text-secondary-foreground shadow-sm":"text-muted-foreground hover:bg-muted"),children:"זמינות מחליפים"}),(0,a.jsx)(u.$,{variant:"calendar"===o?"secondary":"ghost",onClick:()=>c("calendar"),className:"rounded-full whitespace-nowrap px-4 py-2 h-auto text-sm sm:text-base sm:py-2.5 transition-all ".concat("calendar"===o?"bg-secondary text-secondary-foreground shadow-sm":"text-muted-foreground hover:bg-muted"),children:"לוח שנה"}),(0,a.jsx)(u.$,{variant:"statistics"===o?"secondary":"ghost",onClick:()=>c("statistics"),className:"rounded-full whitespace-nowrap px-4 py-2 h-auto text-sm sm:text-base sm:py-2.5 transition-all ".concat("statistics"===o?"bg-secondary text-secondary-foreground shadow-sm":"text-muted-foreground hover:bg-muted"),children:"סטטיסטיקות"}),(0,a.jsx)(u.$,{variant:"settings"===o?"secondary":"ghost",onClick:()=>c("settings"),className:"rounded-full whitespace-nowrap px-4 py-2 h-auto text-sm sm:text-base sm:py-2.5 transition-all ".concat("settings"===o?"bg-secondary text-secondary-foreground shadow-sm":"text-muted-foreground hover:bg-muted"),children:"הגדרות"}),(0,a.jsx)(u.$,{variant:"majors"===o?"secondary":"ghost",onClick:()=>c("majors"),className:"rounded-full whitespace-nowrap px-4 py-2 h-auto text-sm sm:text-base sm:py-2.5 transition-all ".concat("majors"===o?"bg-secondary text-secondary-foreground shadow-sm":"text-muted-foreground hover:bg-muted"),children:"מגמות"})]})}),(0,a.jsxs)(j.N,{mode:"wait",children:["teachers"===o&&(0,a.jsx)(N.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"mt-0",children:(0,a.jsx)(eN,{onMarkAbsent:e=>x({teacher:e})})},"teachers"),"classes"===o&&(0,a.jsx)(N.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"mt-0",children:(0,a.jsx)(ew,{})},"classes"),"majors"===o&&(0,a.jsx)(N.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"mt-0",children:(0,a.jsx)(eT,{teachers:z,classes:V,timeSlots:W})},"majors"),"timetable"===o&&(0,a.jsx)(N.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"mt-0",children:(0,a.jsx)(ev,{substitutions:B})},"timetable"),"calendar"===o&&(0,a.jsx)(N.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"mt-0",children:(0,a.jsx)(eA,{})},"calendar"),"settings"===o&&(0,a.jsx)(N.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"mt-0",children:(0,a.jsx)(ek,{timeSlots:W,onUpdate:K,onStartNewYear:ee})},"settings"),"statistics"===o&&(0,a.jsx)(N.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"mt-0",children:(0,a.jsx)(eP,{substitutions:B})},"statistics"),"majors"===o&&(0,a.jsx)(N.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"mt-0",children:(0,a.jsx)(eT,{teachers:z,classes:V,timeSlots:W})},"majors")]})]})]}),(0,a.jsx)(Q,{isOpen:!!m,onOpenChange:e=>!e&&x(null),teacher:null!=(e=null==m?void 0:m.teacher)?e:null,existingAbsences:null==m?void 0:m.existingAbsences,onConfirm:es}),(0,a.jsx)(eb,{isOpen:!!_,onOpenChange:e=>!e&&R(null),recommendationResult:_,onAssign:er}),(0,a.jsx)(eI,{isOpen:!!f,onOpenChange:e=>!e&&h(null),schoolClass:f,allTeachers:z||[],isEditing:!1,allClasses:V||[],timeSlots:W})]})}},8246:(e,t,s)=>{"use strict";s.d(t,{o:()=>d});var a=s(12115),r=s(80644),n=s(76959),i=s(70831),l=s(91950);function d(e){let{teachers:t,classes:s,substitutions:d,timeSlots:o,dateRange:c}=e;return(0,a.useMemo)(()=>{if(!t||!s||!d||!o)return[];let e=c?(0,r.o)(c.start):(0,r.o)(new Date),a=c?(0,r.o)(c.end):e,m=e=>{if(!e||"string"!=typeof e||!e.includes(":"))return 0;let[t,s]=e.split(":").map(Number);return t+s/60},u=[],x=e;for(;x<=a;)t.forEach(e=>{var t;let a=(e.absences||[]).filter(e=>{try{let t="string"==typeof e.date?new Date(e.date):e.date;return(0,n.r)((0,r.o)(t),x)}catch(e){return!1}});if(0===a.length)return;let i=l.B[x.getDay()];Object.entries((null==(t=e.schedule)?void 0:t[i])||{}).forEach(t=>{let[i,l]=t,c=Array.isArray(l)?l:l?[l]:[];c&&0!==c.length&&c.forEach(t=>{if(!t||!t.classId)return;let l=o.find(e=>e.start===i);if(l&&a.some(e=>{if(e.isAllDay)return!0;let t=m(l.start),s=m(l.end),a=m(e.startTime);return t<m(e.endTime)&&s>a})){let a=s.find(e=>e.id===t.classId);if(a){let s=!!(d||[]).find(s=>(0,n.r)((0,r.o)(new Date(s.date)),x)&&s.time===i&&s.classId===t.classId&&s.absentTeacherId===e.id);u.push({...t,date:x,time:i,className:a.name,classId:a.id,absentTeacherName:e.name,absentTeacherId:e.id,isCovered:s})}}})})}),x=(0,i.f)(x,1);return u},[t,s,d,o,c])}},17759:(e,t,s)=>{"use strict";s.d(t,{C5:()=>b,MJ:()=>h,eI:()=>f,lR:()=>p,lV:()=>o,zB:()=>m});var a=s(95155),r=s(12115),n=s(66634),i=s(62177),l=s(59434),d=s(85057);let o=i.Op,c=r.createContext({}),m=e=>{let{...t}=e;return(0,a.jsx)(c.Provider,{value:{name:t.name},children:(0,a.jsx)(i.xI,{...t})})},u=()=>{let e=r.useContext(c),t=r.useContext(x),{getFieldState:s,formState:a}=(0,i.xW)(),n=s(e.name,a);if(!e)throw Error("useFormField should be used within <FormField>");let{id:l}=t;return{id:l,name:e.name,formItemId:"".concat(l,"-form-item"),formDescriptionId:"".concat(l,"-form-item-description"),formMessageId:"".concat(l,"-form-item-message"),...n}},x=r.createContext({}),f=r.forwardRef((e,t)=>{let{className:s,...n}=e,i=r.useId();return(0,a.jsx)(x.Provider,{value:{id:i},children:(0,a.jsx)("div",{ref:t,className:(0,l.cn)("space-y-2",s),...n})})});f.displayName="FormItem";let p=r.forwardRef((e,t)=>{let{className:s,...r}=e,{error:n,formItemId:i}=u();return(0,a.jsx)(d.J,{ref:t,className:(0,l.cn)(n&&"text-destructive",s),htmlFor:i,...r})});p.displayName="FormLabel";let h=r.forwardRef((e,t)=>{let{...s}=e,{error:r,formItemId:i,formDescriptionId:l,formMessageId:d}=u();return(0,a.jsx)(n.DX,{ref:t,id:i,"aria-describedby":r?"".concat(l," ").concat(d):"".concat(l),"aria-invalid":!!r,...s})});h.displayName="FormControl",r.forwardRef((e,t)=>{let{className:s,...r}=e,{formDescriptionId:n}=u();return(0,a.jsx)("p",{ref:t,id:n,className:(0,l.cn)("text-sm text-muted-foreground",s),...r})}).displayName="FormDescription";let b=r.forwardRef((e,t)=>{var s;let{className:r,children:n,...i}=e,{error:d,formMessageId:o}=u(),c=d?String(null!=(s=null==d?void 0:d.message)?s:""):n;return c?(0,a.jsx)("p",{ref:t,id:o,className:(0,l.cn)("text-sm font-medium text-destructive",r),...i,children:c}):null});b.displayName="FormMessage"},22346:(e,t,s)=>{"use strict";s.d(t,{w:()=>l});var a=s(95155),r=s(12115),n=s(87489),i=s(59434);let l=r.forwardRef((e,t)=>{let{className:s,orientation:r="horizontal",decorative:l=!0,...d}=e;return(0,a.jsx)(n.b,{ref:t,decorative:l,orientation:r,className:(0,i.cn)("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",s),...d})});l.displayName=n.b.displayName},26126:(e,t,s)=>{"use strict";s.d(t,{E:()=>l});var a=s(95155);s(12115);var r=s(74466),n=s(59434);let i=(0,r.F)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:t,variant:s,...r}=e;return(0,a.jsx)("div",{className:(0,n.cn)(i({variant:s}),t),...r})}},30285:(e,t,s)=>{"use strict";s.d(t,{$:()=>o,r:()=>d});var a=s(95155),r=s(12115),n=s(66634),i=s(74466),l=s(59434);let d=(0,i.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=r.forwardRef((e,t)=>{let{className:s,variant:r,size:i,asChild:o=!1,...c}=e,m=o?n.DX:"button";return(0,a.jsx)(m,{className:(0,l.cn)(d({variant:r,size:i,className:s})),ref:t,...c})});o.displayName="Button"},30356:(e,t,s)=>{"use strict";s.d(t,{C:()=>o,z:()=>d});var a=s(95155),r=s(12115),n=s(54059),i=s(70154),l=s(59434);let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.bL,{className:(0,l.cn)("grid gap-2",s),...r,ref:t})});d.displayName=n.bL.displayName;let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.q7,{ref:t,className:(0,l.cn)("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),...r,children:(0,a.jsx)(n.C1,{className:"flex items-center justify-center",children:(0,a.jsx)(i.A,{className:"h-2.5 w-2.5 fill-current text-current"})})})});o.displayName=n.q7.displayName},33143:(e,t,s)=>{"use strict";s.d(t,{_:()=>i});var a=s(95155),r=s(38274),n=s(10518);function i(e){let{message:t="הפעולה בוצעה בהצלחה!",size:s=80}=e;return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center p-6 text-center",children:[(0,a.jsxs)("div",{className:"relative flex items-center justify-center mb-4",children:[(0,a.jsx)(r.P.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:260,damping:20,duration:.5},className:"bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center",style:{width:1.5*s,height:1.5*s},children:(0,a.jsx)(r.P.div,{initial:{pathLength:0,opacity:0},animate:{pathLength:1,opacity:1},transition:{duration:.5,delay:.2,ease:"easeInOut"},children:(0,a.jsx)(n.A,{className:"text-green-600 dark:text-green-400",size:s,strokeWidth:3})})}),[...Array(6)].map((e,t)=>(0,a.jsx)(r.P.div,{className:"absolute w-2 h-2 rounded-full bg-green-500",initial:{opacity:0,x:0,y:0},animate:{opacity:[0,1,0],x:Math.cos(60*t*(Math.PI/180))*s,y:Math.sin(60*t*(Math.PI/180))*s},transition:{duration:.6,delay:.3,ease:"easeOut"}},t))]}),(0,a.jsx)(r.P.h3,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4,duration:.4},className:"text-xl font-bold text-green-700 dark:text-green-400",children:t})]})}},40688:(e,t,s)=>{"use strict";s.d(t,{_9:()=>o,ax:()=>d,o0:()=>m});var a=s(79233),r=s(80644),n=s(76959);let i=["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"],l=e=>{if(!e||"string"!=typeof e||!e.includes(":"))return 0;let[t,s]=e.split(":").map(Number);return t+s/60};function d(e,t,s){var d,o;let c=i[(0,a.P)(t)],m="".concat(t.getHours().toString().padStart(2,"0"),":").concat(t.getMinutes().toString().padStart(2,"0")),u=s.find(e=>m>=e.start&&m<e.end);if(!u)return"unknown";let x=(0,r.o)(t),f=(e.absences||[]).filter(e=>(0,n.r)((0,r.o)(new Date(e.date)),x));if(f.length>0){let e=l(u.start);if(f.some(t=>{if(t.isAllDay)return!0;let s=l(t.startTime),a=l(t.endTime);return e>=s&&e<a}))return"absent"}let p=e.availability.find(e=>e.day===c);if(!p)return"not_in_school";let h=l(u.start);if(!p.slots.some(e=>{let t=l(e.start),s=l(e.end);return h>=t&&h<s}))return"not_in_school";let b=null==(o=e.schedule)||null==(d=o[c])?void 0:d[u.start],g=Array.isArray(b)?b:b?[b]:[];return g&&g.length>0?"teaching":"available"}function o(e,t,s,r,n){let l=i[(0,a.P)(t)];return r.some(t=>{var a;if(t.id===n)return!1;let r=null==(a=t.schedule[l])?void 0:a[s],i=Array.isArray(r)?r:r?[r]:[];return i&&i.some(t=>t.teacherId===e)})}let c=(e,t)=>{var s,a;let r=0;return e.subjects.includes(t.subject)&&(r+=10),(null==(s=e.preferences)?void 0:s.includes("כיתות בוגרות"))&&(r+=2),(null==(a=e.preferences)?void 0:a.includes("חינוך מיוחד"))&&"חינוך מיוחד"===t.subject&&(r+=5),r};async function m(e,t,s,d){let m=t.filter(t=>(function(e,t,s,d){var o,c;let m=d.find(e=>e.start===s);if(!m)return!1;let u=i[(0,a.P)(t)],x=e.availability.find(e=>e.day===u);if(!x)return!1;let f=l(m.start);if(!x.slots.some(e=>{let t=l(e.start),s=l(e.end);return f>=t&&f<s}))return!1;let p=null==(c=e.schedule)||null==(o=c[u])?void 0:o[s],h=Array.isArray(p)?p:p?[p]:[];if(h&&h.length>0)return!1;let b=(e.absences||[]).filter(e=>(0,n.r)((0,r.o)(new Date(e.date)),(0,r.o)(t)));return!(b.length>0&&b.some(e=>{if(e.isAllDay)return!0;let t=l(e.startTime),s=l(e.endTime);return f>=t&&f<s}))&&!0})(t,e.date,e.time,d)&&!o(t.id,e.date,e.time,s));if(0===m.length)return{recommendation:null,recommendationId:null,reasoning:"לא נמצאו מורים פנויים.",substituteOptions:[]};let u=m.filter(t=>t.subjects.includes(e.subject)),x=[],f=null,p=null;return u.length>0?(f=u.map(t=>({teacher:t,score:c(t,e)})).sort((e,t)=>t.score-e.score)[0].teacher,p="".concat(f.name," מומלץ/ת כי הוא/היא פנוי/ה ומוכשר/ת ב").concat(e.subject,"."),f.preferences&&(p+=" העדפות: ".concat(f.preferences,".")),x=u):(f=m[0],p="שימו לב: לא נמצא מורה פנוי המוכשר ב".concat(e.subject,". ").concat(f.name," מוצע/ת כמפקח/ת בלבד."),x=m),{recommendation:(null==f?void 0:f.name)||null,recommendationId:(null==f?void 0:f.id)||null,reasoning:p,substituteOptions:x}}},44838:(e,t,s)=>{"use strict";s.d(t,{SQ:()=>u,_2:()=>x,mB:()=>f,rI:()=>c,ty:()=>m});var a=s(95155),r=s(12115),n=s(76215),i=s(73158),l=s(10518),d=s(70154),o=s(59434);let c=n.bL,m=n.l9;n.YJ,n.ZL,n.Pb,n.z6,r.forwardRef((e,t)=>{let{className:s,inset:r,children:l,...d}=e;return(0,a.jsxs)(n.ZP,{ref:t,className:(0,o.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",r&&"pl-8",s),...d,children:[l,(0,a.jsx)(i.A,{className:"mr-auto h-4 w-4"})]})}).displayName=n.ZP.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.G5,{ref:t,className:(0,o.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...r})}).displayName=n.G5.displayName;let u=r.forwardRef((e,t)=>{let{className:s,sideOffset:r=4,...i}=e;return(0,a.jsx)(n.ZL,{children:(0,a.jsx)(n.UC,{ref:t,sideOffset:r,className:(0,o.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...i})})});u.displayName=n.UC.displayName;let x=r.forwardRef((e,t)=>{let{className:s,inset:r,...i}=e;return(0,a.jsx)(n.q7,{ref:t,className:(0,o.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r&&"pr-8",s),...i})});x.displayName=n.q7.displayName,r.forwardRef((e,t)=>{let{className:s,children:r,checked:i,...d}=e;return(0,a.jsxs)(n.H_,{ref:t,className:(0,o.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pr-8 pl-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:i,...d,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(n.VF,{children:(0,a.jsx)(l.A,{className:"h-4 w-4"})})}),r]})}).displayName=n.H_.displayName,r.forwardRef((e,t)=>{let{className:s,children:r,...i}=e;return(0,a.jsxs)(n.hN,{ref:t,className:(0,o.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pr-8 pl-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...i,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(n.VF,{children:(0,a.jsx)(d.A,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=n.hN.displayName,r.forwardRef((e,t)=>{let{className:s,inset:r,...i}=e;return(0,a.jsx)(n.JU,{ref:t,className:(0,o.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pr-8",s),...i})}).displayName=n.JU.displayName;let f=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.wv,{ref:t,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",s),...r})});f.displayName=n.wv.displayName},47262:(e,t,s)=>{"use strict";s.d(t,{S:()=>d});var a=s(95155),r=s(12115),n=s(76981),i=s(10518),l=s(59434);let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.bL,{ref:t,className:(0,l.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...r,children:(0,a.jsx)(n.C1,{className:(0,l.cn)("flex items-center justify-center text-current"),children:(0,a.jsx)(i.A,{className:"h-4 w-4"})})})});d.displayName=n.bL.displayName},47906:(e,t,s)=>{"use strict";s.d(t,{a:()=>r});var a=s(12115);function r(){let[e,t]=a.useState(void 0);return a.useEffect(()=>{let e=window.matchMedia("(max-width: ".concat(767,"px)")),s=()=>{t(window.innerWidth<768)};return e.addEventListener("change",s),t(window.innerWidth<768),()=>e.removeEventListener("change",s)},[]),!!e}},54165:(e,t,s)=>{"use strict";s.d(t,{Cf:()=>u,Es:()=>f,HM:()=>c,L3:()=>p,c7:()=>x,lG:()=>d,rr:()=>h});var a=s(95155),r=s(12115),n=s(45821),i=s(25318),l=s(59434);let d=n.bL;n.l9;let o=n.ZL,c=n.bm,m=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.hJ,{ref:t,className:(0,l.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r})});m.displayName=n.hJ.displayName;let u=r.forwardRef((e,t)=>{let{className:s,children:r,...d}=e;return(0,a.jsxs)(o,{children:[(0,a.jsx)(m,{}),(0,a.jsxs)(n.UC,{ref:t,className:(0,l.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...d,children:[r,(0,a.jsxs)(n.bm,{className:"absolute left-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(i.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=n.UC.displayName;let x=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,l.cn)("flex flex-col space-y-1.5 text-center sm:text-right",t),...s})};x.displayName="DialogHeader";let f=e=>{let{className:t,...s}=e;return(0,a.jsx)("div",{className:(0,l.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:gap-2",t),...s})};f.displayName="DialogFooter";let p=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.hE,{ref:t,className:(0,l.cn)("text-lg font-semibold leading-none tracking-tight",s),...r})});p.displayName=n.hE.displayName;let h=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.VY,{ref:t,className:(0,l.cn)("text-sm text-muted-foreground",s),...r})});h.displayName=n.VY.displayName},62523:(e,t,s)=>{"use strict";s.d(t,{p:()=>i});var a=s(95155),r=s(12115),n=s(59434);let i=r.forwardRef((e,t)=>{let{className:s,type:r,...i}=e;return(0,a.jsx)("input",{type:r,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...i})});i.displayName="Input"},66424:(e,t,s)=>{"use strict";s.d(t,{$:()=>d,F:()=>l});var a=s(95155),r=s(12115),n=s(47655),i=s(59434);let l=r.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,a.jsxs)(n.bL,{ref:t,className:(0,i.cn)("relative overflow-hidden",s),...l,children:[(0,a.jsx)(n.LM,{className:"h-full w-full rounded-[inherit]",children:r}),(0,a.jsx)(d,{}),(0,a.jsx)(n.OK,{})]})});l.displayName=n.bL.displayName;let d=r.forwardRef((e,t)=>{let{className:s,orientation:r="vertical",...l}=e;return(0,a.jsx)(n.VM,{ref:t,orientation:r,className:(0,i.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",s),...l,children:(0,a.jsx)(n.lr,{className:"relative flex-1 rounded-full bg-border"})})});d.displayName=n.VM.displayName},66695:(e,t,s)=>{"use strict";s.d(t,{BT:()=>o,Wu:()=>c,ZB:()=>d,Zp:()=>i,aR:()=>l,wL:()=>m});var a=s(95155),r=s(12115),n=s(59434);let i=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...r})});i.displayName="Card";let l=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",s),...r})});l.displayName="CardHeader";let d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("h3",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",s),...r})});d.displayName="CardTitle";let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",s),...r})});o.displayName="CardDescription";let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",s),...r})});c.displayName="CardContent";let m=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",s),...r})});m.displayName="CardFooter"},73669:(e,t,s)=>{Promise.resolve().then(s.bind(s,5062))},85057:(e,t,s)=>{"use strict";s.d(t,{J:()=>o});var a=s(95155),r=s(12115),n=s(40968),i=s(74466),l=s(59434);let d=(0,i.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(n.b,{ref:t,className:(0,l.cn)(d(),s),...r})});o.displayName=n.b.displayName},85511:(e,t,s)=>{"use strict";s.d(t,{V:()=>o});var a=s(95155);s(12115);var r=s(73158),n=s(965),i=s(73465),l=s(59434),d=s(30285);function o(e){let{className:t,classNames:s,showOutsideDays:o=!0,...c}=e;return(0,a.jsx)(i.hv,{dir:"rtl",showOutsideDays:o,className:(0,l.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,l.cn)((0,d.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,l.cn)((0,d.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...s},components:{IconLeft:e=>{let{...t}=e;return(0,a.jsx)(r.A,{className:"h-4 w-4"})},IconRight:e=>{let{...t}=e;return(0,a.jsx)(n.A,{className:"h-4 w-4"})}},...c})}o.displayName="Calendar"},91950:(e,t,s)=>{"use strict";s.d(t,{B:()=>a});let a=["ראשון","שני","שלישי","רביעי","חמישי","שישי"]},97714:(e,t,s)=>{"use strict";s.d(t,{j:()=>n});var a=s(3310),r=s(40610);function n(e,t){return e.commit().catch(e=>{let s=new r.$({operation:t.operation,path:t.path,requestResourceData:t.data});throw a.d.emit("permission-error",s),s})}}},e=>{var t=t=>e(e.s=t);e.O(0,[992,416,469,925,395,41,892,441,684,358],()=>t(73669)),_N_E=e.O()}]);