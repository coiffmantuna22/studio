(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{14636:(e,t,a)=>{"use strict";a.d(t,{AM:()=>i,Wv:()=>d,hl:()=>o});var s=a(95155),r=a(12115),n=a(98176),l=a(59434);let i=n.bL,d=n.l9,o=r.forwardRef((e,t)=>{let{className:a,align:r="center",sideOffset:i=4,...d}=e;return(0,s.jsx)(n.ZL,{children:(0,s.jsx)(n.UC,{ref:t,align:r,sideOffset:i,className:(0,l.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...d})})});o.displayName=n.UC.displayName},17759:(e,t,a)=>{"use strict";a.d(t,{C5:()=>b,MJ:()=>p,eI:()=>h,lR:()=>x,lV:()=>o,zB:()=>m});var s=a(95155),r=a(12115),n=a(66634),l=a(62177),i=a(59434),d=a(85057);let o=l.Op,c=r.createContext({}),m=e=>{let{...t}=e;return(0,s.jsx)(c.Provider,{value:{name:t.name},children:(0,s.jsx)(l.xI,{...t})})},u=()=>{let e=r.useContext(c),t=r.useContext(f),{getFieldState:a,formState:s}=(0,l.xW)(),n=a(e.name,s);if(!e)throw Error("useFormField should be used within <FormField>");let{id:i}=t;return{id:i,name:e.name,formItemId:"".concat(i,"-form-item"),formDescriptionId:"".concat(i,"-form-item-description"),formMessageId:"".concat(i,"-form-item-message"),...n}},f=r.createContext({}),h=r.forwardRef((e,t)=>{let{className:a,...n}=e,l=r.useId();return(0,s.jsx)(f.Provider,{value:{id:l},children:(0,s.jsx)("div",{ref:t,className:(0,i.cn)("space-y-2",a),...n})})});h.displayName="FormItem";let x=r.forwardRef((e,t)=>{let{className:a,...r}=e,{error:n,formItemId:l}=u();return(0,s.jsx)(d.J,{ref:t,className:(0,i.cn)(n&&"text-destructive",a),htmlFor:l,...r})});x.displayName="FormLabel";let p=r.forwardRef((e,t)=>{let{...a}=e,{error:r,formItemId:l,formDescriptionId:i,formMessageId:d}=u();return(0,s.jsx)(n.DX,{ref:t,id:l,"aria-describedby":r?"".concat(i," ").concat(d):"".concat(i),"aria-invalid":!!r,...a})});p.displayName="FormControl",r.forwardRef((e,t)=>{let{className:a,...r}=e,{formDescriptionId:n}=u();return(0,s.jsx)("p",{ref:t,id:n,className:(0,i.cn)("text-sm text-muted-foreground",a),...r})}).displayName="FormDescription";let b=r.forwardRef((e,t)=>{var a;let{className:r,children:n,...l}=e,{error:d,formMessageId:o}=u(),c=d?String(null!=(a=null==d?void 0:d.message)?a:""):n;return c?(0,s.jsx)("p",{ref:t,id:o,className:(0,i.cn)("text-sm font-medium text-destructive",r),...l,children:c}):null});b.displayName="FormMessage"},22346:(e,t,a)=>{"use strict";a.d(t,{w:()=>i});var s=a(95155),r=a(12115),n=a(87489),l=a(59434);let i=r.forwardRef((e,t)=>{let{className:a,orientation:r="horizontal",decorative:i=!0,...d}=e;return(0,s.jsx)(n.b,{ref:t,decorative:i,orientation:r,className:(0,l.cn)("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",a),...d})});i.displayName=n.b.displayName},26126:(e,t,a)=>{"use strict";a.d(t,{E:()=>i});var s=a(95155);a(12115);var r=a(74466),n=a(59434);let l=(0,r.F)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i(e){let{className:t,variant:a,...r}=e;return(0,s.jsx)("div",{className:(0,n.cn)(l({variant:a}),t),...r})}},30285:(e,t,a)=>{"use strict";a.d(t,{$:()=>o,r:()=>d});var s=a(95155),r=a(12115),n=a(66634),l=a(74466),i=a(59434);let d=(0,l.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=r.forwardRef((e,t)=>{let{className:a,variant:r,size:l,asChild:o=!1,...c}=e,m=o?n.DX:"button";return(0,s.jsx)(m,{className:(0,i.cn)(d({variant:r,size:l,className:a})),ref:t,...c})});o.displayName="Button"},40688:(e,t,a)=>{"use strict";a.d(t,{_9:()=>c,ax:()=>d,o0:()=>u,yW:()=>o});var s=a(79233),r=a(80644),n=a(76959);let l=["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"],i=e=>{if(!e||"string"!=typeof e||!e.includes(":"))return 0;let[t,a]=e.split(":").map(Number);return t+a/60};function d(e,t,a){var d,o;let c=l[(0,s.P)(t)],m="".concat(t.getHours().toString().padStart(2,"0"),":").concat(t.getMinutes().toString().padStart(2,"0")),u=a.find(e=>m>=e.start&&m<e.end);if(!u)return"unknown";let f=(0,r.o)(t),h=(e.absences||[]).filter(e=>(0,n.r)((0,r.o)(new Date(e.date)),f));if(h.length>0){let e=i(u.start);if(h.some(t=>{if(t.isAllDay)return!0;let a=i(t.startTime),s=i(t.endTime);return e>=a&&e<s}))return"absent"}let x=e.availability.find(e=>e.day===c);if(!x)return"not_in_school";let p=i(u.start);return x.slots.some(e=>{let t=i(e.start),a=i(e.end);return p>=t&&p<a})?(null==(o=e.schedule)||null==(d=o[c])?void 0:d[u.start])?"teaching":"available":"not_in_school"}function o(e,t,a,d){var o,c;let m=d.find(e=>e.start===a);if(!m)return!1;let u=l[(0,s.P)(t)],f=e.availability.find(e=>e.day===u);if(!f)return!1;let h=i(m.start);if(!f.slots.some(e=>{let t=i(e.start),a=i(e.end);return h>=t&&h<a})||(null==(c=e.schedule)||null==(o=c[u])?void 0:o[a]))return!1;let x=(e.absences||[]).filter(e=>(0,n.r)((0,r.o)(new Date(e.date)),(0,r.o)(t)));return!(x.length>0&&x.some(e=>{if(e.isAllDay)return!0;let t=i(e.startTime),a=i(e.endTime);return h>=t&&h<a}))&&!0}function c(e,t,a,r,n){let i=l[(0,s.P)(t)];return r.some(t=>{var s;if(t.id===n)return!1;let r=null==(s=t.schedule[i])?void 0:s[a];return(null==r?void 0:r.teacherId)===e})}let m=(e,t)=>{var a,s;let r=0;return e.subjects.includes(t.subject)&&(r+=10),(null==(a=e.preferences)?void 0:a.includes("כיתות בוגרות"))&&(r+=2),(null==(s=e.preferences)?void 0:s.includes("חינוך מיוחד"))&&"חינוך מיוחד"===t.subject&&(r+=5),r};async function u(e,t,a,s){let r=t.filter(t=>o(t,e.date,e.time,s)&&!c(t.id,e.date,e.time,a));if(0===r.length)return{recommendation:null,recommendationId:null,reasoning:"לא נמצאו מורים פנויים.",substituteOptions:[]};let n=r.filter(t=>t.subjects.includes(e.subject)),l=[],i=null,d=null;return n.length>0?(i=n.map(t=>({teacher:t,score:m(t,e)})).sort((e,t)=>t.score-e.score)[0].teacher,d="".concat(i.name," מומלץ/ת כי הוא/היא פנוי/ה ומוכשר/ת ב").concat(e.subject,"."),i.preferences&&(d+=" העדפות: ".concat(i.preferences,".")),l=n):(i=r[0],d="שימו לב: לא נמצא מורה פנוי המוכשר ב".concat(e.subject,". ").concat(i.name," מוצע/ת כמפקח/ת בלבד."),l=r),{recommendation:(null==i?void 0:i.name)||null,recommendationId:(null==i?void 0:i.id)||null,reasoning:d,substituteOptions:l}}},44838:(e,t,a)=>{"use strict";a.d(t,{SQ:()=>u,_2:()=>f,mB:()=>h,rI:()=>c,ty:()=>m});var s=a(95155),r=a(12115),n=a(76215),l=a(73158),i=a(10518),d=a(70154),o=a(59434);let c=n.bL,m=n.l9;n.YJ,n.ZL,n.Pb,n.z6,r.forwardRef((e,t)=>{let{className:a,inset:r,children:i,...d}=e;return(0,s.jsxs)(n.ZP,{ref:t,className:(0,o.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",r&&"pl-8",a),...d,children:[i,(0,s.jsx)(l.A,{className:"mr-auto h-4 w-4"})]})}).displayName=n.ZP.displayName,r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.G5,{ref:t,className:(0,o.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...r})}).displayName=n.G5.displayName;let u=r.forwardRef((e,t)=>{let{className:a,sideOffset:r=4,...l}=e;return(0,s.jsx)(n.ZL,{children:(0,s.jsx)(n.UC,{ref:t,sideOffset:r,className:(0,o.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...l})})});u.displayName=n.UC.displayName;let f=r.forwardRef((e,t)=>{let{className:a,inset:r,...l}=e;return(0,s.jsx)(n.q7,{ref:t,className:(0,o.cn)("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r&&"pr-8",a),...l})});f.displayName=n.q7.displayName,r.forwardRef((e,t)=>{let{className:a,children:r,checked:l,...d}=e;return(0,s.jsxs)(n.H_,{ref:t,className:(0,o.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pr-8 pl-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),checked:l,...d,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(n.VF,{children:(0,s.jsx)(i.A,{className:"h-4 w-4"})})}),r]})}).displayName=n.H_.displayName,r.forwardRef((e,t)=>{let{className:a,children:r,...l}=e;return(0,s.jsxs)(n.hN,{ref:t,className:(0,o.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pr-8 pl-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...l,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(n.VF,{children:(0,s.jsx)(d.A,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=n.hN.displayName,r.forwardRef((e,t)=>{let{className:a,inset:r,...l}=e;return(0,s.jsx)(n.JU,{ref:t,className:(0,o.cn)("px-2 py-1.5 text-sm font-semibold",r&&"pr-8",a),...l})}).displayName=n.JU.displayName;let h=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.wv,{ref:t,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",a),...r})});h.displayName=n.wv.displayName},54165:(e,t,a)=>{"use strict";a.d(t,{Cf:()=>u,Es:()=>h,HM:()=>c,L3:()=>x,c7:()=>f,lG:()=>d,rr:()=>p});var s=a(95155),r=a(12115),n=a(45821),l=a(25318),i=a(59434);let d=n.bL;n.l9;let o=n.ZL,c=n.bm,m=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.hJ,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r})});m.displayName=n.hJ.displayName;let u=r.forwardRef((e,t)=>{let{className:a,children:r,...d}=e;return(0,s.jsxs)(o,{children:[(0,s.jsx)(m,{}),(0,s.jsxs)(n.UC,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...d,children:[r,(0,s.jsxs)(n.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,s.jsx)(l.A,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=n.UC.displayName;let f=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-right",t),...a})};f.displayName="DialogHeader";let h=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:(0,i.cn)("flex flex-col-reverse sm:flex-row sm:justify-start sm:space-x-2 sm:space-x-reverse",t),...a})};h.displayName="DialogFooter";let x=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.hE,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",a),...r})});x.displayName=n.hE.displayName;let p=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.VY,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",a),...r})});p.displayName=n.VY.displayName},62523:(e,t,a)=>{"use strict";a.d(t,{p:()=>l});var s=a(95155),r=a(12115),n=a(59434);let l=r.forwardRef((e,t)=>{let{className:a,type:r,...l}=e;return(0,s.jsx)("input",{type:r,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...l})});l.displayName="Input"},66424:(e,t,a)=>{"use strict";a.d(t,{$:()=>d,F:()=>i});var s=a(95155),r=a(12115),n=a(47655),l=a(59434);let i=r.forwardRef((e,t)=>{let{className:a,children:r,...i}=e;return(0,s.jsxs)(n.bL,{ref:t,className:(0,l.cn)("relative overflow-hidden",a),...i,children:[(0,s.jsx)(n.LM,{className:"h-full w-full rounded-[inherit]",children:r}),(0,s.jsx)(d,{}),(0,s.jsx)(n.OK,{})]})});i.displayName=n.bL.displayName;let d=r.forwardRef((e,t)=>{let{className:a,orientation:r="vertical",...i}=e;return(0,s.jsx)(n.VM,{ref:t,orientation:r,className:(0,l.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...i,children:(0,s.jsx)(n.lr,{className:"relative flex-1 rounded-full bg-border"})})});d.displayName=n.VM.displayName},66695:(e,t,a)=>{"use strict";a.d(t,{BT:()=>o,Wu:()=>c,ZB:()=>d,Zp:()=>l,aR:()=>i,wL:()=>m});var s=a(95155),r=a(12115),n=a(59434);let l=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...r})});l.displayName="Card";let i=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",a),...r})});i.displayName="CardHeader";let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("h3",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",a),...r})});d.displayName="CardTitle";let o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",a),...r})});o.displayName="CardDescription";let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",a),...r})});c.displayName="CardContent";let m=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",a),...r})});m.displayName="CardFooter"},73669:(e,t,a)=>{Promise.resolve().then(a.bind(a,90219))},85057:(e,t,a)=>{"use strict";a.d(t,{J:()=>o});var s=a(95155),r=a(12115),n=a(40968),l=a(74466),i=a(59434);let d=(0,l.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(n.b,{ref:t,className:(0,i.cn)(d(),a),...r})});o.displayName=n.b.displayName},90219:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ek});var s=a(95155),r=a(12115),n=a(55028),l=a(87267),i=a(50172),d=a(33349),o=a(36936),c=a(68027),m=a(51362),u=a(30285),f=a(44838);function h(){let{setTheme:e}=(0,m.D)();return(0,s.jsxs)(f.rI,{children:[(0,s.jsx)(f.ty,{asChild:!0,children:(0,s.jsxs)(u.$,{variant:"ghost",size:"icon",children:[(0,s.jsx)(o.A,{className:"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),(0,s.jsx)(c.A,{className:"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),(0,s.jsx)("span",{className:"sr-only",children:"Toggle theme"})]})}),(0,s.jsxs)(f.SQ,{align:"end",children:[(0,s.jsx)(f._2,{onClick:()=>e("light"),children:"בהיר"}),(0,s.jsx)(f._2,{onClick:()=>e("dark"),children:"כהה"}),(0,s.jsx)(f._2,{onClick:()=>e("system"),children:"מערכת"})]})]})}var x=a(19599),p=a(59434);function b(){let e=(0,x.useAuth)(),{user:t,isUserLoading:a}=(0,x.useUser)(),[n,o]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{let e=()=>{o(window.scrollY>10)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]),(0,s.jsx)("header",{className:(0,p.cn)("sticky top-0 z-50 transition-all duration-300",n?"bg-card/80 backdrop-blur-sm border-b":"bg-transparent border-b border-transparent"),children:(0,s.jsx)("div",{className:"container mx-auto px-4 py-3 sm:px-6 md:px-8",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(l.A,{className:"h-7 w-7 text-primary"}),(0,s.jsx)("h1",{className:"text-xl font-bold tracking-tight text-foreground",children:"מורה מחליף"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[a?(0,s.jsx)(i.A,{className:"h-5 w-5 animate-spin"}):t?(0,s.jsx)(u.$,{variant:"ghost",size:"icon",onClick:()=>null==e?void 0:e.signOut(),children:(0,s.jsx)(d.A,{className:"h-5 w-5"})}):null,(0,s.jsx)(h,{})]})]})})})}var g=a(35695),j=a(35317),y=a(23769),v=a(31949),N=a(60960),w=a(97714),I=a(91950),k=a(66695),C=a(79233),A=a(80644),P=a(76959),O=a(40688),R=a(55594),S=a(62177),T=a(90221),_=a(83013),D=a(46375),z=a(54165),E=a(17759),J=a(62523),L=a(87481),M=a(51920),H=a(77223),F=a(34301),$=a(14636),U=a(73158),B=a(965),G=a(58049);function V(e){let{className:t,classNames:a,showOutsideDays:r=!0,...n}=e;return(0,s.jsx)(G.hv,{dir:"rtl",showOutsideDays:r,className:(0,p.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,p.cn)((0,u.r)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,p.cn)((0,u.r)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:e=>{let{...t}=e;return(0,s.jsx)(U.A,{className:"h-4 w-4"})},IconRight:e=>{let{...t}=e;return(0,s.jsx)(B.A,{className:"h-4 w-4"})}},...n})}V.displayName="Calendar";var Z=a(76981),W=a(10518);let q=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(Z.bL,{ref:t,className:(0,p.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",a),...r,children:(0,s.jsx)(Z.C1,{className:(0,p.cn)("flex items-center justify-center text-current"),children:(0,s.jsx)(W.A,{className:"h-4 w-4"})})})});q.displayName=Z.bL.displayName;var Y=a(22346);let Q=/^(0[0-9]|1[0-9]|2[0-3]):[0-5][0-9]$/,X=R.z.object({date:R.z.date(),isAllDay:R.z.boolean(),startTime:R.z.string().regex(Q,{message:"פורמט זמן לא חוקי (HH:mm)."}),endTime:R.z.string().regex(Q,{message:"פורמט זמן לא חוקי (HH:mm)."})}),K=R.z.object({absencePeriods:R.z.array(X),reason:R.z.string().optional()}).refine(e=>{for(let t of e.absencePeriods)if(!t.isAllDay&&new Date("1970-01-01T".concat(t.startTime,":00"))>=new Date("1970-01-01T".concat(t.endTime,":00")))return!1;return!0},{message:"שעת הסיום חייבת להיות אחרי שעת ההתחלה.",path:["absencePeriods"]});function ee(e){let{isOpen:t,onOpenChange:a,teacher:n,allTeachers:l,allClasses:d,timeSlots:o,onShowRecommendation:c,getAffectedLessons:m}=e,{toast:f}=(0,L.dj)(),[h,x]=(0,r.useState)(!1),b=(0,S.mN)({resolver:(0,T.u)(K),defaultValues:{reason:"",absencePeriods:[]}}),{fields:g,append:j,remove:y,update:v}=(0,S.jz)({control:b.control,name:"absencePeriods"});if((0,r.useEffect)(()=>{t?b.reset({reason:"",absencePeriods:[{date:(0,A.o)(new Date),isAllDay:!0,startTime:"08:00",endTime:"16:00"}]}):(b.reset({reason:"",absencePeriods:[]}),x(!1))},[t,b]),!n)return null;let N=async e=>{x(!0);try{let t=l.filter(e=>e.id!==n.id),s=m(n,e.absencePeriods,d,o),r=s.map(e=>(0,O.o0)({subject:e.lesson.subject,date:e.date,time:e.time},t,d,o)),i=await Promise.all(r),u=s.map((e,t)=>({...e,recommendation:i[t].recommendation,recommendationId:i[t].recommendationId,reasoning:i[t].reasoning,substituteOptions:i[t].substituteOptions}));c(u,n,e.absencePeriods),a(!1)}catch(e){console.error("שגיאה בקבלת המלצות:",e),f({variant:"destructive",title:"שגיאה",description:"לא ניתן היה להפיק המלצות למחליפים. אנא נסה שוב."})}finally{x(!1)}};return(0,s.jsx)(z.lG,{open:t,onOpenChange:a,children:(0,s.jsxs)(z.Cf,{className:"sm:max-w-md",children:[(0,s.jsxs)(z.c7,{children:[(0,s.jsxs)(z.L3,{children:["סימון היעדרות עבור ",n.name]}),(0,s.jsx)(z.rr,{children:"בחר את תאריכי ושעות ההיעדרות כדי למצוא מחליף. המערכת תציג את כל השיעורים המושפעים."})]}),(0,s.jsx)(E.lV,{...b,children:(0,s.jsxs)("form",{onSubmit:b.handleSubmit(N),className:"space-y-4 py-4",children:[(0,s.jsx)("div",{className:"space-y-4 max-h-60 overflow-y-auto pl-2",children:g.map((e,t)=>{let a=b.watch("absencePeriods.".concat(t,".isAllDay"));return(0,s.jsxs)("div",{className:"p-3 border rounded-lg relative",children:[(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)(E.zB,{control:b.control,name:"absencePeriods.".concat(t,".date"),render:e=>{let{field:t}=e;return(0,s.jsxs)(E.eI,{className:"flex flex-col",children:[(0,s.jsx)(E.lR,{children:"תאריך"}),(0,s.jsxs)($.AM,{children:[(0,s.jsx)($.Wv,{asChild:!0,children:(0,s.jsx)(E.MJ,{children:(0,s.jsxs)(u.$,{variant:"outline",className:(0,p.cn)("w-full justify-start text-right font-normal",!t.value&&"text-muted-foreground"),children:[(0,s.jsx)(M.A,{className:"ml-2 h-4 w-4"}),t.value?(0,_.GP)(t.value,"PPP",{locale:D.he}):(0,s.jsx)("span",{children:"בחר תאריך"})]})})}),(0,s.jsx)($.hl,{className:"w-auto p-0",align:"start",children:(0,s.jsx)(V,{locale:D.he,mode:"single",selected:t.value,onSelect:e=>t.onChange(e?(0,A.o)(e):void 0),initialFocus:!0})})]}),(0,s.jsx)(E.C5,{})]})}}),(0,s.jsx)(E.zB,{control:b.control,name:"absencePeriods.".concat(t,".isAllDay"),render:e=>{let{field:t}=e;return(0,s.jsxs)(E.eI,{className:"flex flex-row items-center space-x-2 space-x-reverse space-y-0",children:[(0,s.jsx)(E.MJ,{children:(0,s.jsx)(q,{checked:t.value,onCheckedChange:t.onChange})}),(0,s.jsx)(E.lR,{className:"font-normal cursor-pointer",children:"יום שלם"})]})}}),!a&&(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsx)(E.zB,{control:b.control,name:"absencePeriods.".concat(t,".startTime"),render:e=>{let{field:t}=e;return(0,s.jsxs)(E.eI,{children:[(0,s.jsx)(E.lR,{children:"שעת התחלה"}),(0,s.jsx)(E.MJ,{children:(0,s.jsx)(J.p,{type:"time",...t})}),(0,s.jsx)(E.C5,{})]})}}),(0,s.jsx)(E.zB,{control:b.control,name:"absencePeriods.".concat(t,".endTime"),render:e=>{let{field:t}=e;return(0,s.jsxs)(E.eI,{children:[(0,s.jsx)(E.lR,{children:"שעת סיום"}),(0,s.jsx)(E.MJ,{children:(0,s.jsx)(J.p,{type:"time",...t})}),(0,s.jsx)(E.C5,{})]})}})]})]}),g.length>1&&(0,s.jsx)(u.$,{type:"button",variant:"ghost",size:"icon",className:"absolute top-1 left-1 h-6 w-6",onClick:()=>y(t),children:(0,s.jsx)(H.A,{className:"h-4 w-4 text-destructive"})})]},e.id)})}),(0,s.jsxs)(u.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{let e=g.length>0?g[g.length-1].date:new Date;j({date:(0,A.o)(e),isAllDay:!1,startTime:"08:00",endTime:"09:00"})},children:[(0,s.jsx)(F.A,{className:"ml-2 h-4 w-4"}),"הוסף תקופת היעדרות"]}),(0,s.jsx)(Y.w,{}),(0,s.jsx)(E.zB,{control:b.control,name:"reason",render:e=>{let{field:t}=e;return(0,s.jsxs)(E.eI,{children:[(0,s.jsx)(E.lR,{children:"סיבה (אופציונלי)"}),(0,s.jsx)(E.MJ,{children:(0,s.jsx)(J.p,{placeholder:"למשל, פיתוח מקצועי",...t})}),(0,s.jsx)(E.C5,{})]})}}),b.formState.errors.absencePeriods&&(0,s.jsx)("p",{className:"text-sm font-medium text-destructive",children:b.formState.errors.absencePeriods.message}),(0,s.jsx)(z.Es,{children:(0,s.jsx)(u.$,{type:"submit",disabled:h||0===g.length,children:h?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.A,{className:"ml-2 h-4 w-4 animate-spin"}),"מחפש המלצות..."]}):"הצג שיעורים מושפעים"})})]})})]})})}var et=a(98328),ea=a(50286),es=a(57804),er=a(19968),en=a(17569),el=a(74651),ei=a.n(el),ed=a(37250),eo=a(79556);let ec=ed.bL,em=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(ed.q7,{ref:t,className:(0,p.cn)("border-b",a),...r})});em.displayName="AccordionItem";let eu=r.forwardRef((e,t)=>{let{className:a,children:r,...n}=e;return(0,s.jsx)(ed.Y9,{className:"flex",children:(0,s.jsxs)(ed.l9,{ref:t,className:(0,p.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",a),...n,children:[r,(0,s.jsx)(eo.A,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})})});eu.displayName=ed.l9.displayName;let ef=r.forwardRef((e,t)=>{let{className:a,children:r,...n}=e;return(0,s.jsx)(ed.UC,{ref:t,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...n,children:(0,s.jsx)("div",{className:(0,p.cn)("pb-4 pt-0",a),children:r})})});ef.displayName=ed.UC.displayName;var eh=a(26126),ex=a(66424);function ep(e){let{isOpen:t,onOpenChange:a,recommendationResult:r,onConfirmAssignments:n}=e;if(!r)return null;let{results:l,absentTeacher:i,absenceDays:d}=r,o=ei()(l,e=>I.B[(0,C.P)(e.date)]),c=I.B.filter(e=>o[e]);return(0,s.jsx)(z.lG,{open:t,onOpenChange:a,children:(0,s.jsxs)(z.Cf,{className:"max-w-lg md:max-w-2xl",children:[(0,s.jsxs)(z.c7,{children:[(0,s.jsxs)(z.L3,{children:["המלצות שיבוץ עבור ",i.name]}),(0,s.jsx)(z.rr,{children:'להלן השיעורים המושפעים והמחליפים המומלצים. לחץ על "אישור" כדי לעדכן את המערכת.'})]}),(0,s.jsx)(ex.F,{className:"py-2 max-h-[60vh] overflow-y-auto pr-4 -mr-4",children:(0,s.jsx)(ec,{type:"multiple",className:"w-full",defaultValue:c.map(e=>"day-".concat(e)),children:c.map(e=>(0,s.jsxs)(em,{value:"day-".concat(e),children:[(0,s.jsx)(eu,{children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(et.A,{className:"h-5 w-5 text-primary"}),(0,s.jsxs)("span",{className:"font-semibold",children:["יום ",e]}),(0,s.jsxs)(eh.E,{variant:"secondary",children:[o[e].length," שיעורים"]})]})}),(0,s.jsx)(ef,{children:(0,s.jsx)("div",{className:"space-y-4 p-2",children:o[e].map((e,t)=>{var a;let r=null==(a=e.substituteOptions)?void 0:a.find(t=>t.id===e.recommendationId);return(0,s.jsxs)("div",{className:"p-3 border rounded-lg bg-card",children:[(0,s.jsxs)("div",{className:"font-semibold flex flex-col sm:flex-row items-start sm:items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(ea.A,{className:"ml-2 h-4 w-4 text-muted-foreground"}),(0,s.jsxs)("span",{children:["כיתה ",e.className]})]}),(0,s.jsxs)("span",{className:"text-sm text-muted-foreground font-normal mt-1 sm:mt-0",children:[e.lesson.subject," בשעה ",e.time]})]}),(0,s.jsx)(Y.w,{className:"my-2"}),(0,s.jsxs)("div",{className:"grid grid-cols-[1fr_auto_1fr] items-center gap-2 sm:gap-4 text-center",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center p-2 rounded-md bg-secondary/50",children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"מחליף מומלץ"}),r?(0,s.jsxs)("p",{className:"font-bold text-primary flex items-center justify-center gap-2 mt-1",children:[(0,s.jsx)(es.A,{className:"h-4 w-4"}),r.name]}):(0,s.jsx)("p",{className:"font-bold text-muted-foreground mt-1",children:"אין מחליף"})]}),(0,s.jsx)(er.A,{className:"h-4 w-4 text-muted-foreground mx-auto my-2 sm:my-0"}),(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"מורה מקורי"}),(0,s.jsx)("p",{className:"font-bold text-destructive/80 flex items-center justify-center gap-2 mt-1",children:i.name})]})]}),r&&e.reasoning&&(0,s.jsxs)("div",{className:"mt-3 p-2 rounded-md bg-green-50 dark:bg-green-900/20 text-green-800 dark:text-green-300 text-xs flex items-start gap-2 text-right",children:[(0,s.jsx)(en.A,{className:"h-4 w-4 shrink-0 mt-0.5 ml-1"}),(0,s.jsxs)("span",{children:[(0,s.jsx)("strong",{children:"נימוק:"})," ",e.reasoning]})]})]},t)})})})]},e))})}),(0,s.jsxs)(z.Es,{children:[(0,s.jsx)(z.HM,{asChild:!0,children:(0,s.jsx)(u.$,{type:"button",variant:"secondary",children:"ביטול"})}),(0,s.jsx)(u.$,{type:"button",onClick:()=>{n(i,d,l.map(e=>{var t;let a=null==(t=e.substituteOptions)?void 0:t.find(t=>t.id===e.recommendationId),s=e.recommendationId;return{classId:e.classId,className:e.className,day:I.B[(0,C.P)(e.date)],time:e.time,newTeacherId:s,newTeacherName:null==a?void 0:a.name,originalLesson:e.lesson}}))},children:"אישור"})]})]})})}var eb=a(40610),eg=a(3310);let ej=(0,n.default)(()=>Promise.all([a.e(782),a.e(749),a.e(365),a.e(862)]).then(a.bind(a,16862)),{loadableGenerated:{webpack:()=>[16862]},loading:()=>(0,s.jsx)("div",{className:"p-4 flex justify-center",children:(0,s.jsx)(i.A,{className:"h-8 w-8 animate-spin text-primary"})})}),ey=(0,n.default)(()=>a.e(605).then(a.bind(a,57605)),{loadableGenerated:{webpack:()=>[57605]},loading:()=>(0,s.jsx)("div",{className:"p-4 flex justify-center",children:(0,s.jsx)(i.A,{className:"h-8 w-8 animate-spin text-primary"})})}),ev=(0,n.default)(()=>Promise.all([a.e(782),a.e(749),a.e(365),a.e(658)]).then(a.bind(a,83277)),{loadableGenerated:{webpack:()=>[83277]},loading:()=>(0,s.jsx)("div",{className:"p-4 flex justify-center",children:(0,s.jsx)(i.A,{className:"h-8 w-8 animate-spin text-primary"})})}),eN=(0,n.default)(()=>Promise.all([a.e(782),a.e(957)]).then(a.bind(a,62957)),{loadableGenerated:{webpack:()=>[62957]},loading:()=>(0,s.jsx)("div",{className:"p-4 flex justify-center",children:(0,s.jsx)(i.A,{className:"h-8 w-8 animate-spin text-primary"})})}),ew=(0,n.default)(()=>a.e(737).then(a.bind(a,86737)),{loadableGenerated:{webpack:()=>[86737]},loading:()=>(0,s.jsx)("div",{className:"p-4 flex justify-center",children:(0,s.jsx)(i.A,{className:"h-8 w-8 animate-spin text-primary"})})}),eI=(e,t,a,s)=>{let r=[],n=["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת"],l=e=>{let[t,a]=e.split(":").map(Number);return 60*t+a};return(t||[]).forEach(t=>{let i=n[(0,C.P)((0,A.o)(new Date(t.date)))],d=t.isAllDay?0:l(t.startTime),o=t.isAllDay?1440:l(t.endTime);(a||[]).forEach(a=>{var n;let c=null==(n=a.schedule)?void 0:n[i];c&&Object.entries(c).forEach(n=>{let[i,c]=n,m=s.find(e=>e.start===i);if(!m||"break"===m.type)return;let u=l(m.start),f=l(m.end);c&&c.teacherId===e.id&&Math.max(u,d)<Math.min(f,o)&&r.push({classId:a.id,className:a.name,date:new Date(t.date),time:i,lesson:c})})})}),r};function ek(){let{user:e,isUserLoading:t}=(0,x.useUser)(),a=(0,g.useRouter)(),n=(0,x.useFirestore)(),[l,d]=(0,r.useState)(null),[o,c]=(0,r.useState)(null),m=(0,x.useMemoFirebase)(()=>e?(0,j.P)((0,j.rJ)(n,"teachers"),(0,j._M)("userId","==",e.uid)):null,[e,n]),f=(0,x.useMemoFirebase)(()=>e?(0,j.P)((0,j.rJ)(n,"classes"),(0,j._M)("userId","==",e.uid)):null,[e,n]),h=(0,x.useMemoFirebase)(()=>e?(0,j.P)((0,j.rJ)(n,"settings"),(0,j._M)("userId","==",e.uid)):null,[e,n]),{data:p=[],isLoading:C}=(0,y.G)(m),{data:R=[],isLoading:S}=(0,y.G)(f),{data:T,isLoading:_}=(0,y.G)(h),D=(0,r.useMemo)(()=>{if(T){let t=T.find(t=>t.id==="timetable_".concat(null==e?void 0:e.uid));if(t)return t.slots||[]}return[]},[T,e]);(0,r.useEffect)(()=>{t||e||a.push("/login")},[e,t,a]);let z=(0,r.useMemo)(()=>{let e=new Map,t=new Date;return(p||[]).forEach(a=>{e.set(a.id,(0,O.ax)(a,t,D))}),e},[p,D]),E=async t=>{if(!n||!e)return;let a=(0,j.H9)((0,j.rJ)(n,"teachers")),s=t.name.split(" ").map(e=>e[0]).join("").toUpperCase(),r={...t,id:a.id,userId:e.uid,avatar:{fallback:s},schedule:{},absences:[]},l=(0,j.wP)(n);l.set(a,r),await (0,w.j)(l,{operation:"create",path:a.path,data:r})},J=async t=>{if(!n||!e)return;let a=(0,j.H9)(n,"teachers",t.id),s=(0,j.wP)(n);s.update(a,{...t}),await (0,w.j)(s,{operation:"update",path:a.path,data:t})},L=async t=>{if(!n||!e)return;let a=(0,j.wP)(n);try{(await (0,j.GG)((0,j.P)((0,j.rJ)(n,"classes"),(0,j._M)("userId","==",e.uid)))).forEach(e=>{let s={id:e.id,...e.data()},r=!1,l={...s.schedule};if(Object.keys(l).forEach(e=>{l[e]&&Object.keys(l[e]).forEach(a=>{var s;let n=null==(s=l[e])?void 0:s[a];n&&n.teacherId===t&&(l[e][a]=null,r=!0)})}),r){let e=(0,j.H9)(n,"classes",s.id);a.update(e,{schedule:l})}});let s=(0,j.H9)(n,"teachers",t);a.delete(s),await (0,w.j)(a,{operation:"delete",path:"teachers/".concat(t," and related classes")})}catch(e){if(!(e instanceof eb.$)){let e=new eb.$({operation:"delete",path:"teachers/".concat(t," and related classes")});throw eg.d.emit("permission-error",e),e}throw e}},M=async t=>{if(!n||!e)return;let a=(0,j.H9)((0,j.rJ)(n,"classes")),s={name:t,schedule:{},userId:e.uid},r=(0,j.wP)(n);r.set(a,{...s,id:a.id}),await (0,w.j)(r,{operation:"create",path:a.path,data:{...s,id:a.id}})},H=async t=>{if(!n||!e)return;let a=(0,j.wP)(n);try{let e=(0,j.H9)(n,"classes",t),s=await (0,j.x7)(e);if(!s.exists())return;let r=s.data(),l=new Set;for(let e of(Object.values(r.schedule||{}).forEach(e=>{Object.values(e).forEach(e=>{e&&l.add(e.teacherId)})}),l)){let s=(0,j.H9)(n,"teachers",e),r=await (0,j.x7)(s);if(r.exists()){let e=r.data(),n=JSON.parse(JSON.stringify(e.schedule||{}));Object.keys(n).forEach(e=>{Object.keys(n[e]||{}).forEach(a=>{var s;(null==(s=n[e][a])?void 0:s.classId)===t&&delete n[e][a]})}),a.update(s,{schedule:n})}}a.delete(e),await (0,w.j)(a,{operation:"delete",path:"classes/".concat(t," and related teachers")})}catch(e){if(!(e instanceof eb.$)){let e=new eb.$({operation:"delete",path:"classes/".concat(t," and related teachers")});throw eg.d.emit("permission-error",e),e}throw e}},F=async(t,a,s)=>{if(!n||!e)return;let r=(0,j.wP)(n);try{if("teacher"===t){let e=(0,j.H9)(n,"teachers",a),t=await (0,j.x7)(e);if(!t.exists())return;let l=t.data().schedule||{};r.update(e,{schedule:s});let i=new Set;for(let e of[l,s])Object.values(e||{}).forEach(e=>Object.values(e||{}).forEach(e=>(null==e?void 0:e.classId)&&i.add(e.classId)));for(let e of i){let t=(0,j.H9)(n,"classes",e),i=await (0,j.x7)(t);if(!i.exists())continue;let d=i.data(),o=JSON.parse(JSON.stringify(d.schedule||{}));I.B.forEach(t=>{(D||[]).forEach(r=>{var n,i,d,c;let m=r.start,u=null==(n=l[t])?void 0:n[m],f=null==(i=s[t])?void 0:i[m];(null==u?void 0:u.classId)!==e||f&&f.classId===e||(null==(c=o[t])||null==(d=c[m])?void 0:d.teacherId)===a&&(o[t][m]=null),(null==f?void 0:f.classId)===e&&(o[t]=o[t]||{},o[t][m]={...f,teacherId:a})})}),r.update(t,{schedule:o})}}else{let e=(0,j.H9)(n,"classes",a),t=await (0,j.x7)(e);if(!t.exists())return;let l=t.data().schedule||{};r.update(e,{schedule:s});let i=new Set;for(let e of[l,s])Object.values(e||{}).forEach(e=>Object.values(e||{}).forEach(e=>(null==e?void 0:e.teacherId)&&i.add(e.teacherId)));for(let e of i){let t=(0,j.H9)(n,"teachers",e),i=await (0,j.x7)(t);if(!i.exists())continue;let d=i.data(),o=JSON.parse(JSON.stringify(d.schedule||{}));I.B.forEach(t=>{(D||[]).forEach(r=>{var n,i,d,c;let m=r.start,u=null==(n=l[t])?void 0:n[m],f=null==(i=s[t])?void 0:i[m];(null==u?void 0:u.teacherId)!==e||f&&f.teacherId===e||(null==(c=o[t])||null==(d=c[m])?void 0:d.classId)===a&&(o[t][m]=null),(null==f?void 0:f.teacherId)===e&&(o[t]=o[t]||{},o[t][m]={...f,classId:a})})}),r.update(t,{schedule:o})}}await (0,w.j)(r,{operation:"update",path:"".concat("teacher"===t?"teachers":"classes","/").concat(a),data:{schedule:s}})}catch(e){if(!(e instanceof eb.$)){let e=new eb.$({operation:"update",path:"".concat("teacher"===t?"teachers":"classes","/").concat(a),requestResourceData:{schedule:s}});throw eg.d.emit("permission-error",e),e}throw e}},$=async t=>{if(!n||!e)return;let a=(0,j.H9)(n,"settings","timetable_".concat(e.uid)),s={slots:t,userId:e.uid},r=(0,j.wP)(n);r.set(a,s,{merge:!0});try{await (0,w.j)(r,{operation:"update",path:a.path,data:s})}catch(e){console.error("Failed to update timetable settings.",e)}},U=async(t,a,s)=>{if(!n||!e)return;let r=(0,j.wP)(n),l=(0,j.H9)(n,"teachers",t.id),i=t.absences||[],d=a.map(e=>({...e,date:(0,A.o)(new Date(e.date)).toISOString()}));for(let e of(r.update(l,{absences:[...i,...d]}),s)){var o;if(e.newTeacherId){let t=(0,j.H9)(n,"teachers",e.newTeacherId),a=await (0,j.x7)(t);if(a.exists()){let s=JSON.parse(JSON.stringify(a.data().schedule||{}));s[e.day]=s[e.day]||{},s[e.day][e.time]={subject:e.originalLesson.subject,classId:e.classId,teacherId:e.newTeacherId},r.update(t,{schedule:s})}let s=(0,j.H9)(n,"classes",e.classId),l=await (0,j.x7)(s);if(l.exists()){let t=JSON.parse(JSON.stringify(l.data().schedule||{}));t[e.day]=t[e.day]||{},t[e.day][e.time]={subject:e.originalLesson.subject,classId:e.classId,teacherId:e.newTeacherId},r.update(s,{schedule:t})}}let a=JSON.parse(JSON.stringify(t.schedule||{}));(null==(o=a[e.day])?void 0:o[e.time])&&(a[e.day][e.time]=null,r.update(l,{schedule:a}))}for(let a of s)if(a.newTeacherId){let s=(0,j.H9)((0,j.rJ)(n,"substitutions")),l={id:s.id,date:(0,A.o)(new Date(a.originalLesson.date||new Date)).toISOString(),time:a.time,classId:a.classId,className:a.className||"Unknown",absentTeacherId:t.id,absentTeacherName:t.name,substituteTeacherId:a.newTeacherId,substituteTeacherName:a.newTeacherName||"Unknown",subject:a.originalLesson.subject,userId:e.uid,createdAt:new Date().toISOString()};r.set(s,l)}await (0,w.j)(r,{operation:"update",path:"absences_and_substitutions"}),c(null)},B=(0,r.useMemo)(()=>{let e=(0,A.o)(new Date);return(p||[]).map(t=>{let a=(t.absences||[]).filter(t=>{if("string"!=typeof t.date)return!1;try{return(0,P.r)((0,A.o)(new Date(t.date)),e)}catch(e){return!1}});return{teacher:t,absences:a}}).filter(e=>e.absences.length>0)},[p]),G=async e=>{let t=(0,A.o)(new Date),a=(e.absences||[]).filter(e=>e.date&&(0,P.r)((0,A.o)(new Date(e.date)),t));if(0===a.length||!R)return;let s=eI(e,a,R,D),r=(p||[]).filter(t=>t.id!==e.id),n=s.map(e=>(0,O.o0)({subject:e.lesson.subject,date:e.date,time:e.time},r,R,D)),l=await Promise.all(n);c({results:s.map((e,t)=>({...e,recommendation:l[t].recommendation,recommendationId:l[t].recommendationId,reasoning:l[t].reasoning,substituteOptions:l[t].substituteOptions})),absentTeacher:e,absenceDays:a})},[V,Z]=(0,r.useState)("teachers"),W=t||C||S||_;if(W)return(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-background",children:(0,s.jsx)(i.A,{className:"h-10 w-10 animate-spin text-primary"})});let q=!W&&e&&0===D.length;return q?(0,s.jsxs)("div",{className:"flex flex-col min-h-screen bg-background",children:[(0,s.jsx)(b,{}),(0,s.jsx)("main",{className:"flex-1 p-4 sm:p-6 md:p-8",children:(0,s.jsx)(eN,{timeSlots:[],onUpdate:$,isInitialSetup:q})})]}):(0,s.jsxs)("div",{className:"flex flex-col min-h-screen bg-background",children:[(0,s.jsx)(b,{}),(0,s.jsxs)("main",{className:"flex-1 p-4 sm:p-6 md:p-8 space-y-6",children:[B.length>0&&(0,s.jsxs)(k.Zp,{className:"border-l-4 border-l-destructive shadow-md",children:[(0,s.jsxs)(k.aR,{className:"pb-3",children:[(0,s.jsxs)(k.ZB,{className:"text-xl flex items-center gap-2",children:[(0,s.jsx)(v.A,{className:"text-destructive h-5 w-5"}),"מורים חסרים היום"]}),(0,s.jsx)(k.BT,{children:"סקירה מהירה של ההיעדרויות להיום. לחץ על מורה כדי למצוא מחליפים."})]}),(0,s.jsx)(k.Wu,{children:(0,s.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:B.map(e=>{let{teacher:t,absences:a}=e,r=a.map(e=>e.isAllDay?"יום שלם":"".concat(e.startTime,"-").concat(e.endTime)).join(", ");return(0,s.jsxs)("div",{className:"flex flex-col justify-between p-4 bg-secondary/30 rounded-xl border border-border hover:bg-secondary/50 transition-colors",children:[(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsx)("span",{className:"font-semibold text-lg block",children:t.name}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:r})]}),(0,s.jsxs)(u.$,{size:"sm",variant:"outline",className:"w-full justify-center",onClick:()=>G(t),children:[(0,s.jsx)(N.A,{className:"me-2 h-4 w-4"}),"הצג שיעורים מושפעים"]})]},t.id)})})})]}),(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)("div",{className:"w-full",children:[(0,s.jsxs)("div",{className:"grid w-full grid-cols-2 sm:grid-cols-5 max-w-4xl mx-auto h-auto p-1 bg-muted/50 backdrop-blur-sm rounded-full mb-8",children:[(0,s.jsx)(u.$,{variant:"ghost",onClick:()=>Z("teachers"),className:"rounded-full py-2.5 transition-all ".concat("teachers"===V?"bg-background shadow-sm text-foreground":"text-muted-foreground hover:bg-background/50"),children:"פרופילי מורים"}),(0,s.jsx)(u.$,{variant:"ghost",onClick:()=>Z("classes"),className:"rounded-full py-2.5 transition-all ".concat("classes"===V?"bg-background shadow-sm text-foreground":"text-muted-foreground hover:bg-background/50"),children:"כיתות לימוד"}),(0,s.jsx)(u.$,{variant:"ghost",onClick:()=>Z("timetable"),className:"rounded-full py-2.5 transition-all ".concat("timetable"===V?"bg-background shadow-sm text-foreground":"text-muted-foreground hover:bg-background/50"),children:"זמינות מחליפים"}),(0,s.jsx)(u.$,{variant:"ghost",onClick:()=>Z("statistics"),className:"rounded-full py-2.5 transition-all ".concat("statistics"===V?"bg-background shadow-sm text-foreground":"text-muted-foreground hover:bg-background/50"),children:"סטטיסטיקה"}),(0,s.jsx)(u.$,{variant:"ghost",onClick:()=>Z("settings"),className:"rounded-full py-2.5 transition-all ".concat("settings"===V?"bg-background shadow-sm text-foreground":"text-muted-foreground hover:bg-background/50"),children:"הגדרות"})]}),"teachers"===V&&(0,s.jsx)("div",{className:"mt-0",children:(0,s.jsx)(ej,{teachers:p||[],allClasses:R||[],timeSlots:D,onAddTeacher:E,onEditTeacher:J,onDeleteTeacher:L,onMarkAbsent:e=>d(e),onUpdateTeacherSchedule:(e,t)=>F("teacher",e,t),teacherAvailabilityNow:z})}),"classes"===V&&(0,s.jsx)("div",{className:"mt-0",children:(0,s.jsx)(ev,{initialClasses:R||[],allTeachers:p||[],timeSlots:D,onAddClass:M,onDeleteClass:H,onUpdateSchedule:(e,t)=>F("class",e,t)})}),"timetable"===V&&(0,s.jsx)("div",{className:"mt-0",children:(0,s.jsx)(ey,{allTeachers:p||[],timeSlots:D})}),"statistics"===V&&(0,s.jsx)("div",{className:"mt-0",children:(0,s.jsx)(ew,{})}),"settings"===V&&(0,s.jsx)("div",{className:"mt-0",children:(0,s.jsx)(eN,{timeSlots:D,onUpdate:$})})]})})]}),(0,s.jsx)(ee,{isOpen:!!l,onOpenChange:e=>!e&&d(null),teacher:l,allTeachers:p||[],allClasses:R||[],timeSlots:D,getAffectedLessons:eI,onShowRecommendation:(e,t,a)=>{c({results:e,absentTeacher:t,absenceDays:a})}}),(0,s.jsx)(ep,{isOpen:!!o,onOpenChange:e=>!e&&c(null),recommendationResult:o,onConfirmAssignments:U})]})}},91950:(e,t,a)=>{"use strict";a.d(t,{B:()=>s});let s=["ראשון","שני","שלישי","רביעי","חמישי","שישי"]},97714:(e,t,a)=>{"use strict";a.d(t,{j:()=>n});var s=a(3310),r=a(40610);function n(e,t){return e.commit().catch(e=>{let a=new r.$({operation:t.operation,path:t.path,requestResourceData:t.data});throw s.d.emit("permission-error",a),a})}}},e=>{var t=t=>e(e.s=t);e.O(0,[992,416,469,925,395,135,892,441,684,358],()=>t(73669)),_N_E=e.O()}]);